var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");
var LIST_ID="MEMessageList",LIST_CONTAINER="msgList_shell_js",LIST_CONTAINER_INNER="msgList_container_js",MODE_ADD=0,MODE_EDIT=1,gSkinPath="",gContactID="",gEmailViewInitialised=!1,RESIZER_BAR_OPEN_WIDTH=6,RESIZER_BAR_CLOSED_WIDTH=21,HEADERSHELL_PADDING=3,DROPDOWNBTTN_PADDING=5,gCurMessageID="",gImagesBlocked=!1,gMessagesRetrieved=!1,gCurrentPreviewKey="",gCopyResult=0,gCopyCount=0,gPasteCount=0,bViewSelected=!1,gStartupPage="",gChangePasswordEnabled=!0,gPOPRetrievalEnabled=!0,gMailboxRedirectionEnabled=
!0,gAutoResponseEnabled=!0,gFilteringEnabled=!0,gWhitelistEnabled=!0,gBlacklistEnabled=!0,gAutoCompleteMode=1,gCalendaringEnabled=!0,gTasksEnabled=!0,gPublishingEnabled=!0,gGlobalAddressListEnabled=!0,gReportAsSpamEnabled=!0,gDownloadVDataEnabled=!0,gSpamFilteringEnabled=!0,gContactsEnabled=!0,gSpellCheckingEnabled=!0,gActivityViewEnabled=!0,gSyncMLEnabled=!1,gPersonalisationEnabled=!1,gServicesEnabled=!1,bNotInbox=!1,gAllowSMSConversations=!1,gMsgListWidth=400,gLeftPaneWidth=285,gListSharedContactsAttempts=
0,gListSharedContactsInterval=null,gListSharedTasksAttempts=0,gListSharedTasksInterval=null,gSelectOnCreate=!1,gNewMailMonitor=0,gApptMonitor=0,gCalcTimer=0,oAlertsCache,AlertsCacheChangeKey="",AlertRangeStart="",arrRequests=[],arrResponses=[];function registerRequest(){var a=Math.random();g_opt.Concurrency&&arrRequests.push(a);return a}function set_Bulk(a,b){$("#"+a).removeClass("btn_on");1==b&&$("#"+a).addClass("btn_on")}
function toggle_Bulk(a){var b=GetOption("WebMail-HideBulk");b=1==b?0:1;SetOption("WebMail-HideBulk",b,!0,0,1);set_Bulk(a,b);ListMessages(GetSelectedFolderPath())}
function registerResponse(a,b){arrResponses[b]=a;b=!0;a=0;for(len=arrRequests.length;a<len;++a)if(!(arrRequests[a]in arrResponses)){b=!1;break}if(b){arrRequests=[];b=[];for(var c in arrResponses)arrResponses.hasOwnProperty(c)&&b.push(c);for(a=b.length-1;0<=a;a--)doProcessXMLResult(arrResponses[b[a]],b[a]),delete arrResponses[b[a]]}else console.log("Waiting for all responses. Request count: "+arrRequests.length);return!0}
var SCROLLBAR_TD="ME_ScrollControlTD",SCROLLBAR_DIV="ME_ScrollControlDiv",SCROLLBAR_CANVAS="ME_ScrollControlCanvas",SEARCH_FIELD_FROM=1,SEARCH_FIELD_TO=2,SEARCH_FIELD_SUBJECT=3,SEARCH_FIELD_BODY=4,gSortColumn="RECEIVED",gSortOrder="Desc",gSearchStr="",gSelectedSharedNodePath="",VIEW_PERSONAL="Personal Folders View",VIEW_PUBLIC="Public Folders View",VIEW_FILES="Files Folders View",VIEW_CONTACTS="Contacts View",VIEW_COMPOSE="Compose View",VIEW_OPTIONS="Options View",VIEW_FOLDERS="Manage Folders View",
VIEW_CALENDAR="Calendar View",VIEW_TASKS="Tasks View",VIEW_TIMEOUT="Timeout View",VIEW_READ="Read View",VIEW_ACCOUNT_SUMMARY="Account Summary",VIEW_SHARES="Shares",VIEW_CONNECT="Connect",VIEW_STATS="Statistics View",VIEW_ADMIN="Admin View",VIEW_NOTES="Notes View",VIEW_SEARCH="Search View",FOLDER_NODE_CONTACTS="/Contacts",FOLDER_NODE_CALENDAR="/Calendar",FOLDER_NODE_TASKS="/Tasks",FOLDER_NODE_FILES="/$FILEROOT",FOLDER_NODE_NOTES="/Notes",boolBackgroundLoad=!1,gPopupItemID,gPreviewMode=1,gCurrentFolderContext=
"",gCurrentView=VIEW_PERSONAL,gPrevEmailView="",gCurrentSelectedNode="",arrSelectedTreeNodes={},gMediaPlayerEnabled=!1,CONTEXT_PERSONAL_FOLDERS=0,CONTEXT_PUBLIC_FOLDERS=1,CONTEXT_COMPOSE=2,CONTEXT_CALENDAR=3,CONTEXT_CONTACTS=4,CONTEXT_FOLDERS=5,CONTEXT_OPTIONS=6,CONTEXT_TIMEOUT=7,CONTEXT_TASKS=8,CONTEXT_ACCOUNT_SUMMARY=9,CONTEXT_READ=10,CONTEXT_SHARES=11,CONTEXT_STATS=12,CONTEXT_SEARCH=13,CONTEXT_CHAT=14,CONTEXT_ADMIN=15,CONTEXT_FILES_FOLDERS=16,CONTEXT_NOTES=17,CONTEXT_AUTODETECT=100,CONTEXT_COUNT=
15,FOLDER_TYPE_PERSONAL=1,FOLDER_TYPE_PUBLIC=2,FOLDER_TYPE_OPTIONS=3,FOLDER_TYPE_SHARES=4,FOLDER_TYPE_MY_FILES=5,gComposeMsgID="",SELECTED_LIST_ITEM=0,SELECTED_POPUP_ITEM=1,POPUP_MENU_ID_OPEN=0,POPUP_MENU_ID_MARK_AS_READ=1,POPUP_MENU_ID_MARK_AS_UNREAD=2,POPUP_MENU_ID_REPLY=3,POPUP_MENU_ID_REPLY_ALL=4,POPUP_MENU_ID_FORWARD=5,POPUP_MENU_ID_FLAG=6,POPUP_MENU_ID_UNFLAG=7,POPUP_MENU_ID_REPORT_AS_SPAM=8,POPUP_MENU_ID_DELETE=9,POPUP_MENU_ID_ADD_CONTACT=10,POPUP_MENU_ID_WHITELIST=11,POPUP_MENU_ID_VIEW_HEADERS=
12,POPUP_MENU_ID_DOWNLOAD_SOURCE=13,POPUP_MENU_ID_PRINT=14,POPUP_MENU_ID_COPY=15,POPUP_MENU_ID_PASTE=16,POPUP_MENU_ID_CREATE_FOLDER=17,POPUP_MENU_ID_RENAME_FOLDER=18,POPUP_MENU_ID_DELETE_FOLDER=19,POPUP_MENU_ID_EMPTY_FOLDER=20,POPUP_MENU_ID_SHARE_FOLDER=21,POPUP_MENU_ID_SET_PERMISSIONS=22,POPUP_MENU_ID_UNSHARE_FOLDER=23,POPUP_MENU_ID_DISCONNECT=24,POPUP_MENU_ID_PASTE_INTO_FOLDER=25,POPUP_MENU_ID_QUICK_REPLY=26,POPUP_MENU_ID_BLACKLIST=27,POPUP_MENU_ID_ARCHIVE=28,POPUP_MENU_ID_ADDTOFAVOURITES=29,POPUP_MENU_ID_REMOVEFROMFAVOURITES=
30,POPUP_MENU_ID_DOWNLOAD=31,gPopupItemsCount=32,gEditorPage="compose.aspx",gSetPage=!0,gAsyncSearch=!0,gAsyncDelete=!0,gAsyncMove=!0,gAsyncNewMailCheck=!0,gAsyncReminderCheck=!0,gItemsPerPage=20,gUnitScrollLength=24,gViewAttachFnRef,gPublicFolderView=!1,gHasAccessToShare=!1,gSelectedMessageID,PreviewDelayTimer=null,DoubleClickDelayTimer=null,ClickedMessageID=null,gMarkAsReadTimeout=null,gInstantPreviewLoad=!1,gMessageLoaded=!1,gEnableRR=1,arrTree={},arrFavourites={},arrPubFolders={},arrSwapPane=
{},arrTableColumns={},gSearchStrInputed=!1,gBrowserType=0,gSelectedIM,gResizeSourceChildFrame=null,gMouseDown=!1,gMoveState=0,gMailboxIsShared=0,gDebugMode=!1,gKeepShowingWait=!1,gSetPropsItemCount=0,gSetPropsDoneCount=0;function Async_LockUI(a,b,c){var d=document.getElementById(SCROLLBAR_DIV);if(d)try{d.disabled=!0}catch(e){}gAllowPageActions=!1;a&&ShowWait(a,b,c)}
function Async_UnlockUI(){gAllowPageActions=!0;HideWait();var a=document.getElementById(SCROLLBAR_DIV);if(a){a.style.visibility="visible";try{a.disabled=!1,a.style.visibility="visible"}catch(b){}}}
var layoutMain=null,layoutEmail=null,layoutEmailInner=null,layoutSettings_Main=null,layoutSettings_Email=null,layoutSettings_EmailInnerPrevNone=null,layoutSettings_EmailInnerPrevRight=null,layoutSettings_EmailInnerPrevBot=null,layoutSettings_searchPage=null,layoutSearchPage=null,bIsTouchScreen=!1,gDetailsPaneMinWidth=530;
function initLayout_Main(){layoutSettings_Main={defaults:{name:"layoutMain",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",slidable:!1,contentSelector:".content",contentIgnoreSelector:"span",togglerLength_open:21,togglerLength_closed:15,hideTogglerOnSlide:!0,togglerTip_open:t_("[ME_TXT-CollapseThisPane]"),togglerTip_closed:t_("[ME_TXT-OpenThisPane]"),resizerTip:t_("[ME_TXT-Resize]"),fxName:"slide",fxSpeed_open:200,fxSpeed_close:200,resizerDragOpacity:.5},north:{spacing_open:0,
togglerLength_open:0,togglerLength_closed:-1,resizable:!1,fxName:"none"},center:{paneSelector:"#divTopNavContent"},south:{spacing_open:0,togglerLength_open:0,togglerLength_closed:-1,resizable:!1,size:27,fxName:"none"}}}
function initLayout_Email(){layoutSettings_Email={useStateCookie:!0,defaults:{name:"layoutEmail",size:"auto",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",slidable:!1,contentSelector:".content",contentIgnoreSelector:"span",togglerLength_open:21,togglerLength_closed:15,hideTogglerOnSlide:!0,togglerTip_open:t_("[ME_TXT-CollapseThisPane]"),togglerTip_closed:t_("[ME_TXT-OpenThisPane]"),resizerTip:t_("[ME_TXT-Resize]"),fxName:"slide",fxSpeed_open:200,fxSpeed_close:200,
resizerDragOpacity:.5},west:{size:270,minSize:230,spacing_closed:21,initClosed:!1,togglerLength_closed:15,togglerAlign_closed:"middle",togglerTip_open:t_("[ME_TXT-CollapseFoldersList]"),togglerTip_closed:t_("[ME_TXT-OpenFoldersList]"),resizerTip_open:t_("[ME_TXT-ResizeFoldersList]"),slideTrigger_open:"click",sliderTip:t_("[ME_TXT-OpenFoldersList]"),onclose_start:function(a,b){b.addClass("paneSliding");ResizePreviewPanel()},onopen_end:function(a,b){b.removeClass("paneSliding");ResizePreviewPanel()}},
center:{size:"auto",paneSelector:"#mainContent",onresize_end:ResizeEmailInner}}}
function initLayout_EmailInnerPrevNone(){layoutSettings_EmailInnerPrevNone={defaults:{name:"innerLayout_NoPrev",size:"auto",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",fxName:"none",slidable:!1},west:{size:"auto",paneSelector:"#divMsgList",initClosed:!1,spacing_open:0,spacing_closed:0,togglerLength_open:0,togglerLength_closed:-1,onopen:function(){ScrollBar_RestoreScrollPos(SCROLLBAR_DIV)},onresize_end:function(){ResizeToolbarIcons("toolbar_primary_table_left_msgList_js")}},
center:{size:"auto",initClosed:!0,paneSelector:"#innerCenter",spacing_open:0,spacing_closed:0,togglerLength_open:0,togglerLength_closed:-1}}}
function initLayout_EmailInnerPrevRight(){layoutSettings_EmailInnerPrevRight={useStateCookie:!0,cookie:{keys:"west.size,west.closed"},defaults:{name:"innerLayout_RHSPrev",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",resizerTip:t_("[ME_TXT-Resize]"),fxName:"slide",size:"auto",fxSpeed_open:200,fxSpeed_close:200,resizerDragOpacity:.5,onresize_end:function(){ResizePreviewPanel()},slidable:!1},west:{size:350,paneSelector:"#divMsgList",minSize:300,togglerTip_closed:t_("[ME_TXT-OpenMessageList]"),
togglerTip_open:t_("[ME_TXT-CollapseMessageList]"),sliderTip:t_("[ME_TXT-OpenMessageList]"),spacing_closed:21,togglerLength_closed:15,onclose_start:function(a,b){b.addClass("paneSliding");ResizePreviewPanel()},onopen_end:function(a,b){b.removeClass("paneSliding");ScrollBar_RestoreScrollPos(SCROLLBAR_DIV);ResizePreviewPanel()}},center:{size:"auto",paneSelector:"#innerCenter",togglerTip_closed:"Collapse Message Preview",spacing_closed:21,maskContents:!0,togglerLength_closed:15,togglerAlign_closed:"middle",
onresize_end:function(){ResizeToolbarIcons("toolbar_primary_table_left_js")}}}}
function initLayout_EmailInnerPrevBot(){layoutSettings_EmailInnerPrevBot={useStateCookie:!0,cookie:{keys:"north.size,north.closed"},defaults:{name:"innerLayout_BotPrev",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",resizerTip:t_("[ME_TXT-Resize]"),fxName:"slide",size:"auto",fxSpeed_open:200,fxSpeed_close:200,resizerDragOpacity:.5,slidable:!1},north:{size:300,paneSelector:"#divMsgList",togglerTip_closed:t_("[ME_TXT-OpenMessageList]"),togglerTip_open:t_("[ME_TXT-CollapseMessageList]"),
sliderTip:t_("[ME_TXT-SlideOpenMessageList]"),spacing_closed:21,togglerLength_closed:15,slideTrigger_open:"click",onresize_end:function(){SetListHeight();DataItemList_RewriteTableRows(LIST_ID,gDataListTopOfPageOrdinal-1,arrTableColumns,"resize");ConfigureListItemOverlay();ResizeToolbarIcons("toolbar_primary_table_left_msgList_js")},onclose_start:function(a,b){b.addClass("paneSliding")},onopen_end:function(a,b){b.removeClass("paneSliding");ScrollBar_RestoreScrollPos(SCROLLBAR_DIV)}},center:{size:300,
paneSelector:"#innerCenter",spacing_closed:21,togglerLength_closed:15,maskContents:!0,onresize_end:function(){ResizePreviewPanel()}}}}
function initLayout_searchPage(){layoutSettings_searchPage={defaults:{name:"layoutSearchPage",size:"auto",paneClass:"pane",resizerClass:"resizer",togglerClass:"toggler",buttonClass:"button",slidable:!1,contentSelector:".content",contentIgnoreSelector:"span",togglerLength_open:21,togglerLength_closed:15,hideTogglerOnSlide:!0,togglerTip_open:t_("[ME_TXT-CollapseThisPane]"),togglerTip_closed:t_("[ME_TXT-OpenThisPane]"),resizerTip:t_("[ME_TXT-Resize]"),fxName:"slide",fxSpeed_open:400,fxSpeed_close:400,
resizerDragOpacity:.5},center:{size:"auto",minSize:gDetailsPaneMinWidth,spacing_closed:21,initClosed:!1,onresize_end:function(){ResizeSearchResultsPane()}},east:{size:gDetailsPaneMinWidth,minSize:gDetailsPaneMinWidth,spacing_closed:21,initClosed:!1,togglerLength_closed:15,togglerAlign_closed:"middle",togglerTip_open:t_("[ME_TXT-CollapseDetailsPane]"),togglerTip_closed:t_("[ME_TXT-OpenDetailsPane]"),slideTrigger_open:"click",sliderTip:t_("[ME_TXT-ViewDetailsPane]")}}}
function CustomizeForBrowser(){$(".toolbar_primary_table_right_folderList").show();2==GetBrowserScrollMode()&&(gPreviewMode=VIEW_RIGHT,$(".client_body_shell").css("position","fixed"),$(".client_body_shell").css("overflow","visible"),$(".options_form_table_freeBusy").css("width","500px !important"),$(".options_form_table_freeBusy_right").css("width","auto !important"),$(".options_form_table_freeBusy_right").css("width","200px !important"))}
function InitLayouts(){gBrowserType=GetBrowserType();IsIE(gBrowserType)&&(document.onselectstart=function(a){a=a||window.event;return permitTextSelection(a.target||a.srcElement,"msgHeader_shell_js")});gDetailsPaneMinWidth=(bIsTouchScreen=2==GetBrowserScrollMode())?450:530;initLayout_Main();initLayout_Email();initLayout_EmailInnerPrevNone();initLayout_EmailInnerPrevRight();initLayout_EmailInnerPrevBot();initLayout_searchPage()}
function WriteTopButton(a,b,c,d,e,f){e?(a='<div class="topNav_bttn_divider" id="'+a+'_divider" style="display:inline"></div><div class="topNav_bttn" id="'+(a+'" onclick="'+d+'"><div class="topNav_bttn_icon_shell"><div class="')+(c+'"></div>'),a+="</div>",a+='<div class="topNav_bttn_text">'+t_(b)+"</div>",f&&(a+='<div class="topNav_bttn_border_right"></div>')):(a='<div class="itopNav_bttn" id="'+a+'" onclick="'+d+'"><div class="itopNav_bttn_left"><div class="'+(c+'"></div>'),a+='<div class="itopNav_bttn_txt" onselectstart="return false;">'+
t_(b)+"</div>",a+="</div>",a+='<div class="itopNav_bttn_right"></div>');return a+="</div>"}
function WriteNavigationButtons(a){var b=a?"topNav_bttn":"itopNav";var c=WriteTopButton("topNav_bttn_email","[ME_TXT-Email]",a?"topNav_bttn_icon_email":"itopNav_icon_mail","SelectViewTab(TAB_VIEW_EMAIL)",a);c+=WriteTopButton("topNav_bttn_contacts","[ME_TXT-Contacts]",b+"_icon_contacts","SetPageContextMode(CONTEXT_CONTACTS,null,null,'Mine');",a);c+=WriteTopButton("topNav_bttn_calendar","[ME_TXT-Calendar]",b+"_icon_calendar","SetPageContextMode(CONTEXT_CALENDAR,null,null,'Mine');",a);c+=WriteTopButton("topNav_bttn_tasks",
"[ME_TXT-Tasks]",b+"_icon_tasks","SetPageContextMode(CONTEXT_TASKS,null,null,'Mine');",a);c+=WriteTopButton("topNav_bttn_chat","[ME_TXT-Chat]",b+"_icon_chat","SetPageContextMode(CONTEXT_CHAT);",a);c+=WriteTopButton("topNav_bttn_search","[ME_TXT-Search]",b+"_icon_search","SetPageContextMode(CONTEXT_SEARCH);",a);c+=WriteTopButton("topNav_bttn_stats","[ME_TXT-Statistics]",b+"_icon_stats","SetPageContextMode(CONTEXT_STATS);",a);return c+=WriteTopButton("topNav_bttn_options","[ME_TXT-Options]",b+"_icon_options",
"SetPageContextMode(CONTEXT_OPTIONS);",a)}function SetThemeToggle(a,b){"1"!=b&&($("#dropDown_settings_Theme").hide(),$(".Theme_toggle_menu").hide());a&&dropDown_ToggleTickByID("dropDown_settings_theme_"+a.toLowerCase())}
function ProcessScript(){InitLayouts();if(!layoutMain){try{1==g_opt.BrowserNotify&&"undefined"!==typeof Notification&&"granted"!==Notification.permission&&Notification.requestPermission()}catch(b){}gSharingEnabled=g_opt.SharingEnabled;layoutMain=$("body div.level0_shell").layout(layoutSettings_Main);IE10Hack();jsonList_Init(g_opt.jListId);document.title=t_("[ME_TXT-MailEnableWebMail]")+"::"+g_opt.Mailbox.toUpperCase()+"@"+g_opt.Postoffice.toUpperCase();SetMailboxName(g_opt.Mailbox);$("#topNav_bttn_shell_js").prepend(WriteNavigationButtons(!g_opt.UseSummaryToolBar));
$("#bttn_spam,#bttn_spam_divider,#prevBot_dropDown_spam,#prevRight_dropDown_spam,#prevRight_spam,#prevRight_spam_divider")[g_opt.ReportAsSpam?"show":"hide"]();$("#div_mpshell")[g_opt.MediaPlayerEnabled?"show":"hide"]();$("#ddiAddNewNote")[g_opt.NotesEnabled?"show":"hide"]();$("#ddiAddNewSMS")[g_opt.SMSEnabled?"show":"hide"]();$("#topNav_bttn_search, #topNav_bttn_search_divider,#itopNav_bttn_search")[g_opt.SearchButtonEnabled?"show":"hide"]();$("#MEDD_21,#MEDD_99")[g_opt.SharingEnabled?"show":"hide"]();
$("#topNav_bttn_chat, #topNav_bttn_chat_divider")[g_opt.ChatEnabled&&g_opt.BrowserSupportsChat?"show":"hide"]();$("#StatusBar_settings_logout").attr("class",g_opt.UseSummaryToolBar?"iStatusBar_settings_logout_shell":"statusBar_settings_logout_shell");dropDown_ToggleTickByID("dropDown_settings_previewPane_"+GetPreviewPaneOrientation());gPreviewMode=GetOptionValue("WebMail-PreviewPaneOrientation");SetThemeToggle(gOptions.Theme,gOptions.AllowThemes);CustomizeForBrowser();SetMessageToolbarButtonsStatus();
var a=0;$("#topNav_logo_js, .topNav_bttn, .topNav_bttn_selected, .topNav_bttn_divider").each(function(){a+=$(this).outerWidth()});$("#tdTopNavLeft").width(a+60);ServerRequest("GET-MAILBOX-USAGE","",!0);gMailboxExpanded=GetOptionValue("WebMail-MailboxExpanded");gPublicFoldersExpanded=GetOptionValue("WebMail-PublicFoldersExpanded");gSharesExpanded=GetOptionValue("WebMail-SharesExpanded");gMyFilesExpanded=GetOptionValue("WebMail-MyFilesExpanded");gChangePasswordEnabled=GetOptionValue("Login Details");
gPOPRetrievalEnabled=GetOptionValue("POP Retrieval");gMailboxRedirectionEnabled=GetOptionValue("Mailbox Redirection");gAutoResponseEnabled=GetOptionValue("Auto Response");gFilteringEnabled=GetOptionValue("Filtering");gWhitelistEnabled=GetOptionValue("Whitelist");gBlacklistEnabled=GetOptionValue("Blacklist");gAutoCompleteMode=GetOptionValue("AutoComplete");gCalendaringEnabled=GetOptionValue("Calendaring Enabled");gTasksEnabled=GetOptionValue("Tasks Enabled");gPublishingEnabled="0"!=GetOption("Publish Access Status");
gGlobalAddressListEnabled=GetOptionValue("GlobalAddressList");gReportAsSpamEnabled=GetOptionValue("MessageReportAsSpam");gDownloadVDataEnabled=GetOptionValue("DownloadVData");gAllowSMSConversations=GetOptionValue("AllowSMSConversations");gSpamFilteringEnabled=GetOptionValue("SpamFiltering");gContactsEnabled=GetOptionValue("Contacts Enabled");gSpellCheckingEnabled=GetOptionValue("SpellChecking Enabled");gSelectOnCreate=GetOptionValue("SelectOnCreate");gActivityViewEnabled=GetOptionValue("ActivityView Enabled");
gSyncMLEnabled=GetOptionValue("SyncML Enabled");gPersonalisationEnabled=GetOptionValue("Personalisation Enabled");gMediaPlayerEnabled=GetOptionValue("WebMail-MediaPlayerEnabled");gServicesEnabled=GetOptionValue("Services Enabled");(gStartupPage=GetOption("WebMail-StartupPage"))&&0!=gStartupPage.length||(gStartupPage="AccountSummary");"Calendar"!=gStartupPage||gCalendaringEnabled||(gStartupPage="");gWhitelistEnabled||$("#AddToWhiteListButton, .toolbar_icon_whitelist").hide();gBlacklistEnabled||$("#AddToBlackListButton, .toolbar_icon_blacklist").hide();
gCalendaringEnabled||(g_opt.UseSummaryToolBar?$("#topNav_bttn_calendar").hide():$("#topNav_bttn_calendar").prev().addBack().hide(),$("#ddiAddNewAppt").hide());gTasksEnabled||(g_opt.UseSummaryToolBar?$("#topNav_bttn_tasks").hide():$("#topNav_bttn_tasks").prev().addBack().hide(),$("#ddiAddNewTask").hide());gContactsEnabled||(g_opt.UseSummaryToolBar?$("#topNav_bttn_contacts").hide():$("#topNav_bttn_contacts").prev().addBack().hide(),$("#AddToContactsButton").hide(),$("#ddiAddNewContact").hide(),$("#MEPUR_"+
POPUP_MENU_ID_ADD_CONTACT).hide());gActivityViewEnabled||(g_opt.UseSummaryToolBar?$("#topNav_bttn_stats").hide():$("#topNav_bttn_stats").prev().addBack().hide());LoadProfilePic()}}
function InitLayoutEmail(){var a=document.getElementById("divEmail");a.style.width="100%";a.style.height="100%";layoutEmail=$("#divEmail").layout(layoutSettings_Email);null==layoutSearchPage&&(layoutSearchPage=$("#divSearch").width("100px").height("100px").layout(layoutSettings_searchPage),$("#divSearch").width("100%").height("100%"))}function GetCenterPaneHeight(){return $("html").height()-layoutMain.state.north.innerHeight-layoutMain.state.south.innerHeight}
function SetListHeight(){var a=0;var b=document.getElementById("toolbar_primary_js").clientHeight;if(GetOption("WebMail-MessagePreviewPane"))gPreviewMode==VIEW_RIGHT?(a=0,c=GetCenterPaneHeight()):gPreviewMode==VIEW_BOTTOM&&(a=HEADER_ROW_HEIGHT,c=layoutEmailInner.state.north.innerHeight);else{var c=GetCenterPaneHeight();a=HEADER_ROW_HEIGHT}b=c-b;document.getElementById(LIST_CONTAINER).style.height=b+"px";document.getElementById(LIST_CONTAINER_INNER).style.height=b+"px";c=b-a;var d=document.getElementById(SCROLLBAR_DIV);
d&&(d.style.height=c+"px");gMsgListHeight=b-a;DataItemList_SetScrollRange()}function GetItemClassFromItemId(a){var b=0;a.ItemId.match("\\.VCF$")?b=1:a.ItemId.match("\\.CAL$")?b=2:a.ItemId.match("\\.TSK$")?b=3:folderPathMatches(a.FolderPath,FOLDER_NODE_NOTES)&&(b=4);return b}
function Search_Render_FirstColumn(a,b){var c="msg folder_icon";switch(GetItemClassFromItemId(a)){case 1:c="contact folder_icon";break;case 2:c="calendar folder_icon";break;case 3:c="tasks folder_icon";break;case 4:c="notes folder_icon"}return"<div class='"+c+"'></div><span>"+b+"</span>"}
function CloneAsNewInstance(a,b,c){a=$(a).clone(!0);a.find(":text,:file,:radio,:checkbox").each(function(){$(this).attr("id",$(this).attr("id")+c);$(this).val("")});a.find("a").each(function(){$(this).val("").attr("id",function(d,e){return c})});a.find("div,span,tr,td,iframe,textarea,select,table").each(function(){$(this).attr("id")&&$(this).attr({id:$(this).attr("id")+c})});a.attr("id",function(){return this.id+c}).appendTo(b)}
function DisableInputFields(a){$(a).find("input,textarea,select").each(function(){$(this).attr({disabled:"disabled"})})}
function ProcessSearchCmd(a){if(0<=jsonList.selectedIndex)switch(a=jsonList.Items[jsonList.selectedIndex],GetItemClassFromItemId(a)){case 0:SetPageContextMode(CONTEXT_READ);OpenMessage(a.ItemId,a.FolderPath,"View="+VIEW_SEARCH);break;case 1:SelectViewTab(TAB_VIEW_CONTACTS);OpenContact(a.ItemId);break;case 2:OpenCalendarItem(a.ItemId);break;case 3:SelectViewTab(TAB_VIEW_TASKS),SetPageContextMode(CONTEXT_TASKS,void 0,a.ItemId)}}
function Search_ItemSelected(a){$("#SelectedSearchItem").children().hide();var b=$(".toolbar_primary.searchPage .bttn_toolbar_primary_shell").hide();if(0<=a.selectedIndex){var c=a.Items[a.selectedIndex];a="";var d=GetItemClassFromItemId(c);switch(d){case 0:a="message";0==$("#divMessagePreview_search").length&&(CloneAsNewInstance("#divMessagePreview","#SelectedSearchItem","_search"),$("#ListUnsubscribeButton_search,#AddToContactsButton_search,#AddToWhiteListButton_search,#AddToBlackListButton_search").hide());
$("#divMessagePreview_search").show();ShowWait(t_("[ME_TXT-Loading]")+"...");window.setTimeout(function(){ServerRequest("GET-MESSAGE","Folder="+encodeURIComponent(c.FolderPath)+"&ID="+c.ItemId+"&BODY=0&targetinstance=search",!0)},100);break;case 1:a="contact";if(0==$("#divNewContact_search").length){$("#SelectedSearchItem").append($("<div id='divNewContact_search' class='popupWin_tabbedPanel_background'>"));CloneAsNewInstance("#GeneralTab","#divNewContact_search","_search");CloneAsNewInstance("#PersonalTab",
"#divNewContact_search","_search");CloneAsNewInstance("#CompanyTab","#divNewContact_search","_search");CloneAsNewInstance("#OtherTab","#divNewContact_search","_search");CloneAsNewInstance("#NotesTab","#divNewContact_search","_search");var e=new TabStrip(document.getElementById("divNewContact_search"));e.AddTab(t_("[ME_TXT-General]"),document.getElementById("GeneralTab_search"));e.AddTab(t_("[ME_TXT-Personal]"),document.getElementById("PersonalTab_search"));e.AddTab(t_("[ME_TXT-Business]"),document.getElementById("CompanyTab_search"));
e.AddTab(t_("[ME_TXT-Other]"),document.getElementById("OtherTab_search"));e.AddTab(t_("[ME_TXT-Notes]"),document.getElementById("NotesTab_search"));$("#btn_Edit_search").hide();$("#birthdayPickerLocation_search").empty();e=new InlineListsDatePicker("birthdayPicker_search",document.getElementById("birthdayPickerLocation_search"),"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"","",null,null,null,"datePicker_select_table");dateSelector_Config(e);arrDatePickers.birthdayPicker_search=e;DisableInputFields("#divNewContact_search")}$("#divNewContact_search").show();
ShowWait(t_("[ME_TXT-Loading]")+"...");window.setTimeout(function(){ServerRequest("GET-CONTACT","Folder="+encodeURIComponent(c.FolderPath)+"&ID="+c.ItemId+"&BODY=0&targetinstance=search",!0)},100);break;case 2:a="appointment";0==$("#divNewAppt_search").length&&($("#GeneralTabBody #trResource").hide(),$("#SelectedSearchItem").append($("<div id='divNewAppt_search' class='popupWin_tabbedPanel_background'>")),CloneAsNewInstance("#GeneralTabBody","#divNewAppt_search","_search"),CloneAsNewInstance("#RecurrenceTabBody",
"#divNewAppt_search","_search"),e=new TabStrip(document.getElementById("divNewAppt_search")),e.AddTab(t_("[ME_TXT-General]"),document.getElementById("GeneralTabBody_search")),e.AddTab(t_("[ME_TXT-Recurrence]"),document.getElementById("RecurrenceTabBody_search")),$("#apptStartTimeDPLocation_search").empty(),e=new InlineListsDatePicker("apptStartTimeDatePicker_search",document.getElementById("apptStartTimeDPLocation_search"),"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"","",null,null,null,"datePicker_select_table"),
dateSelector_Config(e),arrDatePickers.apptStartTimeDatePicker_search=e,$("#apptEndTimeDPLocation_search").empty(),e=new InlineListsDatePicker("apptEndTimeDatePicker_search",document.getElementById("apptEndTimeDPLocation_search"),"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"","",null,null,null,"datePicker_select_table"),dateSelector_Config(e),arrDatePickers.apptEndTimeDatePicker_search=e,$("#recurrencePatternStartDatePickerLocation_search,#recurrencePatternEndDatePickerLocation_search").empty(),
InitApptRecurDateFields("search"),DisableOKButton("btnAttendees_search",BTTN_FLOAT_LEFT),DisableInputFields("#divNewAppt_search"));$("#divNewAppt_search").show();ShowWait(t_("[ME_TXT-Loading]")+"...");window.setTimeout(function(){ServerRequest("GET-APPOINTMENT","Folder="+encodeURIComponent(c.FolderPath)+"&ID="+c.ItemId+"&targetinstance=search",!0)},100);break;case 3:a="task";0==$("#divTaskDetails_search").length&&($("#SelectedSearchItem").append($("<div id='divTaskDetails_search' class='popupWin_tabbedPanel_background'>")),
CloneAsNewInstance("#TaskDetails","#divTaskDetails_search","_search"),(new TabStrip(document.getElementById("divTaskDetails_search"))).AddTab(t_("[ME_TXT-General]"),document.getElementById("TaskDetails_search")),$("#startDatePickerLocation_search,#dueDatePickerLocation_search").empty(),e=new InlineListsDatePicker("startDatePicker_search",document.getElementById("startDatePickerLocation_search"),"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"","",null,null,null,"datePicker_select_table"),dateSelector_Config(e),
arrDatePickers.startDatePicker_search=e,e=new InlineListsDatePicker("dueDatePicker_search",document.getElementById("dueDatePickerLocation_search"),"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"","",null,null,null,"datePicker_select_table"),dateSelector_Config(e),arrDatePickers.dueDatePicker_search=e,DisableInputFields("#divTaskDetails_search"));$("#divTaskDetails_search").show();ShowWait(t_("[ME_TXT-Loading]")+"...");window.setTimeout(function(){ServerRequest("GET-TASK","Folder="+encodeURIComponent(c.FolderPath)+
"&ID="+c.ItemId+"&targetinstance=search",!0)},100);break;case 4:a="note",0==$("#divNewNote_search").length&&(CloneAsNewInstance("#divNewNote","#SelectedSearchItem","_search"),$("#divNewNote_search .optionsPanel_foot_bttns").css("visibility","hidden"),DisableInputFields("#divNewNote_search")),ShowWait(t_("[ME_TXT-Loading]")+"..."),window.setTimeout(function(){ServerRequest("GET-ITEM","Folder="+encodeURIComponent(c.FolderPath)+"&ID="+c.ItemId+"&targetinstance=search",!0)},100),$("#divNewNote_search").show()}4!=
d&&b.filter("."+a).show()}}function dateSelector_Config(a){a.todayButtonText=t_("[ME_TXT-Today]");a.selectionButtonText=t_("[ME_TXT-Selection]");a.selectNoneButtonText=t_("[ME_TXT-None]");a.prepare();a.setToDate(new Date)}function ShowSearchState(a){$("#ResultsList").html('<div class="noresults" style="width:100%;margin-top:5px;text-align:center;height:200px">'+a+"</div >")}function HideEmptySearchResults(){$("#ResultsList .noresults").hide()}
function SortSearchResults(a,b){jsonList_Sort(a,!0);jsonList_ShowData(jsonList,!1);jsonList_UpdateScrollContainer();ResizeListColumns();return!0}
function PerformMailboxSearch(){HideEmptySearchResults();var a={SearchQuery:$("#txtSearchQuery").val()};getTopAppWindow().ShowWait(t_("[ME_TXT-Pleasewait]")+"...");$.ajax({url:getAppServletURL()+"?Cmd=SEARCH-MAILBOX&ME_SID="+readCookie("MailEnable-SessionId")+"&ts="+(new Date).getTime()+"&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN,data:a,dataType:"json",error:function(){getTopAppWindow().HideWait();HandleAjaxError()},success:function(b){getTopAppWindow().HideWait();jsonList_Bind(jsonList,
b);jsonList.ColumnSort="SortSearchResults";jsonList_ShowData(jsonList,!1);jsonList_UpdateScrollContainer();ResizeListColumns();b.length&&0!=b.length||(ShowSearchState(t_("[ME_TXT-NoMatchingMessages]")),ShowAlert(t_("[ME_TXT-NoMatchingMessagesCaption]"),t_("[ME_TXT-NoMatchingMessages]"),!0))}})}
function SetFolderListHeight(){try{var a=document.getElementById("toolbar_primary_js").clientHeight,b=GetCenterPaneHeight()-a;document.getElementById("divFolderList").style.height=b+"px";"1"==gOptions["WebMail-ShowFavourites"]&&0<GetFavouriteCount()&&$("#bodyCol_shell_folderList").height($("#divFolderList").height()-$("#bodyCol_shell_favouritesList").height())}catch(c){}}
function ResizeEmailInner(){layoutEmailInner.resizeAll();GetOptionValue("WebMail-MessagePreviewPane")||gBrowserType!=BROWSER_TYPE_CHROME&&gBrowserType!=BROWSER_TYPE_SAFARI&&gBrowserType!=BROWSER_TYPE_OPERA||($("#divMsgList").width("100%"),layoutEmailInner.sizePane("west",layoutEmail.state.center.innerWidth))}
function BrowserResize(){try{gPreviewMode==VIEW_RIGHT?$("div.dataTable_scrollbar_top").hide():gPreviewMode==VIEW_BOTTOM&&$("div.dataTable_scrollbar_top").show(),SetListHeight(),SetFolderListHeight(),DataItemList_RewriteTableRows(LIST_ID,gDataListTopOfPageOrdinal-1,arrTableColumns,"resize"),ConfigureListItemOverlay(),resizeMsgHeaderSubject(),ResizePreviewPanel(),document.getElementById("custBg_shell_js").style.height=GetCenterPaneHeight()+20+"px",window.setTimeout(function(){ResizeSearchResultsPane()},
500)}catch(a){}}function ResizeListColumns(){try{$("#ResultsList .sysListTableHeader .col_grow").width(0);var a=Math.max($("#ResultsList .sysListTableHeader .col_last").width()-10,0);$("#ResultsList .col_grow").width(a)}catch(b){}return!0}function ResizeSearchResultsPane(){try{ResizeListColumns();var a=$("#divSearch").offsetHeight;$(".sysListTable_shell").height(a);jsonList_UpdateScrollContainer()}catch(b){}return!0}
function ResizePreviewPanel(a){a||$("#divSearch").is(":visible")&&0<$("#msgHeader_shell_js_search").length&&(a="search");if(!a&&"none"==document.getElementById("divPreviewPane").style.display)return!0;var b=document.getElementById("toolbar_primary_js").offsetHeight,c=getItemInstance("msgHeader_shell_js",a).offsetHeight,d=0;var e=GetCenterPaneHeight();gPreviewMode==VIEW_RIGHT||"search"==a?d=e-b:gPreviewMode==VIEW_BOTTOM&&(d=layoutEmailInner.state.north.isClosed?e-RESIZER_BAR_CLOSED_WIDTH:e-layoutEmailInner.state.north.innerHeight-
RESIZER_BAR_OPEN_WIDTH);b=d-c-3*HEADERSHELL_PADDING;0>b&&(b=10);getItemInstance("bodyCol_msg_shell_js",a).style.height=b+"px";document.getElementById("divLoadingImg").style.top=d/2-32+"px";if(d=getItemInstance("ifPreviewBody",a))d.style.height=(b-3).toString()+"px",d.style.width="100%";resizeMsgHeaderSubject(0,a)}var TOOLBAR_HEIGHT=28;function ResizeToolbarIcons(a){if(gPreviewMode==VIEW_RIGHT&&!PreviewPaneIsVisible())return!1;MoveToolbarIcons()}
function ProcessXMLResult(a,b){if(void 0==a)return alert("responseXML == undefined"),!1;a=a.getElementsByTagName("BASEELEMENT")[0];if(null==a)return ShowAlert(t_("[ME_TXT-Error]"),"Server failure!",!0),!1;b=GetXMLValue(a.attributes.getNamedItem("RID"));return g_opt.Concurrency&&b&&0<b.length?registerResponse(a,b):doProcessXMLResult(a,null)}
function UpdateFavourites(a,b){if(a&&b){for(var c in a){var d="";if(a[c].URI){var e=RegExp("^SF:([^/]*)[/]([^/]*)(.*)$").exec(a[c].URI);e&&4<=e.length?d="<Root-Favourites>/Mailbox-"+e[2]+e[3].replace(/\\/g,"/"):console.log("invalid URI")}else a[c].RelativeFolderPath&&(d="<Root-Favourites>/Mailbox-"+g_opt.Mailbox+a[c].RelativeFolderPath.replace(/\\/g,"/"));if(d=b[d])d.UnreadCount=a[c].UnreadCount}TreeViewClearNodes("FavTree");DrawTreeNodes(b,"FavTree","<Root-Favourites>");SetFolderListHeight()}}
function doProcessXMLResult(a,b){b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);if("5"==b)return a=a.getElementsByTagName("ERROR_DESCRIPTION"),0<a.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(a[0]),!0),!1;var c=a.attributes.getNamedItem("SCHEMA"),d=a.attributes.getNamedItem("METHOD"),e,f;c&&(e=GetXMLValue(c));d&&(f=GetXMLValue(d));"TIMEOUT"==e&&gCalcTimer&&gNewMailMonitor&&(window.location="Timeout.aspx");if("FOLDERS"==e)return ProcessFolderList("",arrTree,"METree",a,g_opt.Mailbox,
!0),bViewSelected||(bViewSelected=!0,bNotInbox||(DisplayInbox(),HidePageLoad(0),HideCurtain(0),StartMonitors())),!0;if("PUBFOLDERS"==e)return ProcessFolderList("",arrTree,"METree",a,"Public",!0),!0;if("FILES"==e)return ProcessFolderList("",arrTree,"METree",a,"File$",!0),!0;if("MESSAGE"==e)return HideWait(),ProcessMessage(a),!0;"MAILBOX-USAGE"==e&&UpdateUsage(a);if("ATTACHMENTS"==e)return ProcessAttachments(a,null),!0;if("ITEM"==e){try{TargetInstance=GetXMLValue(a.childNodes[0].attributes.getNamedItem("targetinstance"))}catch(k){}HideWait();
ProcessNote(a,TargetInstance);return!0}if("GET-TASK"==f){try{TargetInstance=GetXMLValue(a.attributes.getNamedItem("targetinstance"))}catch(k){}HideWait();ProcessTask(a,TargetInstance);return!0}if("RESULT"==e){try{TargetInstance=GetXMLValue(a.attributes.getNamedItem("targetinstance"))}catch(k){}if("GET-MAILBOX-SHARED-STATUS"==f)ProcessMailboxSharedStatus(a);else if("QUICK-REPLY"==f)e=t_("[ME_TXT-Messagesentsuccessfully]"),"0"==b?(e=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-QuickReply]"),
e,!0)):ShowNotification(e);else if("SEND-MESSAGE"==f)e=t_("[ME_TXT-Messagesentsuccessfully]"),"0"==b?(e=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-Compose]"),e,!0)):ShowNotification(e);else if("DELETE-MESSAGE"==f)ProcessDeleteResult(a,LIST_ID);else if("MOVE-MESSAGE"==f)ProcessMoveResult(a,LIST_ID);else if("REFRESH-FOLDER"==f)ProcessFolderRefresh(a,LIST_ID);else if("COPY-MESSAGE"==f)ProcessCopyResult(a,LIST_ID);else if("LIST-CONNECTIONS"==f)try{ProcessSharesList("",
arrTree,"METree",a),UpdateFavourites(arrTree,arrFavourites)}catch(k){}else if("REMOVE-CONNECTION"==f)ProcessRemoveShareResult(a);else if("ADD-CONTACT"==f)ProcessSaveContactResult(a,MODE_ADD);else if("EDIT-CONTACT"==f)ProcessSaveContactResult(a,MODE_EDIT);else if("GET-CONTACT-SUMMARY"==f)ProcessCardLookUp(a);else if("GET-APPOINTMENT"==f)ProcessGetAppointment(a,TargetInstance),HideWait();else if("GET-CONTACT"==f){b=null;try{b=arrDatePickers[getItemInstanceName("birthdayPicker",TargetInstance)]}catch(k){}ProcessContactDetails(a,
b,TargetInstance);HideWait()}else if("HAS-ACCESS"==f)ProcessGetAccessResult(a);else if("CREATE-FOLDER"==f)ProcessCreateFolderResult(a);else if("DELETE-FOLDER"==f)ProcessDeleteFolderResult(a);else if("EMPTY-FOLDER"==f)ProcessEmptyFolderResult(a);else if("RENAME-FOLDER"==f)ProcessRenameFolderResult(a);else if("ADD-SHARE"==f)ProcessShareFolderResult(a);else if("CHECK-NEW-MAIL"==f)gNewMailMonitor&&ProcessCheckNewMailResult(a),gAllowPageActions=!0;else if("CHECK-APPOINTMENT-REMINDER"==f)gApptMonitor&&
ProcessCheckAppointmentReminderResult(a),gAllowPageActions=!0;else if("ADD-WHITELIST"==f)ProcessAddWhitelistResult(a);else if("ADD-BLACKLIST"==f)ProcessAddBlacklistResult(a);else if("APPOINTMENT-ACCEPT"==f)ProcessAppointmentAccept(a);else if("APPOINTMENT-DECLINE"==f)ProcessAppointmentDecline(a);else if("APPOINTMENT-TENTATIVE"==f)ProcessAppointmentTentative(a);else if("APPOINTMENT-UPDATE-ATTENDEE-STATUS"==f)ProcessAppointmentUpdate(a);else if("APPOINTMENT-UPDATE"==f)ProcessAppointmentUpdate(a);else if("APPOINTMENT-CANCEL"==
f)ProcessAppointmentCancel(a);else if("SET-PROPERTY"==f)ProcessSetPropertyResult(a),gSetPropsDoneCount==gSetPropsItemCount&&(Async_UnlockUI(),gKeepShowingWait=!1);else if("ADD-APPOINTMENT"==f)if(1==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])){try{var g=GetXMLValue(a.getElementsByTagName("STARTDATE")[0]),h=$("#frmCalendar").contents().find("#frameAppointments");0<h.length&&h[0].contentWindow.refreshCalendar();getTopAppWindow().frames.frmCalendar.frames.frameDatePicker.UpdateFreeBusyDays(g)}catch(k){}try{getTopAppWindow().ShowNotification(t_("[ME_TXT-AppointmentSaved]"))}catch(k){}}else try{getTopAppWindow().ShowNotification(t_("[ME_TXT-FailedToCreateAppointment]"))}catch(k){}else"REPORT-SPAM"==
f?(HideWait(),ProcessReportSpamResult(a,LIST_ID)):"CHECK-FREEBUSY"==f&&ProcessGetFreeBusy(a);window.status=t_("[ME_TXT-Done]");return!0}"TASKS"==e&&"ADD-TASK"==f&&ProcessAddTaskResult(a);"MESSAGES"==e&&ProcessMessageListResponse(a,b,f);"OPTIONS"==e&&(ProcessOptionsResult(a),ProcessSystemOptionsResult(a),(a=GetOptionValue("DefaultAddress"))&&SetDefaultAddress(a));window.status=t_("[ME_TXT-Done]");return!0}
function ProcessMessageListResponse(a,b,c){var d=a.attributes,e=GetXMLValue(d.getNamedItem("FOLDER_PATH")),f=parseInt(GetXMLValue(d.getNamedItem("UNREAD_MESSAGES"))),g=parseInt(GetXMLValue(d.getNamedItem("TOTAL_ITEMS")));d=parseInt(GetXMLValue(d.getNamedItem("LASTUID")));DataItemList_ValidateContext(a);if("0"==b)b=t_("[ME_TXT-CouldNotLoadFolder...]"),(a=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]))&&""!=a&&(b=b+"\n\n"+a),Async_UnlockUI(),ShowAlert(t_("[ME_TXT-Error]"),b,!0);else{try{layoutEmailInner||
gEmailViewInitialised||(InitEmailView(),InitPreviewPaneLayout(),gEmailViewInitialised=!0);IsOutboundFolder(e)?(gPreviewMode!=VIEW_RIGHT&&(DataItemList_SetColumnHeader(LIST_ID,5,t_("[ME_TXT-To]"),"To",t_("[ME_TXT-SortByRecipient]")),arrTableColumns[5].SortColumn="To"),$("#liFrom").text(t_("[ME_TXT-LookIn]")+" "+t_("[ME_TXT-ToField]")),$("#liFromSort").text(t_("[ME_TXT-Recipients]"))):(gPreviewMode!=VIEW_RIGHT&&(DataItemList_SetColumnHeader(LIST_ID,5,t_("[ME_TXT-From]"),"From",t_("[ME_TXT-SortBySender]")),
arrTableColumns[5].SortColumn="From"),$("#liFrom").text(t_("[ME_TXT-LookIn]")+" "+t_("[ME_TXT-FromField]")),$("#liFromSort").text(t_("[ME_TXT-Sender]")));ProcessMessageList(a,arrTableColumns);ProcessSelectedIDs(a);ConfigureListItemOverlay();0<gTotalItems&&gSelectedIM.GetSize()==gTotalItems&&SetSelectAllCheckbox(!0);ShowStatusBarValues();SetStatusBarValues();SetMessageToolbarButtonsStatus();if(gCurrentView!=VIEW_SHARES)"SEARCH-MESSAGES"!=c&&(-1!=e.toUpperCase().indexOf("/PUBLIC/",0)?(FolderTreeSetUnreadCount(arrPubFolders,
e,f,"METree"),FolderTreeSetTotalCount(arrPubFolders,e,g,"METree")):(FolderTreeSetUnreadCount(arrTree,e,f,"METree"),FolderTreeSetTotalCount(arrTree,e,g,"METree"),FolderTreeSetProperty(arrTree,e,"LastUID",d),IsDraftsFolder(e)&&FolderTreeSetUnreadCountDisplay(arrTree,e,g)));else{var h=GetXMLValue(a.getElementsByTagName("MAILBOX")[0]);gSelectedSharedNodePath=GetDefaultSharesRootNode()+"/Mailbox-"+h+e;"SEARCH-MESSAGES"!=c&&(FolderTreeSetUnreadCount(arrTree,gSelectedSharedNodePath,f,"METree"),FolderTreeSetTotalCount(arrTree,
gSelectedSharedNodePath,g,"METree"),IsDraftsFolder(e)&&FolderTreeSetUnreadCountDisplay(arrTree,gSelectedSharedNodePath,g))}var k=CalculateWholeRowsPerPage(gMsgListHeight,gUnitScrollLength);gTotalItems<=k?ScrollBar_Hide(SCROLLBAR_DIV,SCROLLBAR_TD):(DataItemList_SetScrollRange(),DataItemList_UpdateScrollState(gPreviewMode),"SEARCH-MESSAGES"==c&&ScrollBar_SetUnitScrollPos(SCROLLBAR_DIV,SCROLLBAR_TD,0,gUnitScrollLength))}catch(l){}gKeepShowingWait||Async_UnlockUI()}}
function ProcessMailboxSharedStatus(a){a=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);1==parseInt(a)&&(gMailboxIsShared=1)}function GetViewFromSelectedNode(a){return a.match("^"+GetDefaultPublicRootNode())?VIEW_PUBLIC:a.match("^"+RegExp.escape(GetDefaultFilesRootNode()))?VIEW_FILES:a.match("^"+GetDefaultSharesRootNode())?VIEW_SHARES:a.match("^"+GetDefaultOptionsRootNode())?VIEW_OPTIONS:VIEW_PERSONAL}
function GetRelativeFolderPathFromTreeViewPath(a){var b=a.indexOf("/"),c="/";if(0<b){if(isSharedFolder(a))return a;c=a.substring(b)}b=GetDefaultFilesRootNode();b=b.replace(/\$/g,"\\$");if(a.match(RegExp("^"+b+"[/]?"),"i"))return a;a.match(RegExp("^"+GetDefaultPublicRootNode()+"[/]?"),"i")?c="/Public"+(c.match(RegExp("^/"))?"":"/")+c:"/"!=c&&c.match(/\/$/)&&(c=c.substring(0,c.length-1));return c}
function IsPopupMenuActive(a){return IsElementAAncestorOfElementB(document.getElementById(LIST_ID),a)||IsElementAAncestorOfElementB(document.getElementById("METree"),a)||IsElementAAncestorOfElementB(document.getElementById("FavTree"),a)}function IsOutboundFolder(a){return RegExp("^(/Drafts|/Sent Items)(/.*$|$)","i").test(a)}
function GetURIFromNodeKey(a){var b="SF:"+g_opt.Postoffice+"/",c=RegExp("^Root-Shares/Mailbox-([^/]*)(.*$)");c=a.match(c);c||(c=RegExp("^Root-([^/]*)(.*$)"),c=a.match(c));c||(c=RegExp("^<Root-Favourites>/Mailbox-([^/]*)(.*$)"),c=a.match(c));c||(c=RegExp("^<Root-(Public)>(.*$)"),(c=a.match(c))&&(c[1]="$PUBLIC"));c||(c=RegExp("^(\\$FILEROOT)(.*$)"),(c=a.match(c))&&(c[1]="$FILEROOT"));c?(b+=c[1],3<=c.length&&(b+=c[2].replace(/\\/g,"/"))):console.log("GetURIFromNodeKey incomplete parse");return b}
function IsPopupMenuCommandActive(a,b){var c=!0,d=GetSelectedFolderPath(),e=isFavouritesFolder(a);if("TREMPTY"==a.toUpperCase())return b==POPUP_MENU_ID_PASTE?c=supported_clip()?CopiedDataReadyToBePasted():!1:!1;var f=!1;arrTree[a]&&(f=arrTree[a].IsShared);var g=!1;try{g=arrTree[a].ShareType}catch(n){}var h=ItemsArray_Find(a),k=-1!=h,l=!1;k&&(l="IPM.Note.Mobile.SMS"==oItemsArray[h].Class);var m=IsOutboundFolder(GetSelectedFolderPath());if(b!=POPUP_MENU_ID_REPLY&&b!=POPUP_MENU_ID_QUICK_REPLY||!HasMultipleItemsSelected()&&
"/Drafts"!=d&&!l)if(b==POPUP_MENU_ID_OPEN&&HasMultipleItemsSelected())c=!1;else if(b==POPUP_MENU_ID_REPLY_ALL&&(HasMultipleItemsSelected()||"/Drafts"==d||l))c=!1;else if(b!=POPUP_MENU_ID_FORWARD||!HasMultipleItemsSelected()&&"/Drafts"!=d)if(b==POPUP_MENU_ID_VIEW_HEADERS&&HasMultipleItemsSelected())c=!1;else if(b==POPUP_MENU_ID_DOWNLOAD_SOURCE&&HasMultipleItemsSelected())c=!1;else if(b==POPUP_MENU_ID_WHITELIST&&(HasMultipleItemsSelected()||l))c=!1;else if(b==POPUP_MENU_ID_BLACKLIST&&(HasMultipleItemsSelected()||
l))c=!1;else if(b==POPUP_MENU_ID_ADD_CONTACT&&(HasMultipleItemsSelected()||l))c=!1;else if(b==POPUP_MENU_ID_PRINT&&(HasMultipleItemsSelected()||l))c=!1;else if(b==POPUP_MENU_ID_MARK_AS_UNREAD)c=k&&1==oItemsArray[h].Read;else if(b==POPUP_MENU_ID_MARK_AS_READ)c=k&&1!=oItemsArray[h].Read;else if(b==POPUP_MENU_ID_FLAG)c=!m&&k&&1!=oItemsArray[h].Flagged;else if(b==POPUP_MENU_ID_UNFLAG)c=!m&&k&&1==oItemsArray[h].Flagged;else if(b==POPUP_MENU_ID_REPORT_AS_SPAM)c=gReportAsSpamEnabled&&gCurrentView!=VIEW_SHARES&&
!l;else if(b==POPUP_MENU_ID_COPY)c=supported_clip()&&!l;else if(b==POPUP_MENU_ID_PASTE)c=!supported_clip()||l?!1:CopiedDataReadyToBePasted();else if(b==POPUP_MENU_ID_CREATE_FOLDER)a==GetDefaultSharesRootNode()&&(c=!1),e&&(c=!1),g&&(c=!1);else if(b==POPUP_MENU_ID_RENAME_FOLDER){if(a==GetDefaultMailboxRootNode(g_opt.Mailbox)||a==GetDefaultFilesRootNode()||a==GetDefaultSharesRootNode())c=!1;e&&(c=!1);isSpecialFolder(a)&&(c=!1);a.match(/^Root-Shares(\/Mailbox-[^/]*)*$/i)&&(c=!1);g&&(c=!1);a.match(RegExp("^"+
GetDefaultPublicRootNode()+"$"))&&(c=!1)}else if(b==POPUP_MENU_ID_DELETE_FOLDER){if(a==GetDefaultMailboxRootNode(g_opt.Mailbox)||a==GetDefaultFilesRootNode()||a==GetDefaultSharesRootNode())c=!1;e&&(c=!1);a.match(/^Root-Shares(\/Mailbox-[^/]*)*$/i)&&(c=!1);isSpecialFolder(a)&&(c=!1);a.match(RegExp("^"+GetDefaultPublicRootNode()+"$"))&&(c=!1)}else if(b==POPUP_MENU_ID_SHARE_FOLDER){if(!g_opt.SharingEnabled||GetViewFromSelectedNode(a)==VIEW_PUBLIC||GetViewFromSelectedNode(a)==VIEW_SHARES||f||GetViewFromSelectedNode(a)==
VIEW_FILES)c=!1;e&&(c=!1)}else if(b==POPUP_MENU_ID_SET_PERMISSIONS)g_opt.SharingEnabled&&GetViewFromSelectedNode(a)!=VIEW_PUBLIC&&GetViewFromSelectedNode(a)!=VIEW_SHARES&&f||(c=!1);else if(b==POPUP_MENU_ID_ADDTOFAVOURITES)a==GetDefaultSharesRootNode()||isFavouritesFolder(a)||GetViewFromSelectedNode(a)==VIEW_FILES?c=!1:(c="1"==gOptions["WebMail-ShowFavourites"],a.match(/^Root-Shares(\/Mailbox-[^/]*)*$/i)&&(c=!1),c&&(a=GetURIFromNodeKey(a),c=!IsFavourite(a)));else if(b==POPUP_MENU_ID_REMOVEFROMFAVOURITES)if(a==
GetDefaultSharesRootNode()||GetViewFromSelectedNode(a)==VIEW_FILES)c=!1;else{if(c="1"==gOptions["WebMail-ShowFavourites"])a=GetURIFromNodeKey(a),c=IsFavourite(a)}else b==POPUP_MENU_ID_ARCHIVE?(e&&(c=!1),(c=c&&g_opt.ArchivingEnabled)&&(c=GetViewFromSelectedNode(a)!=VIEW_SHARES&&GetViewFromSelectedNode(a)!=VIEW_PUBLIC&&GetViewFromSelectedNode(a)!=VIEW_FILES&&!a.match(/\/Contacts$/i)&&!a.match(/\/Calendar$/i)&&!a.match(/\/Tasks$/i))):b==POPUP_MENU_ID_UNSHARE_FOLDER?g_opt.SharingEnabled&&GetViewFromSelectedNode(a)!=
VIEW_PUBLIC&&GetViewFromSelectedNode(a)!=VIEW_SHARES&&f||(c=!1):b==POPUP_MENU_ID_DISCONNECT?c=GetViewFromSelectedNode(a)==VIEW_SHARES&&f:b==POPUP_MENU_ID_PASTE_INTO_FOLDER?c=supported_clip()&&CopiedDataReadyToBePasted()&&a!=GetDefaultMailboxRootNode(g_opt.Mailbox)&&!a.match(/\/Calendar$/i)&&!a.match(/\/Contacts$/i)&&!a.match(/\/Tasks$/i):b==POPUP_MENU_ID_WHITELIST?c=gWhitelistEnabled&&!l:b==POPUP_MENU_ID_BLACKLIST?c=gBlacklistEnabled&&!l:b==POPUP_MENU_ID_DOWNLOAD?c=gDownloadVDataEnabled&&a.match(/\/Calendar$/i):
b==POPUP_MENU_ID_EMPTY_FOLDER?(c=GetViewFromSelectedNode(a)!=VIEW_SHARES&&GetViewFromSelectedNode(a)!=VIEW_PUBLIC&&GetViewFromSelectedNode(a)!=VIEW_FILES&&!a.match(/\/Contacts$/i)&&!a.match(/\/Calendar$/i)&&!a.match(/\/Tasks$/i),e&&(c=!1),a.match(RegExp("^"+GetDefaultMailboxRootNode(g_opt.Mailbox)+"$"))&&(c=!1)):c=!0;else c=!1;else c=!1;return c}function FormatReplySubject(a){if(void 0==a)return"";a.match(/^re:/i)||(a=a.replace(/^fw:/i,""),a="RE: "+a);return a}
function PopulateQuickReplyFields(a){a=ItemsArray_Find(a);var b=oItemsArray[a];a=b.From_Full;b=b.Subject;a=a.replace(/^</,"");a=a.replace(/>$/,"");b=FormatReplySubject(b);PopulateQuickComposeFields(a,b)}function PopulateQuickComposeFields(a,b,c){$("#QuickReplyTo").val(a);$("#QuickReplySubject").val(b);$("#QuickReplyText").val(c)}
function SendQuickReply(){var a=$("#QuickReplyText").val(),b=$("#QuickReplyTo").val();"Reply"==$("#QuickReplyDialogDiv").data("Mode")?a?ServerRequest("QUICK-REPLY","ID="+$("#QuickReplyDialogDiv").data("MessageID")+"&Folder="+encodeURIComponent($("#QuickReplyDialogDiv").data("Folder"))+"&Reply="+encodeURIComponent(a),!0):ShowAlert(t_("[ME_TXT-QuickReply]"),t_("[ME_TXT-FieldCannotBeEmpty]")):b?ServerRequest("SEND-MESSAGE","MsgBody="+a+"&Subject="+$("#QuickReplySubject").val()+"&ToRecipients="+b,!0):
ShowAlert(t_("[ME_TXT-Compose]"),t_("[ME_TXT-Youmustspecifyatleastonerecipienttoamailmessage.]"))}function NormalisePathOnDisk(a){null!=a&&(a=a.replace(/'/g,"\\'"));return a}function NormaliseResourcePath(a){null!=a&&(a=a.replace(/\\/g,"/"));return a}function getFoldersByClass(a,b){var c=getTopAppWindow(),d=c.arrTree;if(d)for(var e in d)if(d[e].ContainerClass==b){var f=c.NormaliseResourcePath(e);a[f]=d[e]}return a}
function GetKeyFromURI(a){return(GetDefaultSharesRootNode("")+"/"+a).replace(RegExp("SF:[^/]*/"),"Mailbox-")}
function fetchConnectionsByClass(a,b){var c=getTopAppWindow();b={Cmd:"LIST-CONNECTIONS",Filter:b,ME_SID:readCookie("MailEnable-SessionId"),ME_VALIDATIONTOKEN:c.g_opt.ME_VALIDATIONTOKEN};$.ajax({url:"../../servlet/asyncrequest.aspx",data:b,async:!1,success:function(d){ErrorValue="1";ErrorDetails="";"1"==ErrorValue?$(d).find("CONNECTION").each(function(){var e=$(this).find("URI").text(),f=GetKeyFromURI(e);a[f]={};a[f].AccessLevel=$(this).find("ACCESSLEVEL").text();a[f].URI=e;a[f].RelativeFolderPath=
$(this).find("RELATIVE_FOLDER_PATH").text();a[f].ShareType="1"}):c.ShowNotification(t_("[ME_TXT-Error]")+": "+ErrorDetails)},dataType:"xml"})}
function fetchFoldersByClass(a,b){var c=getTopAppWindow();b={Cmd:"FIND-FOLDERS",Filter:b,ME_SID:readCookie("MailEnable-SessionId"),ME_VALIDATIONTOKEN:c.g_opt.ME_VALIDATIONTOKEN};$.ajax({url:"../../servlet/asyncrequest.aspx",data:b,async:!1,success:function(d){ErrorValue="1";ErrorDetails="";"1"==ErrorValue?$(d).find("ELEMENT").each(function(){var e=c.GetDefaultMailboxRootNode(c.g_opt.Mailbox)+c.NormaliseResourcePath($(this).find("PHYSICAL_RELATIVE_FOLDER_PATH").text());a[e]={};a[e].RelativeFolderPath=
$(this).find("RELATIVE_FOLDER_PATH").text();a[e].RelativePathOnDisk=$(this).find("PHYSICAL_RELATIVE_FOLDER_PATH").text();a[e].AccessLevel="F"}):c.ShowNotification(t_("[ME_TXT-Error]")+": "+ErrorDetails)},dataType:"xml"})}
function ProcessPopUp(a,b){var c="menudiv",d=GetSelectedFolderPath();d=d.replace(/\\/i,"/");isSharedFolder(d)||"/"!=d.substr(0,1)&&(d="/"+d);switch(a){case "Open":"/Drafts"==d?DoCompose(!1):OpenMessage(gPopupItemID,GetSelectedFolderPath());break;case "Reply":ProcessComposeCmd("Reply",SELECTED_POPUP_ITEM);break;case "QuickReply":QuickReply(gPopupItemID,d);break;case "ReplyAll":ProcessComposeCmd("ReplyAll",SELECTED_POPUP_ITEM);break;case "Forward":ProcessComposeCmd("Forward",SELECTED_POPUP_ITEM);break;
case "Delete":gSelectedIM.ItemExists(gPopupItemID)?DeleteSelectedListItems():(HidePreviewPane(),b||(DataItemList_UnselectAllRows(LIST_ID),DataItemList_SelectRow(LIST_ID,gPopupItemID)),DeleteMessage(gPopupItemID,d));break;case "MarkAsRead":ShowWait(t_("[ME_TXT-Pleasewait]")+"...");1<DataItemList_GetSelectedRowCount(LIST_ID)?SetReadStatusSelectedMessages(LIST_ID,"READ",d):0==oItemsArray[ItemsArray_Find(gPopupItemID)].Read&&SetObjectProperty(d,gPopupItemID,"READ","",!0);break;case "MarkAsUnread":clearTimeout(gMarkAsReadTimeout);
ShowWait(t_("[ME_TXT-Pleasewait]")+"...");1<DataItemList_GetSelectedRowCount(LIST_ID)?SetReadStatusSelectedMessages(LIST_ID,"UNREAD",d):1==oItemsArray[ItemsArray_Find(gPopupItemID)].Read&&SetObjectProperty(d,gPopupItemID,"UNREAD","",!0);break;case "Flag":ShowWait(t_("[ME_TXT-Pleasewait]")+"...");1<DataItemList_GetSelectedRowCount(LIST_ID)?SetReadStatusSelectedMessages(LIST_ID,"FLAGGED",d):0==oItemsArray[ItemsArray_Find(gPopupItemID)].Flagged&&SetObjectProperty(d,gPopupItemID,"FLAGGED","",!0);break;
case "Unflag":ShowWait(t_("[ME_TXT-Pleasewait]")+"...");1<DataItemList_GetSelectedRowCount(LIST_ID)?SetReadStatusSelectedMessages(LIST_ID,"UNFLAGGED",d):1==oItemsArray[ItemsArray_Find(gPopupItemID)].Flagged&&SetObjectProperty(d,gPopupItemID,"UNFLAGGED","",!0);break;case "ReportAsSpam":ShowWait(t_("[ME_TXT-Pleasewait]")+"...");1<DataItemList_GetSelectedRowCount(LIST_ID)?ReportSelectedMessagesAsSpam(null,d):ReportSelectedMessagesAsSpam(gPopupItemID,d);break;case "AddToContacts":AddToContacts(!0,gPopupItemID);
break;case "Whitelist":case "Blacklist":b=oItemsArray[ItemsArray_Find(gPopupItemID)].From_Full;(b=RegExp("<?([^@]+@[^.@][^@]*.[A-Za-z]{2,})>?").exec(b))?(b=b[1],ServerRequest("ADD-"+a.toUpperCase(),"Address="+b,!0)):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Couldnotfindvalidsenderemailaddressformessage]"),!0);break;case "DownloadSource":DownloadSource(gPopupItemID);break;case "ViewHeaders":ViewHeaders(gPopupItemID);break;case "Copy":1<DataItemList_GetSelectedRowCount(LIST_ID)?CopySelectedMessages(LIST_ID,
d):CopyMessage(gPopupItemID,d);break;case "Paste":PasteMessages(d);break;case "Print":ME_Print()}if(gPopupItemID)switch(a){case "CreateFolder":c="folderTreeContextMenuDiv";CreateNewFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID),arrTree[gPopupItemID].FolderName);break;case "RenameFolder":c="folderTreeContextMenuDiv";RenameFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID),arrTree[gPopupItemID].FolderName);break;case "DeleteFolder":c="folderTreeContextMenuDiv";DeleteFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID),
arrTree[gPopupItemID].FolderName);break;case "EmptyFolder":c="folderTreeContextMenuDiv";EmptyFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));break;case "ShareFolder":c="folderTreeContextMenuDiv";ShareFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));break;case "UnShareFolder":c="folderTreeContextMenuDiv";UnShareFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));break;case "SetPermissions":c="folderTreeContextMenuDiv";SetPermissions(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));
break;case "DisconnectFromShare":c="folderTreeContextMenuDiv";DisconnectFromShare(gPopupItemID);break;case "PasteIntoFolder":c="folderTreeContextMenuDiv";PasteMessages(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));break;case "Archive":c="folderTreeContextMenuDiv";ArchiveFolder(GetRelativeFolderPathFromTreeViewPath(gPopupItemID));break;case "AddToFavourites":c="folderTreeContextMenuDiv";a=GetURIFromNodeKey(gPopupItemID);d=ParseURI(a);b="<Root-Favourites>/Mailbox-"+d[2]+d[3];d=GetFavouriteDisplayName(d,
arrTree[gPopupItemID].RelativeFolderPath);var e="IPF.Note";arrTree[gPopupItemID].ContainerClass&&(e=arrTree[gPopupItemID].ContainerClass);TreeNodesAppend(arrFavourites,b,!1,!1,!1,0,d,a,0,0,!1,!1,e).URI=a;$("#bodyCol_shell_favouritesList").show();UpdateFavourites(arrTree,arrFavourites);SetOption("WebMail-Favourites",AddFavourite(a),!0,0,0);break;case "RemoveFromFavourites":c="folderTreeContextMenuDiv";a=GetURIFromNodeKey(gPopupItemID).toLowerCase();0<GetFavouriteCount()&&(b=gPopupItemID.replace("Root-Shares/Mailbox-",
"<Root-Favourites>/Mailbox-"),TreeNodesRemove(arrFavourites,b,"<Root-Favourites>"),UpdateFavourites(arrTree,arrFavourites));SetOption("WebMail-Favourites",RemoveFavourite(a),!0,0,0);0==GetFavouriteCount()&&$("#bodyCol_shell_favouritesList").hide();break;case "Download":a=getAppServletURL()+"?Cmd=GET-CALENDAR&TS="+(new Date).getTime()+"&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN,window.open(a,"_blank")}PopUp_HideMenu(c);return!0}
function ReportCurrentMessageAsSpam(){ReportSelectedMessagesAsSpam(gSelectedMessageID,GetSelectedFolderPath())}function ReportSelectedMessagesAsSpam(a,b){if(!gAllowPageActions)return!1;var c=0;if(a)c=a;else{a=new StringBuffer;var d=gSelectedIM.GetItems(),e;for(e in d)0<c&&a.append(","),a.append(d[e]),c++;c=a.toString()}0<c.length&&ServerRequest("REPORT-SPAM","Folder="+b+"&ObjectID="+c,!1)}
function ProcessReportSpamResult(a,b){var c=0,d="",e=null,f=!1;if(a.getElementsByTagName("MESSAGE"))try{e=a.getElementsByTagName("MESSAGE"),c=e.length}catch(k){return!0}a=DataItemList_GetFirstSelectedRowIndex(b);for(var g=0;g<c;g++){var h=e[g];d=GetXMLValue(h.attributes.getNamedItem("ID"));h=GetXMLValue(h.getElementsByTagName("RESULT")[0]);"1"==h&&(RemoveMessageFromList(d),f=!0)}if(f)try{gDataListTopOfPageOrdinal>gTotalItems&&(gDataListTopOfPageOrdinal=1),DataItemList_RewriteTableRows(LIST_ID,gDataListTopOfPageOrdinal-
1,arrTableColumns,"result"),0==gSelectedIM.GetSize()&&0<gTotalItems&&(c=0,0<a&&(c=a),d=DataItemList_GetRowIDByIndex(b,c),MsgListRowSelect(d,!1,!1))}catch(k){}gPreviewMode==VIEW_BOTTOM&&SetSelectAllCheckbox(!1);return!0}function SetNextBatchItemsProperty(a,b,c){var d=gSelectedIM.GetItems(),e=new StringBuffer,f=0,g;for(g in d)if(0<f&&e.append(","),e.append(d[g]),f++,f==b)break;a+=e.toString();Async_LockUI();ServerRequest("SET-PROPERTY",a,c)||HandleAjaxError()}
function SetSelectedItemsProperty(a,b,c,d){if(!gAllowPageActions)return!1;void 0==d&&(d=!1);var e="Folder="+encodeURIComponent(a)+"&Prop="+b+"&Val="+c+"&ID=";gSetPropsItemCount=gSelectedIM.GetSize();gSetPropsDoneCount=0;if(gSelectedIM.GetSize()>MAX_MOVE_ITEMS)gSelectedIM.SetCallback(function(){SetNextBatchItemsProperty(e,MAX_MOVE_ITEMS,d)}),ShowWait(t_("[ME_TXT-Pleasewait]")+"..."),gKeepShowingWait=!0,window.setTimeout(function(){SetNextBatchItemsProperty(e,MAX_MOVE_ITEMS,d)},500);else{a=gSelectedIM.GetItems();
b=new StringBuffer;c=0;for(var f in a)0<c&&b.append(","),b.append(a[f]),c++;e+=b.toString();Async_LockUI(t_("[ME_TXT-Pleasewait]")+"...");window.setTimeout(function(){ServerRequest("SET-PROPERTY",e,d)||HandleAjaxError()},500)}}function SetReadStatusSelectedMessages(a,b,c){SetSelectedItemsProperty(c,b,"",!0)}function isSpecialFolder(a){return RegExp("^((Root-Shares/Mailbox|Root)-[^/]+)*(/Inbox|/Contacts|/Deleted Items|/Drafts|/Sent Items|/Calendar|/Tasks|/Notes|/Junk E-Mail)$","i").test(a)}
function isSharedFolder(a){return(new RegExp("^"+GetDefaultSharesRootNode()+"/Mailbox-[^/]+/*.*","i")).test(a)}function isFavouritesFolder(a){return RegExp("^<Root-Favourites>.*","i").test(a)}function NewFolder(a,b,c){if(b&&0<b.length){if(b.match(/^PUBLIC *$/i))return ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-InvalidFolderName]"),!0),0;a="Parent="+encodeURIComponent(a)+"&Name="+encodeURIComponent(b);ServerRequest("CREATE-FOLDER",a+(c?"&FolderClass="+c:""),!0)}}
function CreateNewFolder(a,b){0==$("#divFolderDetails").children().length?$("#divFolderDetails").load("dialogs/folderdetails.htm?v="+Date.now(),null,function(){folderDetails.Create();folderDetails.Configure(a,b);folderDetails.Localize();folderDetails.Show()}):folderDetails.Dialog&&(folderDetails.Configure(a,b),folderDetails.Show())}function ChangeFolderName(a,b){b&&0<b.length&&ServerRequest("RENAME-FOLDER","Path="+encodeURIComponent(a)+"&Name="+encodeURIComponent(b),!0)}
function RenameFolder(a,b){isSpecialFolder(a)?ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Youmaynotrenamespecialmailboxfolders]"),!0):oInputDialog.Prompt(t_("[ME_TXT-RenameFolder]"),t_("[ME_TXT-PleaseEnterNewFolderName]")+"...",t_("[ME_TXT-FolderName]")+":",b,function(c){ChangeFolderName(a,c)},!0)}
function RenameSelectedFolder(){var a=GetSelectedFolderPath();if(isSpecialFolder(a))ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Youmaynotrenamespecialmailboxfolders]"),!0);else{var b=GetSelectedNode(gCurrentView);FolderTree_GetSelectedFolderPath(b,gCurrentView);RenameFolder(a,arrTree[b].FolderName)}}
function CreateFolderUnderSelected(){if(gPopupItemID)ProcessPopUp("CreateFolder");else{var a=GetSelectedFolderPath(),b=GetSelectedNode(gCurrentView);FolderTree_GetSelectedFolderPath(b,gCurrentView);CreateNewFolder(a,arrTree[b].FolderName)}}
function DeleteFolder(a,b){isSpecialFolder(a)?ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Youmaynotdeletespecialmailboxfolders]"),!0):oConfirmation.Confirm(t_("[ME_TXT-ConfirmDelete]"),t_("[ME_TXT-Deletethefolder]")+" '"+b+"', "+t_("[ME_TXT-allitscontentsandsubfolders]")+"?",function(){ServerRequest("DELETE-FOLDER","Path="+encodeURIComponent(a),!0)})}
function EmptyFolder(a){oConfirmation.Confirm(t_("[ME_TXT-ConfirmEmpty]"),t_("[ME_TXT-Deleteallmessagesinthisfolder]")+"?",function(){ServerRequest("EMPTY-FOLDER","Path="+encodeURIComponent(a),!0)})}function ConnectToShare(){var a="./Forms/ManageConnections.aspx?TS="+(new Date).getTime();document.getElementById("frmConnectToShare").src=a;oConnectionsDialog.Show()}
function toggleArchiveAction(){"Archive"==$("#archiveAction").val()?$("#ArchiveDialog .popupWin_foot_bttns .compose_bttn_okCancel").last().text("Archive"):$("#ArchiveDialog .popupWin_foot_bttns .compose_bttn_okCancel").last().text("Purge")}function toggleArchiveCriteria(){$("#tblArchiveSettings .trArchive").hide();var a=$("#archiveCriteria").val();$("#trArchive"+a).show()}
function AdvancedSearch(){oSearchDialog?(searchDialog.SetFolder(GetSelectedFolderPath(),GetSelectedSearchFieldID(),$("input#txtSearch").val()),oSearchDialog.Show()):0==$("#divAdvancedSearch").children().length?($("#divAdvancedSearch").load("dialogs/search.htm?v="+Date.now(),null,function(){searchDialog.Create();searchDialog.Configure();searchDialog.Localize();searchDialog.SetFolder(GetSelectedFolderPath(),GetSelectedSearchFieldID(),$("input#txtSearch").val())}),oSearchDialog.Show()):alert("impossible")}
function ArchiveFolder(a){oArchiveDialog?(archiveDialog.SetFolder(a),oArchiveDialog.Show()):0==$("#divArchive").children().length?$("#divArchive").load("dialogs/archive.htm?v="+Date.now(),null,function(){archiveDialog.Create();archiveDialog.Configure();archiveDialog.Localize();archiveDialog.SetFolder(a);oArchiveDialog.Show()}):alert("impossible")}function doArchiveResult(a,b){Async_UnlockUI();ListMessages(GetSelectedFolderPath());ShowNotification("Archive Complete")}
function doArchiveValidate(a,b,c,d){Async_UnlockUI();a&&(a=a.getElementsByTagName("BASEELEMENT")[0])&&(sResult=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]),sItemCount=GetXMLValue(a.getElementsByTagName("ITEMCOUNT")[0]));if("1"==sResult)if(confirm("Are you sure you want to archive/purge "+sItemCount+" items?"))try{Async_LockUI(t_("[ME_TXT-Pleasewait]")+"...");var e=getAppServletURL()+"?Cmd=ARCHIVE-FOLDER&SourceFolder="+encodeURIComponent(c)+b+"&ActionType="+d+"&TS="+(new Date).getTime()+"&ME_VALIDATIONTOKEN="+
getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;$.ajax({url:e,error:function(f,g,h){Async_UnlockUI();ShowNotification("Archive will continue in background ("+g+")")},success:function(f){doArchiveResult(f,c)}})}catch(f){Async_UnlockUI()}else return!1}function SetAdvancedSearch(){SetSelectedSearchFieldID($("#dlg_searchFields").val());$("input#txtSearch").val($("#dlg_txtSearch").val());DoSearch();return!0}
function doArchive(a){var b=arrDatePickers.archiveDatePicker;if(b){var c=$("#archiveCriteria").val(),d=$("#archiveAction").val(),e="&CriteriaType="+c;e="MaxAge"==c?e+("&MaxAge="+formatDate(b.getSelectedDate(),"yyyy-MM-dd")):"Sender"==c?e+("&Sender="+$("#archiveSender").val()):e+("&Subject="+$("#archiveSubject").val());try{try{Async_LockUI(t_("[ME_TXT-Pleasewait]")+"...");var f=getAppServletURL()+"?Cmd=ARCHIVE-FOLDER&SourceFolder="+encodeURIComponent(a)+e+"&ActionType=calc&TS="+(new Date).getTime()+
"&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;$.ajax({url:f,error:function(g,h,k){Async_UnlockUI();ShowNotification("Timed out when calculating matches ("+h+")")},success:function(g){doArchiveValidate(g,e,a,d)}})}catch(g){Async_UnlockUI()}}catch(g){alert("problem")}}return!0}function ShareSelectedFolder(){ShareFolder(GetSelectedFolderPath())}function ShareFolder(a){SetPermissions(a)}
function UnShareFolder(a){ChangeFolderShareIcon(a,!1);ServerRequest("REMOVE-SHARE","Resource="+encodeURIComponent(a)+"&RemoveACLs=1",!1)}function SetPermissions(a){var b=(new Date).getTime();a="./Forms/ManageShare.aspx?Mode=Edit&Resource="+encodeURIComponent(a);a=a+"&Context=1&TS="+b;document.getElementById("frmManageShare").src=a;oShareFolderDialog.Show()}
function ChangeFolderShareIcon(a,b){a="/"!=a&&"/"==a.substr(0,1)?GetDefaultMailboxRootNode(g_opt.Mailbox)+a:GetDefaultMailboxRootNode(g_opt.Mailbox);arrTree[a]&&(arrTree[a].IsShared=b,$("#img_"+arrTree[a].NodeID).toggleClass("shared",b))}
function ProcessShareFolderResult(a){var b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]),c=GetXMLValue(a.getElementsByTagName("FOLDER_PATH")[0]);"1"!=b?(a=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-UnableToShareFolder]")+": "+a,!0,function(){SetPermissions(c)})):SetPermissions(c)}function DisconnectFromShare(a,b){var c=a;isSharedFolder(a)&&(c=GetShareURI(a,g_opt.Postoffice));RemoveShare(c,b,arrTree[a].FolderName)}
function ProcessRemoveShareResult(a){var b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);a=GetXMLValue(a.getElementsByTagName("URI")[0]);if("1"==b){gAllowPageActions=!0;RefreshFoldersTree(FOLDER_TYPE_SHARES);if((b=a.match("SF:[^/]*/[^/]*$"))||a.match(/\/Contacts$/i)){var c=a;b&&(c+="/Contacts");window.frames.frmContacts&&window.frames.frmContacts.RemoveSharedListItem&&window.frames.frmContacts.RemoveSharedListItem(c)}if(b||a.match(/\/Tasks$/i))c=a,b&&(c+="/Tasks"),window.frames.frmTasks&&
window.frames.frmTasks.RemoveSharedListItem&&window.frames.frmTasks.RemoveSharedListItem(c);if(b||a.match(/\/Calendar$/i))b&&(a+="/Calendar"),window.frames.frmCalendar&&window.frames.frmCalendar.window.frames.frameDatePicker&&window.frames.frmCalendar.window.frames.frameDatePicker.RemoveSharedCalendar&&window.frames.frmCalendar.window.frames.frameDatePicker.RemoveSharedCalendar(a)}else ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-InternalServerError:Unabletoremovetheshare!]"),!0)}
function ViewListItem(a){OpenMessage(a,GetSelectedFolderPath())}function OpenCalendarItem(a){getTopAppWindow().frames.frmCalendar?getTopAppWindow().OpenNewWindow(getTopAppWindow().g_opt.CalAppURI+"compose.aspx?NewWindow=1&Mode=Read&ID="+a,620,590):getTopAppWindow().SetPageContextMode(getTopAppWindow().CONTEXT_CALENDAR,null,a)}function OpenTaskItem(a){getTopAppWindow().SetPageContextMode(getTopAppWindow().CONTEXT_TASKS,null,a)}
function OpenMessage(a,b,c){var d=(new Date).getTime();var e=gSourceURI&&0<gSourceURI.length?"URI="+encodeURIComponent(gSourceURI)+"&":"";b||(b=GetSelectedFolderPath());d="./Forms/MAI/read.aspx?"+e+"ID="+a+"&Folder="+JSEscapeStr(encodeURIComponent(b))+"&TS="+d+"&ME_SID="+readCookie("MailEnable-SessionId")+"&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;c&&(d+="&Options="+c);c=!1;if(GetOption("WebMail-AllowNewWindows"))OpenNewWindow(d,800,600),c=!0;else if(e=document.getElementById("frmRead"))e.style.visibility=
"",e.src=d+"&WindowContext=Embedded",SetPageContextMode(CONTEXT_READ),c=!0;c&&MarkMessageAsRead(a,b);return!0}function CopyMessage(a,b){if(!a||!b)return!1;Async_LockUI(t_("[ME_TXT-Copying]")+"...");window.setTimeout(function(){copy_clip(b+"|"+a)},500);window.setTimeout(function(){Async_UnlockUI()},500)}function CopySelectedMessages(a,b){a=gSelectedIM.GetItems();var c=0,d=new StringBuffer,e;for(e in a)0<c&&d.append(";"),d.append(e),c++;sCopyData=b+"|"+d.toString();copy_clip(sCopyData)}
function CopiedDataReadyToBePasted(){var a=get_clip();return a&&0<a.length}
function PasteMessages(a){if(!gAllowPageActions)return!1;var b,c=0;var d=get_clip().split("|");if(!d||2!=d.length)return!1;var e=b=d[0],f=a;isSharedFolder(b)&&(e=GetShareURI(b,g_opt.Postoffice));isSharedFolder(a)&&(f=GetShareURI(a,g_opt.Postoffice));if(-1==d[1].indexOf(";"))gCopyCount=1,gPasteCount=0,Async_LockUI(t_("[ME_TXT-Pasting]")+"..."),gKeepShowingWait=!0,window.setTimeout(function(){ServerRequest("COPY-MESSAGE","ID="+d[1]+"&Source="+encodeURIComponent(e)+"&Destination="+encodeURIComponent(f),
!1)||HandleAjaxError()},500);else{d=d[1].split(";");if(!d)return!1;gCopyCount=d.length;gPasteCount=0;Async_LockUI(t_("[ME_TXT-Pasting]")+"...");gKeepShowingWait=!0;window.setTimeout(function(){var g=1;for(c=0;c<d.length;c++)g=ServerRequest("COPY-MESSAGE","ID="+d[c]+"&Source="+encodeURIComponent(e)+"&Destination="+encodeURIComponent(f),!1);g||HandleAjaxError()},1E3)}return!0}
function ProcessAddTaskResult(a){var b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);"0"==b?(b=t_("[ME_TXT-Taskcreationfailed]"),a=a.getElementsByTagName("ERROR_DESCRIPTION"),null!=a&&0<a.length&&(b=GetXMLValue(a[0])),ShowAlert(t_("[ME_TXT-Error]"),b,!0,null)):"1"==b&&ShowAlert(t_("[ME_TXT-Add]"),t_("[ME_TXT-TaskAddedSuccessfully]")+"!",!1,null)}
function UpdateUsage(a){var b=parseInt(GetXMLValue(a.getElementsByTagName("SIZE")[0]));a=parseInt(GetXMLValue(a.getElementsByTagName("QUOTA")[0]));var c=renderByteValueAsMostAppropriateString(b,"KB",1)+" "+t_("[ME_TXT-OfLC]")+" ";0>=a?c+=t_("[ME_TXT-Unlimited]"):(c+=renderByteValueAsMostAppropriateString(a,"KB",1),c+=" ("+(Math.round(b/a*1E3)/10).toFixed(1)+"%)");SetUsageLabel(c)}function SetUsageLabel(a){try{SetElementText(document.getElementById("lUsage"),a)}catch(b){}}
function SetDefaultAddress(a){try{SetElementText(document.getElementById("lDefaultAddress"),a),SetElementText(document.getElementById("logout_user_name"),GetOption("DisplayName")),SetElementText(document.getElementById("logout_user_address"),a)}catch(b){}}
function ProcessCheckNewMailResult(a){if("1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])){var b=parseInt(GetXMLValue(a.getElementsByTagName("STATE")[0])),c=parseInt(GetXMLValue(a.getElementsByTagName("NEWMESSAGECOUNT")[0]));if(0<c){var d="";try{d=HTMLDecode(GetXMLValue(a.getElementsByTagName("FROM")[0]))}catch(f){d=""}var e=document.getElementById("BGSOUND_ID");e&&(e.src=gSkinPath+"newemail.wav",e.currentTime=0,e.play().catch(function(f){console.log("Autoplay prevented:",f)}));e=t_("[ME_TXT-NewMail]");
"function"===typeof RemoveScript&&0<d.length&&(e=e+"\n"+RemoveScript(d));ShowNotification(e);d=GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox";e=parseInt(arrTree[d].UnreadCount)+c;isSharedFolder(d)?FolderTreeSetUnreadCount(arrTree,d,e,"METree"):FolderTreeSetUnreadCount(arrTree,"/Inbox",e,"METree")}if(0<c||1==b)b=DataItemList_GetSelectedRowIndex(LIST_ID)+2,1==gDataListTopOfPageOrdinal&&b<gItemsPerPage&&"/Inbox"==GetSelectedFolderPath()&&gCurrentView==VIEW_PERSONAL&&ListMessages("/Inbox"),UpdateUsage(a)}}
function ProcessCheckAppointmentReminderResult(a){a=a.getElementsByTagName("REMINDER_ALERTS")[0];var b="";try{b=a.attributes.getNamedItem("CHANGEKEY").nodeValue}catch(g){b=""}try{AlertRangeStart=a.attributes.getNamedItem("RANGESTART").nodeValue}catch(g){AlertRangeStart=""}AlertsCacheChangeKey==b?a=oAlertsCache:(AlertsCacheChangeKey=b,oAlertsCache=a.cloneNode(!0));if(a&&0<a.childNodes.length){b=t_("[ME_TXT-Thefollowingappointment(s)areduesoon]")+":\n\n";for(var c=0;c<a.childNodes.length;c++){var d=
a.childNodes[c],e=GetXMLValue(d.getElementsByTagName("DESCRIPTION")[0]),f=GetXMLValue(d.getElementsByTagName("START")[0]);d=GetXMLValue(d.getElementsByTagName("LOCATION")[0]);f=getDateTimeObjectFromDateString(f);f=formatDate(f,"hh:mm DDD dd/MM/yyyy");b+="<strong>"+t_("[ME_TXT-Description]")+": </strong>"+e+"\n<strong>"+t_("[ME_TXT-StartTime]")+": </strong>"+f+"\n<strong>"+t_("[ME_TXT-Location]")+": </strong>"+d;c<a.childNodes.length-1&&(b+="\n\n--------------------\n\n")}ShowAlert(t_("[ME_TXT-UpcomingAppointmentReminders]")+
"...",b)}}
function ProcessSetPropertyResult(a){var b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);if("2"!=b){var c=!1;if("1"==b)if(a=a.getElementsByTagName("PROPERTY")){gSelectedIM.CallbackExists()&&(c=!0);for(b=0;b<a.length;b++){var d=a[b],e=GetXMLValue(d.getElementsByTagName("MESSAGE_ID")[0]),f=GetXMLValue(d.getElementsByTagName("RELATIVEFOLDERPATH")[0]),g=GetXMLValue(d.getElementsByTagName("NAME")[0]),h=GetXMLValue(d.getElementsByTagName("VALUE")[0]);d=GetXMLValue(d.getElementsByTagName("RESULT")[0]);c&&
gSelectedIM.RemoveItem(e);if(1==d){"READ"==g?h=1:"UNREAD"==g?h=0:"FLAGGED"==g?h=1:"UNFLAGGED"==g&&(h=0);g=g.replace(RegExp("^UN"),"");if("READ"==g){d=ItemsArray_Find(e);var k=gSourceURI.replace(/\\/g,"/");k=RegExp("^SF:[^/]*[/](.*)$").exec(k);f=f.replace(/\\/g,"/");k=k?GetDefaultSharesRootNode()+"/Mailbox-"+k[1]:f;-1!=d&&oItemsArray[d].Read!=h&&(FolderTreeUpdateUnreadCount(arrTree,k,1==h?-1:1),SetItemsArrayReadStatus(e,h),IsDraftsFolder(f)&&(f=FolderTreeGetTotalCount(arrTree,k),FolderTreeSetUnreadCountDisplay(arrTree,
k,f)),UpdateFavourites(arrTree,arrFavourites))}else"FLAGGED"==g&&-1!=ItemsArray_Find(e)&&(oItemsArray[ItemsArray_Find(e)].Flagged=h);DataItemList_SetRowFlagStatusByMessageID(LIST_ID,e,h,g);gSetPropsDoneCount++}}c?UpdateListForBatchResults():(Async_UnlockUI(),gKeepShowingWait=!1)}else Async_UnlockUI(),gKeepShowingWait=!1;else Async_UnlockUI(),gKeepShowingWait=!1,c=a.getElementsByTagName("ERROR_DESCRIPTION"),0<c.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(c[0]),!0)}}
function ProcessAppointmentAccept(a){a=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);"1"==a||"2"==a?ShowNotification(t_("[ME_TXT-NotificationSentToOrganizerOfMeeting!]")):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-FailedToCreateAppointment]"),!0)}function ProcessAppointmentDecline(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?ShowNotification(t_("[ME_TXT-NotificationSentToOrganizerOfMeeting!]")):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-FailedToCreateAppointment]"),!0)}
function ProcessAppointmentTentative(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?ShowNotification(t_("[ME_TXT-NotificationSentToOrganizerOfMeeting!]")):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-FailedToCreateAppointment]"),!0)}
function ProcessAppointmentUpdate(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?(ShowNotification(t_("[ME_TXT-AppointmentDetailsUpdatedSuccessfully!]")),app.frames.frmCalendar.frames.frameDatePicker.UpdateFreeBusyDays(gDate)):(a=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-Error]"),a,!0))}
function ProcessAppointmentCancel(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?ShowNotification(t_("[ME_TXT-AppointmentDeleted]")+"!"):(a=GetXMLValue(a.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-Error]"),a,!0))}function addRequestId(){return g_opt.Concurrency?"&RID="+registerRequest():""}
function doFolderListRequest(){var a=!1;g_opt.Concurrency&&(a=!0);ServerRequest("LIST-FOLDERS","Page=1&Children=0"+addRequestId(),a);g_opt.PublicFoldersEnabled&&(CreateFolderListRoot(arrTree,"METree","",FOLDER_TYPE_PUBLIC),ServerRequest("LIST-FOLDERS","Page=1&Folder=\\Public&Children=0"+addRequestId(),a));g_opt.FileStoreEnabled&&(CreateFolderListRoot(arrTree,"METree","",FOLDER_TYPE_MY_FILES),ServerRequest("LIST-FILES-FOLDERS","Page=1&Folder=\\$FILEROOT&Children=1"+addRequestId(),a));g_opt.SharingEnabled&&
ListShares("",registerRequest())}function RefreshFoldersTree(a){if(!gAllowPageActions)return!1;gSourceURI="";arrTree=TreeViewClearArrTree(arrTree);TreeViewClearNodes("METree");CreateFolderListRoot(arrTree,"METree",g_opt.Mailbox,FOLDER_TYPE_PERSONAL);doFolderListRequest()}
function AddNewFolderToTree(a,b){a=a.replace(/\\/g,"/");gBrowserType==BROWSER_TYPE_SAFARI?(a=GetDefaultMailboxRootNode(g_opt.Mailbox)+a,a.substring(a.length-1)!=TreePathDelimiter&&(a+=TreePathDelimiter),a+=b,TreeNodesAppend(arrTree,a,!1,!1,!1,1,b,0),TreeViewClearNodes("METree"),DrawTreeNodes(arrTree,"METree")):(RefreshFoldersTree(FOLDER_TYPE_PERSONAL),a=RegExp("^[/]public","i").exec(a)?GetDefaultPublicRootNode()+RegExp.rightContext:a.match(/^Root-Shares(\/Mailbox-[^/]*)*$/i)?a:a.match(/^\$FILEROOT.*/i)?
GetDefaultFilesRootNode()+a.substring(9,a.length):GetDefaultMailboxRootNode(g_opt.Mailbox)+a,a.substring(a.length-1)!=TreePathDelimiter&&(a+=TreePathDelimiter),a+=b);gSelectOnCreate&&SelectFolder(arrTree,a)}
function RemoveFolderFromTree(a){a=a.replace(/\\/g,"/");var b=GetSelectedFolderPath(),c=RegExp("^[/]public","i"),d=c.exec(b);d?b=GetDefaultPublicRootNode()+RegExp.rightContext:0==b.indexOf("$FILEROOT")?b=GetDefaultFilesRootNode()+b.substring(9,b.length):isSharedFolder(b)||(b=GetDefaultMailboxRootNode(g_opt.Mailbox)+b);(d=c.exec(a))?a=GetDefaultPublicRootNode()+RegExp.rightContext:0==a.indexOf("$FILEROOT")?a=GetDefaultFilesRootNode()+a.substring(9,a.length):isSharedFolder(a)||(a=GetDefaultMailboxRootNode(g_opt.Mailbox)+
a);isSharedFolder(b)?b=GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox":b.match("^"+RegExp.escape(a))&&(b=getParentPath(a),b.match(/\/Calendar$/i)||b.match(/\/Contacts$/i)||b.match(/\/Tasks$/i))&&(b=GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox");TreeNodesRemove(arrTree,a);TreeViewClearNodes("METree");DrawTreeNodes(arrTree,"METree");SelectFolder(arrTree,b)}
function ProcessDeleteFolderResult(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?(a=GetXMLValue(a.getElementsByTagName("PATH")[0]),RemoveFolderFromTree(a),isSharedFolder(a)&&arrTree[a].IsShared&&DisconnectFromShare(a,!0)):(a=a.getElementsByTagName("ERROR_DESCRIPTION"),0<a.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(a[0]),!0))}
function ProcessCreateFolderResult(a){if("1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])){var b=GetXMLValue(a.getElementsByTagName("PARENTPATH")[0]);a=GetXMLValue(a.getElementsByTagName("NAME")[0]);AddNewFolderToTree(b,a);ShowNotification(t_("[ME_TXT-FolderCreationSucceeded]"))}else b=a.getElementsByTagName("ERROR_DESCRIPTION"),0<b.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(b[0]),!0)}
function RenameSharedFolderInTree(a,b,c,d,e){a=a.replace(/\\/g,"/");b=b.replace(/\\/g,"/");d=d.replace(/\\/g,"/");return 0<TreeViewRenameNode(arrTree,a,c,c,d,e).length?(a=document.getElementById("tv_lbl_"+arrTree[b].NodeID),SetElementText(a,c),1):0}
function RenameFolderInTree(a,b,c,d,e){a=a.replace(/\\/g,"/");var f=GetSelectedFolderPath(),g=RegExp("^[/]public","i"),h=g.exec(f);if(isSharedFolder(a))return RenameSharedFolderInTree(a,d,c,d,e);f=h?GetDefaultPublicRootNode()+RegExp.rightContext:GetDefaultMailboxRootNode(g_opt.Mailbox)+f;(h=g.exec(a))?a=GetDefaultPublicRootNode()+RegExp.rightContext:(g=RegExp("^\\$FILEROOT","i"),a=(h=g.exec(a))?GetDefaultFilesRootNode()+RegExp.rightContext:GetDefaultMailboxRootNode(g_opt.Mailbox)+a);f==a&&getParentPath(f);
a=TreeViewRenameNode(arrTree,a,b,c,d,e);if(0<a.length)try{var k=arrTree[a].NodeID,l=document.getElementById("tv_lbl_"+k);SetElementText(l,c);var m=GetFolderPath(TreeViewGetNodePath(arrTree,k));ChangeFolderShareIcon(m,e)}catch(n){return!1}}
function ProcessRenameFolderResult(a){if("1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])){var b=GetXMLValue(a.getElementsByTagName("OLD_PATH")[0]),c=GetXMLValue(a.getElementsByTagName("NEW_PHYSICAL_FOLDER_NAME")[0]),d=GetXMLValue(a.getElementsByTagName("NEW_FOLDER_NAME")[0]),e=GetXMLValue(a.getElementsByTagName("RELATIVE_FOLDER_PATH")[0]);a="1"==GetXMLValue(a.getElementsByTagName("SHARE_STATUS")[0]);RenameFolderInTree(b,c,d,e,a)}else b=a.getElementsByTagName("ERROR_DESCRIPTION"),0<b.length&&
ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(b[0]),!0)}
function ProcessEmptyFolderResult(a){var b=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]),c=GetXMLValue(a.getElementsByTagName("PATH")[0]);"1"==b?GetSelectedFolderPath()==c?SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox)+c):(FolderTreeSetTotalCount(arrTree,c,0,"METree"),FolderTreeSetUnreadCount(arrTree,c,0,"METree")):(a=a.getElementsByTagName("ERROR_DESCRIPTION"),0<a.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(a[0]),!0))}
function ProcessMoveResult(a,b){var c=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]),d=a.getElementsByTagName("MESSAGE"),e=GetXMLValue(a.getElementsByTagName("SOURCEFOLDER")[0]),f=GetXMLValue(a.getElementsByTagName("TARGETFOLDER")[0]),g=0,h=d.length;e=e.replace(/\\/g,"/");f=f.replace(/\\/g,"/");if("1"==c){for(c=0;c<d.length;c++){a=d[c].attributes.getNamedItem("ID").nodeValue;gSelectedIM.RemoveItem(a);DataItemList_GetSelectedRowIndex(b);var k=ItemsArray_Find(a);-1!=k&&(0==oItemsArray[k].Read&&
g++,ItemsArray_DeleteFromArray(a))}d=e.replace(/\\/g,"/");a=f.replace(/\\/g,"/");c=RegExp("^SF:[^/]*[/](.*)$");(k=c.exec(d))&&(d=GetDefaultSharesRootNode()+"/Mailbox-"+k[1]);(k=c.exec(a))&&(a=GetDefaultSharesRootNode()+"/Mailbox-"+k[1]);0<g&&(FolderTreeUpdateUnreadCount(arrTree,d,-1*g),FolderTreeUpdateUnreadCount(arrTree,a,g));IsDraftsFolder(e)&&(e=FolderTreeGetTotalCount(arrTree,d),FolderTreeSetUnreadCountDisplay(arrTree,d,e-h));IsDraftsFolder(f)&&(e=FolderTreeGetTotalCount(arrTree,a),FolderTreeSetUnreadCountDisplay(arrTree,
a,e+h));DataItemList_DecrementItemCount(b,h);UpdateListForBatchResults();ClearMessagePreview();FolderTreeUpdateTotalCount(arrTree,d,-1*h);FolderTreeUpdateTotalCount(arrTree,a,h);gUnreadMessages=FolderTreeGetUnreadCount(arrTree,d);SetStatusBarValues();UpdateFavourites(arrTree,arrFavourites)}else Async_UnlockUI(),gKeepShowingWait=!1,b=a.getElementsByTagName("ERROR_DESCRIPTION"),0<b.length?ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(b[0]),!0):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-MoveFailed]"),!0);
gPreviewMode==VIEW_BOTTOM&&SetSelectAllCheckbox(!1)}
function ProcessCopyResult(a,b){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?(gCopyResult=1,gPasteCount++,gCopyCount==gPasteCount&&(gPasteCount=0,Async_UnlockUI(),gKeepShowingWait=!1,a=GetXMLValue(a.getElementsByTagName("FOLDER")[0]),GetSelectedFolderPath()==a?ListMessages(a):(b=RegExp("/Public","i"),b.exec(a)?a=GetDefaultPublicRootNode(g_opt.Mailbox)+("/"==RegExp.rightContext?"":RegExp.rightContext):(b=RegExp("^SF:[^/]*[/](.*)$"),a=b.exec(a)?GetShareTreePathFromURI(a,g_opt.Postoffice):
GetDefaultMailboxRootNode(g_opt.Mailbox)+a),SelectFolder(arrTree,a),a=gCurrentView==VIEW_SHARES?gSelectedSharedNodePath:GetSelectedFolderPath(),FolderTreeUpdateTotalCount(arrTree,a,gPasteCount),UpdateFavourites(arrTree,arrFavourites),SetStatusBarValues()))):(Async_UnlockUI(),gKeepShowingWait=!1,a=a.getElementsByTagName("ERROR_DESCRIPTION"),0<a.length&&ShowAlert(t_("[ME_TXT-Error]"),GetXMLValue(a[0]),!0))}
function UpdateDeletedItems(a,b,c){if(!gCurrentSelectedNode.match(/.+\/Deleted Items/i)){var d="/Deleted Items";0<=b&&(isSharedFolder(gCurrentSelectedNode)&&(d=GetDefaultSharesRootNode()+"/Mailbox-"+c+"/Deleted Items"),FolderTreeUpdateTotalCount(arrTree,d,b));a&&0<=a&&FolderTreeUpdateUnreadCount(arrTree,d,a)}}
function ProcessDeleteResult(a,b){var c=GetXMLValue(a.attributes.getNamedItem("ASYNC")),d=a.getElementsByTagName("MESSAGE"),e={},f=0,g=DataItemList_GetFirstSelectedRowIndex(b),h="";0<=g&&(h=DataItemList_GetRowIDByIndex(b,g));for(var k=!1,l=0;l<d.length;l++){var m=d[l];var n=m.attributes.getNamedItem("ID").nodeValue;"1"==GetXMLValue(m.getElementsByTagName("RETURNVALUE")[0])?0==c.length?(m=ItemsArray_Find(n),-1!=m&&1!=oItemsArray[m].Read&&f++,RemoveMessageFromList(n),k||(k=n==h)):f=-1:(n=m.getElementsByTagName("ERROR_DESCRIPTION"),
m=t_("[ME_TXT-Noerrorgiven]"),n&&0<n.length&&(m=GetXMLValue(n[0])),e[m]?e[m]++:e[m]=1)}if(l=a.getElementsByTagName("UPDATE_DELETED_COUNT")[0])l=parseInt(GetXMLValue(l)),a=GetXMLValue(a.getElementsByTagName("MAILBOX")[0]),UpdateDeletedItems(f,l,a);f=gCurrentView==VIEW_SHARES?gSelectedSharedNodePath:GetSelectedFolderPath();gUnreadMessages=FolderTreeGetUnreadCount(arrTree,f);SetStatusBarValues();UpdateFavourites(arrTree,arrFavourites);UpdateListForBatchResults();0==gSelectedIM.GetSize()&&0<gTotalItems&&
1==g_opt.SelectNextMessage&&(k&&(h=0,0<g&&(h=g),h=DataItemList_GetRowIDByIndex(b,h)),MsgListRowSelect(h,!1,!1));SelectItemOverlay();b=t_("[ME_TXT-Messagedeletionfailures]")+":\n\n";l=0;for(var p in e)if(b+="["+e[p]+"x] - \n"+p+"\n\n",l++,5<l){b+="\n\n...";break}0<l&&(Async_UnlockUI(),ShowAlert(t_("[ME_TXT-Error]"),b,!0))}
function RemoveMessageFromList(a){gSelectedIM.RemoveItem(a);var b=ItemsArray_Find(a);if(-1==b)return!1;var c=0!=oItemsArray[b].Read;ItemsArray_DeleteFromArray(a);DataItemList_DecrementItemCount(LIST_ID,1);DataItemList_SetScrollRange();gItemsDeleted++;b=gCurrentView==VIEW_SHARES?gSelectedSharedNodePath:GetSelectedFolderPath();FolderTreeUpdateTotalCount(arrTree,b,-1);c||FolderTreeUpdateUnreadCount(arrTree,b,-1);IsDraftsFolder(b)&&(c=FolderTreeGetTotalCount(arrTree,b),FolderTreeSetUnreadCountDisplay(arrTree,
b,c));0==gTotalItems&&ScrollBar_Hide(SCROLLBAR_DIV,SCROLLBAR_TD);gSelectedMessageID==a&&ShowEmptyPreviewPane();return 1}
function UpdateListForBatchResults(){SetMessageToolbarButtonsStatus();gDataListTopOfPageOrdinal>gTotalItems&&(gDataListTopOfPageOrdinal=1);DataItemList_RewriteTableRows(LIST_ID,gDataListTopOfPageOrdinal-1,arrTableColumns,"update");ClearPreviewPane();0==gSelectedIM.GetSize()?(Async_UnlockUI(),gKeepShowingWait=!1,gSelectedIM.SetCallback(null),gPreviewMode==VIEW_BOTTOM&&SetSelectAllCheckbox(!1),gListItemSelected=!1,window.status=t_("[ME_TXT-Done]")):(gAllowPageActions=!0,gSelectedIM.CallbackExists()&&
gSelectedIM.ExecuteCallback())}function ProcessGetAccessResult(a){gHasAccessToShare="1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])}function SetItemsArrayReadStatus(a,b){a=ItemsArray_Find(a);-1!=a&&(gUnreadMessages+=oItemsArray[a].Read-b,oItemsArray[a].Read=b,SetStatusBarValues())}
function ProcessAddWhitelistResult(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?ShowNotification(t_("[ME_TXT-SenderAddedToWhitelist]")):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Failedtoaddsendertowhitelist]"),!0)}function ProcessAddBlacklistResult(a){"1"==GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0])?ShowNotification(t_("[ME_TXT-SenderAddedToBlacklist]")):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-FailedToAddSenderToBlackList]"),!0)}
function ServerRequest(a,b,c,d){gSourceURI&&0<gSourceURI.length&&(b=b+"&URI="+encodeURIComponent(gSourceURI));var e=t_("[ME_TXT-Pleasewait]")+"...";gDebugMode&&(e=(new Date).getTime(),e=t_("[ME_TXT-Pleasewait]")+"... ["+a+"("+e+"):"+b+"]");window.status=e;return LIBAjax_ServerRequest(a,b,c,d)}function ServerPost(a,b,c,d){return LIBAjax_ServerPost(a,b,c,d)}
function SetStatusBarDisplay(a,b){var c=document.getElementById("liMsgCount"),d=document.getElementById("liUnreadCount"),e=document.getElementById("liContactsCount"),f=document.getElementById("liGroupsCount"),g=document.getElementById("liTasksCount"),h=document.getElementById("liFilesCount");b=b?"":"none";if(a)if(a==VIEW_CALENDAR||a==VIEW_OPTIONS||a==VIEW_ADMIN||a==VIEW_STATS)c.style.display="none",d.style.display="none",e.style.display="none",f&&(f.style.display="none"),g.style.display="none",h.style.display=
"none";else if(c.style.display="none",d.style.display="none",a==VIEW_FILES)e.style.display="none",f&&(f.style.display="none"),g.style.display="none",h.style.display=b;else if(h.style.display="none",a==VIEW_CONTACTS)g.style.display="none",e.style.display=b,f&&(f.style.display=b);else{if(a==VIEW_TASKS||a==VIEW_NOTES)e.style.display="none",f&&(f.style.display="none"),g.style.display=b}else e.style.display="none",f&&(f.style.display="none"),g.style.display="none",h.style.display="none",c.style.display=
b,d.style.display=b}function HideStatusBarValues(a){SetStatusBarDisplay(a,!1)}function ShowStatusBarValues(a){SetStatusBarDisplay(a,!0)}
function SetStatusBarValues(a,b,c){var d=document.getElementById("liMsgCount"),e=document.getElementById("liUnreadCount"),f=document.getElementById("liContactsCount"),g=document.getElementById("liGroupsCount"),h=document.getElementById("liTasksCount"),k=document.getElementById("liFilesCount");a?a==VIEW_FILES?SetElementText(k,b+" "+t_("[ME_TXT-Files]")):a==VIEW_CONTACTS?(SetElementText(f,b+" "+t_("[ME_TXT-Contacts]")),void 0!=c&&g&&SetElementText(g,c+" "+t_("[ME_TXT-Groups]"))):a==VIEW_TASKS?SetElementText(h,
b+" "+t_("[ME_TXT-Tasks]")):a==VIEW_NOTES&&SetElementText(h,b+" "+t_("[ME_TXT-Notes]")):(d&&SetElementText(d,gTotalItems+" "+t_("[ME_TXT-Messages]")),e&&SetElementText(e,gUnreadMessages+" "+t_("[ME_TXT-Unread]")))}function GetCurrentSenderEmail(){var a=null,b=oItemsArray[ItemsArray_Find(gSelectedMessageID)].From_Full;(b=RegExp("<?([^@]+@[^.@][^@]*.[A-Za-z]{2,})>?").exec(b))&&(a=b[1]);return a}
function AddToWhitelist(){if(!gAllowPageActions)return!1;var a=GetCurrentSenderEmail();a&&AddEmailToWhitelist(a)}function AddToBlacklist(){if(!gAllowPageActions)return!1;var a=GetCurrentSenderEmail();a&&AddEmailToBlacklist(a)}function AddEmailToBlacklist(a){ServerRequest("ADD-BLACKLIST","Address="+encodeURIComponent(a),!0)}function AddEmailToWhitelist(a){ServerRequest("ADD-WHITELIST","Address="+encodeURIComponent(a),!0)}
function ListUnsubscribe(){oConfirmation.Confirm(t_("[ME_TXT-Unsubscribe]"),t_("[ME_TXT-ConfirmUnsubscribe]"),function(){var a=$("#ListUnsubscribeButton").data("UnsubscribeCommand");HandleMailtoURL(a,!0)||OpenNewWindow(a,800,600)})}
function QuickCompose(a,b,c){PopulateQuickComposeFields(a,b,c);$("#QuickReplyDialogDiv").data({Mode:"Compose"});$("#QuickReplyNote").hide();QuickReplyDialog.SetTitle(t_("[ME_TXT-Compose]"));$("#QuickReplyTo").attr("readonly",!1);$("#QuickReplySubject").attr("readonly",!1);QuickReplyDialog.Show();$("#QuickReplyText").focus()}
function QuickReply(a,b){PopulateQuickReplyFields(a);$("#QuickReplyText").val("");$("#QuickReplyDialogDiv").data({Mode:"Reply",MessageID:a,Folder:b});$("#QuickReplyNote").show();QuickReplyDialog.SetTitle(t_("[ME_TXT-QuickReply]"));$("#QuickReplyTo").attr("readonly",!0);$("#QuickReplySubject").attr("readonly",!0);QuickReplyDialog.Show();$("#QuickReplyText").focus()}
function HandleMailtoURL(a,b){if(a=RegExp("^mailto:([^?]+)(.*)$").exec(a)){var c=a[1],d="",e="",f=a[2];if(0==f.indexOf("?")){f=f.substr(1).split("&");for(var g=0;g<f.length;g++){var h=f[g].split("=");h.length=2;var k=h[0].toLowerCase();h=h[1];"subject"==k?d=decodeURIComponent(h):"body"==k&&(e=decodeURIComponent(h))}}b?ServerRequest("SEND-MESSAGE","MsgBody="+e+"&Subject="+d+"&ToRecipients="+c,!0):QuickCompose(c,d,e)}return a}
function ComposeEmail(a,b,c){c=void 0!=c?c:"";GetOption("WebMail-AllowNewWindows")?(a=b+"/MAI/Compose.aspx?AddressTo="+a+"&TS="+(new Date).getTime()+c,OpenNewWindow(a,800,600)):(a="./Forms/MAI/Compose.aspx?AddressTo="+a+"&TS="+(new Date).getTime()+c,SelectViewTab(TAB_VIEW_EMAIL),ComposeMessage(a))}
function SaveContactDetails(a,b,c){if(!IsValidFields())return!1;b||(b="");b=GetContactDetailsDataString(b,arrDatePickers.birthdayPicker);var d=gSourceURI;c&&(gSourceURI="");a==MODE_ADD?ServerRequest("ADD-CONTACT",b,!1):a==MODE_EDIT&&ServerRequest("EDIT-CONTACT",b,!1);gSourceURI=d;(a=window.frames.frmContacts)&&a.RefreshList&&a.RefreshList();return!0}
function ProcessSaveContactResult(a,b){var c=GetXMLValue(a.getElementsByTagName("RETURNVALUE")[0]);if("0"==c){var d;b==MODE_ADD?d=t_("[ME_TXT-AddOperationFailed]"):b==MODE_EDIT&&(d=t_("[ME_TXT-UpdateOperationFailed]"));b=a.getElementsByTagName("ERROR_DESCRIPTION");null!=b&&0<b.length&&(d=GetXMLValue(b[0]));ShowAlert(t_("[ME_TXT-Error]"),d,!0)}else"1"==c&&(a=d="",b==MODE_ADD?(d=t_("[ME_TXT-AddToContacts]"),a=t_("[ME_TXT-ContactAddedSuccessfully.]")):b==MODE_EDIT&&(d=t_("[ME_TXT-EditContact]"),a=t_("[ME_TXT-Detailsupdatedsuccessfully.]")),
ShowAlert(d,a))}function AddContact(a,b,c,d){$("#ContactDetailsContent").data("ContactID",a);oContactTabDialog&&(ClearContactDetails(),ContactDialogSetDetails(a,b,c,d),oContactTabDialog.Show(!1))}function OpenContact(a){SetPageContextMode(CONTEXT_CONTACTS,void 0,a,"Mine")}
function GetDetailsFrom(a,b){b.ID=GetXMLValue(a.getElementsByTagName("ID")[0]);b.Name=GetXMLValue(a.getElementsByTagName("FULLNAME")[0]);b.EmailAddress=GetXMLValue(a.getElementsByTagName("EMAIL")[0]);b.PhoneW=GetXMLValue(a.getElementsByTagName("PHONEW")[0]);b.PhoneH=GetXMLValue(a.getElementsByTagName("PHONEH")[0]);b.PhoneM=GetXMLValue(a.getElementsByTagName("PHONEM")[0]);b.PhotoURL=GetXMLValue(a.getElementsByTagName("PHOTOURL")[0])}
function AddToContacts(a,b){if(!gAllowPageActions)return!1;var c="",d="",e="";a&&(b?(c=UnEscapeJSBackslash(oItemsArray[ItemsArray_Find(b)].From),d=oItemsArray[ItemsArray_Find(b)].From_Full):(c=UnEscapeJSBackslash(oItemsArray[ItemsArray_Find(gSelectedMessageID)].From),d=oItemsArray[ItemsArray_Find(gSelectedMessageID)].From_Full));var f=null;a&&(f=GetDetailsFromContactString(d))&&$.ajax({type:"GET",url:getAppServletURL()+"?Cmd=GET-CONTACT-SUMMARY&ID="+encodeURIComponent(f.Email)+"&Folder=/Contacts&Options=FIELD=EMAIL_PREF_INTERNET&ME_SID="+
readCookie("MailEnable-SessionId")+" &ts="+(new Date).getTime()+" &ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN,data:"",contentType:"text/xml",cache:!1,async:!1,complete:function(g,h){},success:function(g){"1"==GetXMLValue(g.getElementsByTagName("RETURNVALUE")[0])&&GetDetailsFrom(g,f)}});f&&"undefined"!==typeof f.ID&&0<f.ID.length?OpenContact(f.ID):oContactTabDialog&&(ContactDetailsTabStrip.ActivateTab(0),SetPhotoEditVisibility("hidden"),a?f&&(e=f.Email+".VCF",AddContact(e,c,f.Email,
c)):(ClearContactDetails(),oContactTabDialog.Show(!1)))}function ContactDialogSetDetails(a,b,c,d){try{c||(c=""),b||(b=c),d||(d=c),document.getElementById("contact_fullName").value=b,document.getElementById("contact_email").value=c,document.getElementById("contact_nickName").value=d}catch(e){}}function HideNoteDetails(){ClearNoteDetails();oNewNoteDialog.Close()}
function SaveNoteDetails(){if(ValidateNoteData(arrDatePickers.startDatePicker,arrDatePickers.dueDatePicker)){var a=GetNoteDataString(MODE_ADD,"");ServerRequest("ADD-ITEM",a,!1);oNewNoteDialog.Close()}}function NewNote(){oNewNoteDialog.Show();ClearNoteDetails()}function NewTask(){oNewTaskDialog.Show();ClearTaskDetails(arrDatePickers.startDatePicker,arrDatePickers.dueDatePicker,null)}
function HideTaskDetails(){ClearTaskDetails(arrDatePickers.startDatePicker,arrDatePickers.dueDatePicker,null);oNewTaskDialog.Close()}function SaveTaskDetails(){if(ValidateTaskData(arrDatePickers.startDatePicker,arrDatePickers.dueDatePicker)){var a=GetTaskDataString(MODE_ADD,arrDatePickers.startDatePicker,arrDatePickers.dueDatePicker,"");ServerRequest("ADD-TASK",a,!1);oNewTaskDialog.Close()}}
function NewAppointment(a,b,c,d){oNewAppointmentDialog.options={ResourceId:b};oNewAppointmentDialog.Show();a||(a=new Date);var e=a?formatDate(a,"yyyy-MM-dd-hh-mm"):formatDate(new Date,"yyyy-MM-dd");c||(c=a,c.setHours(c.getHours()+1));a=formatDate(c,"yyyy-MM-dd-hh-mm");InitAddDetails(e,b,a,d)}function HideApptDetails(){oNewAppointmentDialog.Close()}
function SaveApptDetails(a){if(IsValidateApptDetails())a=GetApptDataString("Add",null,a),ServerRequest("ADD-APPOINTMENT",a,!1),HideApptDetails();else return alert(t_("[ME_TXT-MeetingStartTimeMustBeBeforeFinishTime]")),!1;return!0}
function ShowNotification(a,b,c){var d=!1;if(1==g_opt.BrowserNotify)try{if("undefined"!==typeof Notification&&"granted"===Notification.permission){c||(c=g_opt.Mailbox);var e=new Notification(c,{icon:g_opt.SkinPath+"logo_mailenable.png",body:a});d=!0;b||setTimeout(function(){e.close()},3E3)}}catch(f){}d||oNotification&&oNotification.ShowNotification(a,b)}function ShowAlert(a,b,c,d){void 0!=c&&c||(c=!1);null!=oAlertDialog?oAlertDialog.Alert(a,b,c,!0,d):alert(b)}
function ShowWait(a,b,c){void 0==a&&(a=t_("[ME_TXT-Pleasewait]")+"...");g_opt.ToolbarWait&&c?$("#tbWait").show():oWaitDialog&&oWaitDialog.Show({Message:a,CancellationAction:b})}function HideWait(){oWaitDialog&&oWaitDialog.Hide();$("#tbWait").hide()}function ToggleSort(a,b){void 0==b&&(b="");Async_LockUI(t_("[ME_TXT-Sorting]")+"...");"From"==a&&IsOutboundFolder(GetSelectedFolderPath())&&(a="To");window.setTimeout(function(){SetSortColumn(a,b)},500)}
function HandleAjaxError(){Async_UnlockUI();ShowAlert(t_("[ME_TXT-Error]"),"The server did not respond correctly to an asynchronous request. You may need to refresh your browser.",!0)}
function ListMessages(a){if(!gAllowPageActions)return!1;var b=(new Date).getTimezoneOffset();LogDebug("ListMessages");var c=FolderTreeGetProperty(arrTree,"/Inbox","LastUID",0);gListFirstLoad=gSetPage=!0;var d=GetOption("WebMail-HideBulk");Async_LockUI(t_("[ME_TXT-LoadingMessages]")+"...",null,!0);ServerRequest("LIST-MESSAGES","Folder="+encodeURIComponent(a)+"&LastUID="+c+"&Page=1&Offset="+b+"&sc=1&IPP="+gDataPageSize+"&SortField="+gSortColumn+"&HideBulk="+d+"&SortOrder="+gSortOrder+gSearchStr,!0)||
HandleAjaxError();return!0}function SelectFolderByNodeID(a,b){for(var c in a)if(a[c].NodeID==b)return b=c,SelectFolder(a,b),DropDown_ShowMenu("folderTreeContextMenuDiv",c),!0;return!1}function IsSpecialViewNode(a){return a==GetDefaultMailboxRootNode(g_opt.Mailbox)?!0:RegExp("^(Root-Shares/)?[^/]*/(Contacts|Calendar|Tasks)$","i").test(a)}
function HasAccessToShare(a){if(!gAllowPageActions)return!1;gSourceURI="";ServerRequest("HAS-ACCESS","Resource="+encodeURIComponent(a),!1);return gHasAccessToShare}function ShowSearchPane(){gEmailViewInitialised||($("#divEmail").show(),InitEmailView());HideFolderContentsPane();ShowPane("divSearch",TAB_VIEW_SEARCH);layoutSearchPage.resizeAll();HideStatusBarValues();$("#txtSearchQuery").trigger("focus");$("#txtSearchQuery").trigger("select")}
function ReloadSummaryPage(){var a=document.getElementById("frmSummary"),b=(new Date).getTime();HideFolderContentsPane();ShowPane("divAccountSummary",TAB_VIEW_SUMMARY);a&&(a.src="./Forms/Summary.aspx?WindowContext=Embedded&TS="+b);HideStatusBarValues()}function DisplaySummaryPage(){SelectViewTab(TAB_VIEW_SUMMARY);SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox))}
function GetTreeKey(a){return 0==a.indexOf("<Root-Favourites>/Mailbox-")?a.replace("<Root-Favourites>/Mailbox-","Root-"):a}
function SelectFolder(a,b,c,d){var e=!1;ClearSearchField();b&&""!=b||(gCurrentSelectedNode&&""!=gCurrentSelectedNode?d&&!IsSpecialViewNode(gCurrentSelectedNode)?(b=gCurrentSelectedNode,e=!0):b=GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox":b=GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox");if(!a[b]||!gAllowPageActions)return!1;void 0==c&&(c=!0);if("<Root-Favourites>"==b||b.match(/^Root-Shares(\/Mailbox-[^/]*)*$/i))return 0;if(isSharedFolder(b)&&(d=GetShareURI(b,g_opt.Postoffice),!HasAccessToShare(d)))return ShowAlert(t_("[ME_TXT-Error]"),
t_("[ME_TXT-Youdonothaveaccesstothisfolder]"),!0),0;b.match(/^root-.+\/contacts$/i)||b.match(/^root-.+\/calendar$/i)||b.match(/^root-.+\/tasks$/i)||(gCurrentSelectedNode=b);e||(gSelectedIM.Clear(),gMessageLoaded=!1,ClearMessagePreview());gSourceURI="";document.getElementById("divCurrentFolder")&&(document.getElementById("divCurrentFolder").style.display="");if(b.match(/^root-.+\/contacts\/.+$/i)||b.match(/^root-.+\/calendar\/.+$/i)||b.match(/^root-.+\/tasks\/.+$/i)||!b.match(/^root-.+\/contacts$/i)&&
!b.match(/^root-.+\/calendar$/i)&&!b.match(/^root-.+\/tasks$/i))gCurrentView=GetViewFromSelectedNode(b);var f="";switch(gCurrentView){case VIEW_PERSONAL:EnableToolbarButton("btnShareFolder",function(){ShareSelectedFolder()},BTTN_FLOAT_RIGHT);if(b==GetDefaultMailboxRootNode(g_opt.Mailbox)){TreeViewHighlightNode(a,b,VIEW_ACCOUNT_SUMMARY,"METree");ReloadSummaryPage();SetPageContextMode(CONTEXT_ACCOUNT_SUMMARY,c);gPublicFolderView=!1;break}else SelectViewTab(TAB_VIEW_EMAIL);DisplaySelectedFolderNode(a,
b,c,e);break;case VIEW_FILES:gFilesFolderView=!0;DisableToolbarButton("btnShareFolder",BTTN_FLOAT_RIGHT);EnsureNodeIsInTree(a,b);TreeViewHighlightNode(a,b,gCurrentView,"METree");f=-1!=b.indexOf("/",1)?b.substr(0,b.indexOf("/",1)):b;f==GetDefaultMailboxRootNode(g_opt.Mailbox)&&SetCurrentView(VIEW_PERSONAL);DisplaySelectedFolderNode(a,b,c,e);break;case VIEW_PUBLIC:gPublicFolderView=!0;DisableToolbarButton("btnShareFolder",BTTN_FLOAT_RIGHT);EnsureNodeIsInTree(a,b);TreeViewHighlightNode(a,b,gCurrentView,
"METree");f=-1!=b.indexOf("/",1)?b.substr(0,b.indexOf("/",1)):b;b==GetDefaultPublicRootNode()?(d="/Public",GetDefaultPublicRootNode()):(d=GetFolderPath(b),d.substr(d.indexOf("/",1)));f==GetDefaultMailboxRootNode(g_opt.Mailbox)?(SetCurrentView(VIEW_PERSONAL),DisplaySelectedFolderNode(a,b,c,e)):f==GetDefaultSharesRootNode()?DisplaySelectedFolderNode(a,b,c,e):f==GetDefaultPublicRootNode()&&(SetPageContextMode(CONTEXT_PUBLIC_FOLDERS,c),ListMessages(d));break;case VIEW_OPTIONS:return gPublicFolderView=
!1,SetPageContextMode(CONTEXT_OPTIONS,c),SelectOptionsFolder(b);case VIEW_SHARES:DisableToolbarButton("btnShareFolder",BTTN_FLOAT_RIGHT);b!=GetDefaultSharesRootNode()&&(f=-1!=b.indexOf("/",1)?b.substr(0,b.indexOf("/",1)):b,f==GetDefaultMailboxRootNode(g_opt.Mailbox)&&SetCurrentView(VIEW_PERSONAL),DisplaySelectedFolderNode(a,b,c,e));break;default:DisplaySelectedFolderNode(a,b,c,e)}return!0}function GetCurrentView(){return gCurrentView}
function SetCurrentView(a){if(!gAllowPageActions)return!1;gCurrentView=a;a==VIEW_PERSONAL&&SetPrevEmailView(a)}function GetPrevEmailView(){return gPrevEmailView}function SetPrevEmailView(a){gPrevEmailView=a}function GetSelectedNode(a){return arrSelectedTreeNodes?arrSelectedTreeNodes[a]:""}function SetSelectedNode(a,b){arrSelectedTreeNodes&&(arrSelectedTreeNodes[a]=b)}
function ToSearchFieldValue(a){return"liFrom"==a?IsOutboundFolder(GetSelectedFolderPath())?SEARCH_FIELD_TO:SEARCH_FIELD_FROM:"liSubject"==a?SEARCH_FIELD_SUBJECT:"liBody"==a?SEARCH_FIELD_BODY:0}
function SetSelectedSearchFieldID(a){try{switch($("#dropDown_search ."+DROPDOWN_TICK_CLASS).removeClass(DROPDOWN_TICK_CLASS),parseInt(a)){case 1:case 2:$("#liFrom").addClass(DROPDOWN_TICK_CLASS);break;case 3:$("#liSubject").addClass(DROPDOWN_TICK_CLASS);break;case 4:$("#liBody").addClass(DROPDOWN_TICK_CLASS)}}catch(b){}}function GetSelectedSearchFieldID(){var a=$("#dropDown_search ."+DROPDOWN_TICK_CLASS),b=0;0<a.length&&(b=ToSearchFieldValue(a.eq(0).attr("id")));return b}
function DoSearch(){if(!gAllowPageActions)return!1;gSelectedIM.Clear();SetSelectAllCheckbox(!1);var a=GetSelectedFolderPath(),b=document.getElementById("txtSearch");gSourceURI=isSharedFolder(a)?GetShareURI(a,g_opt.Postoffice):"";gSearchStr="";b&&(b=b.value,gSearchStr="&SearchField="+GetSelectedSearchFieldID()+"&SearchCriteria="+encodeURIComponent(b));(b=arrDatePickers.searchToDatePicker)&&(b=b.getSelectedDate())&&(gSearchStr+="&ToDate="+encodeURIComponent(formatDate(b,"yyyy-MM-dd")));(b=arrDatePickers.searchFromDatePicker)&&
(b=b.getSelectedDate())&&(gSearchStr+="&FromDate="+encodeURIComponent(formatDate(b,"yyyy-MM-dd")));0<gSearchStr.length&&(b=(new Date).getTimezoneOffset(),LogDebug("performing search: '"+gSearchStr+"'"),gSetPage=!1,gListFirstLoad=!0,Async_LockUI(t_("[ME_TXT-Pleasewaitwhilethesearchoperationcompletes]")+"...",function(){Async_UnlockUI();oAJAXHandlerSearch.abort()}),ServerRequest("SEARCH-MESSAGES","Folder="+encodeURIComponent(a)+"&Page=1&Offset="+b+"&IPP="+gDataPageSize+"&SortField="+gSortColumn+"&SortOrder="+
gSortOrder+gSearchStr,gAsyncSearch)||HandleAjaxError());return!0}function ClearSearch(){var a=document.getElementById("txtSearch"),b=a.value;gSearchStrInputed?a&&0<a.value.length&&(ClearSearchField(),SetFieldFocus("txtSearch")):(gSearchStrInputed=!0,HasFocus("txtSearch")||(ClearSearchField(),SetFieldFocus("txtSearch"),SetSearchFieldInputClass(!0)));b&&DoSearch()}
function SearchContacts(){if(!gAllowPageActions)return!1;var a=getTopAppWindow().document.getElementById("frmContacts");a&&a.Search(encodeURIComponent(document.getElementById("txtContactsSearch").value))}function PerformSearch(a){1==IsEnterKey(a)&&(a=GetCurrentView(),a==VIEW_PERSONAL?DoSearch():a==VIEW_SHARES?DoSearch():a==VIEW_CONTACTS?SearchContacts():$("#divSearch").is(":visible")&&PerformMailboxSearch());return!0}function HasSingleItemSelected(){return 1==gSelectedIM.GetSize()}
function EnforcePreviewPaneStatus(){SetPreviewPaneStatus(GetOptionValue("WebMail-MessagePreviewPane"));return!0}function SetPreviewPaneStatus(a,b){return!0}function ShowListPane(a,b){ShowMessageListPane();a&&(gCurrentView=a,void 0==b&&(b=!0));SetPreviewPaneVisibility(b)}function SetIFrameHeight(a,b){if(a=document.getElementById(a))a.style.height=b+"px"}function GetBtnClass(a){return g_opt.UseSummaryToolBar?"i"+a:a}
var CSS_CLASS_TOP_BTTN="topNav_bttn",CSS_CLASS_TOP_BTTN_SELECTED="topNav_bttn_selected",CSS_CLASS_TOP_BTTN_TXT="topNav_bttn_text",CSS_CLASS_TOP_BTTN_TXT_SELECTED="topNav_bttn_text_selected",CSS_CLASS_TOP_BTTN_BORDER_RIGHT="topNav_bttn_border_right",CSS_CLASS_TOP_BTTN_BORDER_RIGHT_SELECTED="topNav_bttn_border_right_selected",CSS_CLASS_TOP_BTTN_DIVIDER="topNav_bttn_divider",CSS_CLASS_TOP_BTTN_DIVIDER_SELECTED="topNav_bttn_divider_selected",TOPNAV_BTTN_SHELL="topNav_bttn_shell_js",TAB_VIEW_EMAIL=0,TAB_VIEW_CONTACTS=
1,TAB_VIEW_CALENDAR=2,TAB_VIEW_TASKS=3,TAB_VIEW_STATS=4,TAB_VIEW_OPTIONS=5,TAB_VIEW_ADMIN=6,TAB_VIEW_SUMMARY=7,TAB_VIEW_SEARCH=8,TAB_VIEW_CHAT=9,TAB_VIEW_COUNT=10;
function GetTabHeadingDiv(a){var b=null,c="topNav_bttn_";try{switch(a){case TAB_VIEW_EMAIL:c+="email";break;case TAB_VIEW_CONTACTS:c+="contacts";break;case TAB_VIEW_CALENDAR:c+="calendar";break;case TAB_VIEW_TASKS:c+="tasks";break;case TAB_VIEW_STATS:c+="stats";break;case TAB_VIEW_CHAT:c+="chat";break;case TAB_VIEW_SEARCH:c+="search";break;case TAB_VIEW_OPTIONS:c+="options";break;case TAB_VIEW_ADMIN:c+="admin";break;case TAB_VIEW_SUMMARY:c+="summary",document.getElementById(c)||(c="topNav_bttn_email")}b=
document.getElementById(c)}catch(d){}return b}function ViewTabIsSelected(a){return(a=GetTabHeadingDiv(a))&&a.className==GetBtnClass(CSS_CLASS_TOP_BTTN_SELECTED)?!0:!1}
function SelectViewTab(a){var b=GetTabHeadingDiv(a);if(null!=b){if(!b||b.className==GetBtnClass(CSS_CLASS_TOP_BTTN_SELECTED))return!1;try{var c=b.id;b=!1;for(var d="",e="",f=document.getElementById(TOPNAV_BTTN_SHELL).firstChild;f;){if(f.nodeType==ELEMENT_NODE_TYPE){if(f.className==GetBtnClass("topNav_bttn")||f.className==GetBtnClass("topNav_bttn_selected")){f.id==c?(e=GetBtnClass(CSS_CLASS_TOP_BTTN_SELECTED),d=GetBtnClass(CSS_CLASS_TOP_BTTN_TXT_SELECTED),b=!0):(e=GetBtnClass(CSS_CLASS_TOP_BTTN),d=
GetBtnClass(CSS_CLASS_TOP_BTTN_TXT),b=!1);f.className=e;for(var g=f.firstChild,h="";g;)g.nodeType==ELEMENT_NODE_TYPE&&(h=g.className,-1!=h.indexOf("bttn_txt")||-1!=h.indexOf("bttn_text")?g.className=d:-1!=h.indexOf("_border_right")&&(g.className=b?GetBtnClass(CSS_CLASS_TOP_BTTN_BORDER_RIGHT_SELECTED):GetBtnClass(CSS_CLASS_TOP_BTTN_BORDER_RIGHT))),g=g.nextSibling}-1!=f.className.indexOf("_divider")&&(b?(f.className=GetBtnClass(CSS_CLASS_TOP_BTTN_DIVIDER_SELECTED),bSetDivider=!1):f.className=GetBtnClass(CSS_CLASS_TOP_BTTN_DIVIDER))}f=
f.nextSibling}SwitchTabView(a)}catch(k){}}}function doInitLayout(a){"function"==typeof window.frames[a].InitLayout&&window.frames[a].InitLayout()}
function SwitchTabView(a){try{HideOtherTabViews(a);document.getElementById(GetDivViewID(a)).style.display="";document.getElementById(GetDivViewID(a)).style.width="100%";document.getElementById(GetDivViewID(a)).style.height="100%";a==TAB_VIEW_EMAIL&&(gEmailViewInitialised||InitEmailView());$(".previewPane_toggle_menu").toggle(a==TAB_VIEW_EMAIL&&"true"==$(".previewPane_toggle_menu").data("toggle"));switch(a){case TAB_VIEW_EMAIL:HidePane("divSearch");ShowStatusBarValues();var b=GetFolderPath(gCurrentSelectedNode);
null==layoutEmailInner&&InitPreviewPaneLayout();GetPrevEmailView()==VIEW_COMPOSE?ShowComposePage():(SetCurrentView(VIEW_PERSONAL),"/Notes"==b?HideMessageListPane():gCurrentSelectedNode==GetDefaultMailboxRootNode(g_opt.Mailbox)?ReloadSummaryPage():($("#divRead").is(":visible")||$("#divMyFiles").is(":visible")||ShowMessageListPane(),0==gCurrentSelectedNode.length&&DisplayInbox()));DataItemList_SetScrollPosition(gUnitScrollLength);layoutEmail.resizeAll();break;case TAB_VIEW_CONTACTS:SetCurrentView(VIEW_CONTACTS);
ShowStatusBarValues(VIEW_CONTACTS);doInitLayout("frmContacts");break;case TAB_VIEW_CALENDAR:SetCurrentView(VIEW_CALENDAR);ShowStatusBarValues(VIEW_CALENDAR);g_opt.OffsetMismatch&&ShowNotification(t_("[ME_TXT-Check-TimeZone-Settings]"));doInitLayout("frmCalendar");break;case TAB_VIEW_TASKS:SetCurrentView(VIEW_TASKS);ShowStatusBarValues(VIEW_TASKS);doInitLayout("frmTasks");break;case TAB_VIEW_STATS:SetCurrentView(VIEW_STATS);ShowStatusBarValues(VIEW_STATS);doInitLayout("frmStats");break;case TAB_VIEW_SEARCH:SetCurrentView(VIEW_SEARCH);
ShowStatusBarValues(VIEW_SEARCH);break;case TAB_VIEW_CHAT:SetCurrentView(VIEW_CHAT);ShowStatusBarValues(VIEW_CHAT);doInitLayout("frmChat");break;case TAB_VIEW_OPTIONS:SetCurrentView(VIEW_OPTIONS);ShowStatusBarValues(VIEW_OPTIONS);doInitLayout("frmOptions");break;case TAB_VIEW_ADMIN:SetCurrentView(VIEW_ADMIN),ShowStatusBarValues(VIEW_ADMIN)}(new IECompatibility).IsOn&&ShowNotification(t_("[ME_TXT-Bad-Browser-Compat]"))}catch(c){}}
function HideOtherTabViews(a){for(var b=0;b<TAB_VIEW_COUNT;b++)if(b!=a)switch(b){case TAB_VIEW_EMAIL:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_EMAIL)));break;case TAB_VIEW_CONTACTS:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_CONTACTS)));break;case TAB_VIEW_CALENDAR:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_CALENDAR)));break;case TAB_VIEW_TASKS:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_TASKS)));break;case TAB_VIEW_STATS:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_STATS)));
break;case TAB_VIEW_CHAT:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_CHAT)));break;case TAB_VIEW_SEARCH:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_SEARCH)));break;case TAB_VIEW_OPTIONS:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_OPTIONS)));break;case TAB_VIEW_ADMIN:hideElement(document.getElementById(GetDivViewID(TAB_VIEW_ADMIN)))}}
function GetDivViewID(a){switch(a){case TAB_VIEW_EMAIL:return"divEmail";case TAB_VIEW_CONTACTS:return"divContacts";case TAB_VIEW_CALENDAR:return"divCalendar";case TAB_VIEW_TASKS:return"divTasks";case TAB_VIEW_STATS:return"divStats";case TAB_VIEW_CHAT:return"divChat";case TAB_VIEW_OPTIONS:return"divOptions";case TAB_VIEW_ADMIN:return"divAdmin";default:return"divEmail"}}
function SetPageContent(a,b,c,d){var e=(new Date).getTime();document.getElementById(a).style.display="";a="?";/\?/.test(c)&&(a="&");d&&""!=d?document.getElementById(b).src=c+a+"TS="+e+"&ID="+d:IsBlankSrc(document.getElementById(b).src)&&(document.getElementById(b).src=c+a+"TS="+e)}
function HideOtherPageContexts(a,b){void 0==b&&(b=!0);if(a!=CONTEXT_COMPOSE&&b&&window.frames.frmCompose&&window.frames.frmCompose.AutosaveDraft)try{window.frames.frmCompose.AutosaveDraft(),HidePane("divCompose"),HidePane("divSearch")}catch(c){}for(b=0;b<CONTEXT_COUNT;b++)if(b!=a)switch(b){case CONTEXT_SEARCH:document.getElementById("divSearch").style.display="none";break;case CONTEXT_PUBLIC_FOLDERS:document.getElementById("divRead").style.display="none";break;case CONTEXT_ACCOUNT_SUMMARY:document.getElementById("divAccountSummary").style.display=
"none";break;case CONTEXT_READ:document.getElementById("divRead").style.display="none"}}function getParameterByName(a,b){b||(b=window.location.href);a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}
function SetPageContextMode(a,b,c,d){oTimeoutDialog.ResetSession();if(!gAllowPageActions)return!1;void 0==b&&(b=!0);var e=GetCurrentView(),f=null;try{f=arrTree[gCurrentSelectedNode].RelativeFolderPath}catch(h){}if(a==CONTEXT_AUTODETECT)if(a=GetViewFromSelectedNode(gCurrentSelectedNode),a==VIEW_SHARES)a=CONTEXT_SHARES;else if(a==VIEW_FILES)a=CONTEXT_FILES_FOLDERS;else if(a==VIEW_OPTIONS)a=CONTEXT_OPTIONS;else{if(a==VIEW_PERSONAL)return gCurrentSelectedNode==GetDefaultMailboxRootNode(g_opt.Mailbox)?
ReloadSummaryPage():(HidePane("divCompose"),HideReadPane(),ShowMessageListPane(),HidePane("divSearch"),1==gSelectedIM.GetSize()?(c=gSelectedIM.GetFirstSelectedItem(),void 0==gSelectedMessageID?HidePreviewPane():gSelectedMessageID==c&&ShowPreviewPane()):HidePreviewPane()),!0;a=CONTEXT_PERSONAL_FOLDERS}HideOtherPageContexts(a,b);b=document.getElementById("frmCompose");a==CONTEXT_COMPOSE?b&&b.HookResizeEvent&&b.HookResizeEvent():b&&b.UnhookResizeEvent&&b.UnhookResizeEvent();b=(new Date).getTime();a!=
CONTEXT_PERSONAL_FOLDERS&&a!=CONTEXT_PUBLIC_FOLDERS||ShowListPane(e);a!=CONTEXT_SHARES||gCurrentView!=VIEW_READ&&gCurrentView!=VIEW_PERSONAL||(GetSelectedFolderPath(VIEW_PERSONAL),ShowListPane(VIEW_PERSONAL));a==CONTEXT_SEARCH&&(gCurrentFolderContext=CONTEXT_PERSONAL_FOLDERS,SetCurrentView(VIEW_PERSONAL),ShowSearchPane(),HideMyFilesPane(),HideNotesPane(),HidePane("divCompose"),HidePane("divAccountSummary"));switch(a){case CONTEXT_PERSONAL_FOLDERS:gCurrentFolderContext=CONTEXT_PERSONAL_FOLDERS;SetCurrentView(VIEW_PERSONAL);
HideMyFilesPane();HideNotesPane();HidePane("divCompose");HidePane("divSearch");break;case CONTEXT_PUBLIC_FOLDERS:e&&e!=VIEW_PERSONAL&&e!=VIEW_PUBLIC&&e!=VIEW_CONTACTS&&e!=VIEW_CALENDAR?HideRightPane():ShowListPane(e);HideMyFilesPane();HideNotesPane();HidePane("divCompose");HidePane("divSearch");gCurrentFolderContext=CONTEXT_PUBLIC_FOLDERS;SetCurrentView(VIEW_PUBLIC);break;case CONTEXT_COMPOSE:ShowComposePage();break;case CONTEXT_CONTACTS:if(e=GetOption("DefaultContactsSource")){var g=0;"directory"==
e.toLowerCase()?g=SOURCE_DIRECTORY:"contacts"==e.toLowerCase()&&(g=SOURCE_ADDRESSBOOK)}e=document.getElementById("frmContacts");if(IsBlankSrc(e.src)||c)g="./Forms/VCF/list.aspx?TS="+b+"&Source="+g+(c?"&ID="+encodeURIComponent(c):""),d?g+="&URI="+encodeURIComponent(d):f&&(g+="&URI="+f),"1"==gOptions.AllowThemes&&(c=gOptions.Theme?"&theme="+gOptions.Theme:"",g+=c),e.src=g;SelectViewTab(TAB_VIEW_CONTACTS);break;case CONTEXT_CALENDAR:document.getElementById("divCalendar").style.display="";e=document.getElementById("frmCalendar");
g=getTopAppWindow().g_opt.CalAppURI+"list.aspx?TS="+b;if(IsBlankSrc(e.src)||c)c&&""!=c&&(g+="&ID="+c),d?g+="&URI="+d:f&&(g+="&URI="+f),e.src=g;SelectViewTab(TAB_VIEW_CALENDAR);break;case CONTEXT_TASKS:e=document.getElementById("frmTasks");if(IsBlankSrc(e.src)||c)g="./Forms/TSK/list.aspx?TS="+b+"&Source="+g+(c?"&ID="+encodeURIComponent(c):""),d?g+="&URI="+encodeURIComponent(d):f&&(g+="&URI="+f),e.src=g;SelectViewTab(TAB_VIEW_TASKS);break;case CONTEXT_NOTES:HideRightPane();ShowNotesPage();document.getElementById("frmNotes").src=
"./Forms/NOTE/list.aspx?TS="+b;document.getElementById("frmNotes").focus();SetCurrentView(VIEW_NOTES);ShowStatusBarValues(VIEW_NOTES);break;case CONTEXT_STATS:c="";"1"==gOptions.AllowThemes&&(c=gOptions.Theme?"?theme="+gOptions.Theme:"");SetPageContent("divStats","frmStats","./Forms/Statistics.aspx"+c);SelectViewTab(TAB_VIEW_STATS);break;case CONTEXT_CHAT:SetPageContent("divChat","frmChat","./Forms/CHAT/default.aspx");SelectViewTab(TAB_VIEW_CHAT);break;case CONTEXT_SEARCH:document.getElementById("divSearch").style.display=
"";SetCurrentView(TAB_VIEW_SEARCH);break;case CONTEXT_ADMIN:c="/meadmin";/\/mewebmail/i.test(window.location)||(d=/^([A-Za-z]+:\/\/)[^/.]+(\.[^\/]+)/.exec(window.location))&&(c=d[1]+"webadmin"+d[2]);SetPageContent("divAdmin","frmAdmin",c+"/Mondo/lang/sys/login.aspx?ShowShell=0");SelectViewTab(TAB_VIEW_ADMIN);break;case CONTEXT_FOLDERS:document.getElementById("divFolders").style.display="";document.getElementById("frmFolders").src="./Forms/ManageFolders.aspx?ShowSpecialFolders=1&TS="+b;SetCurrentView(VIEW_FOLDERS);
break;case CONTEXT_OPTIONS:c=document.getElementById("frmOptions");IsBlankSrc(c.src)&&(c.src="./Forms/Options.aspx?TS="+b);SelectViewTab(TAB_VIEW_OPTIONS);break;case CONTEXT_TIMEOUT:document.getElementById("divTimeout").style.display="";SetCurrentView(VIEW_TIMEOUT);break;case CONTEXT_FILES_FOLDERS:HideRightPane();ShowMyFilesPage();void 0!=c&&""!=c&&(document.getElementById("frmMyFiles").src="./Forms/FLS/list.aspx?TS="+b+"&Folder="+encodeURIComponent(c),document.getElementById("frmMyFiles").focus());
SetCurrentView(VIEW_FILES);ShowStatusBarValues(VIEW_FILES);break;case CONTEXT_ACCOUNT_SUMMARY:document.getElementById("divAccountSummary").style.display="";SetCurrentView(VIEW_ACCOUNT_SUMMARY);break;case CONTEXT_READ:HidePreviewPane();HideMessageListPane();ShowReadPane();document.getElementById("frmRead").focus();SetCurrentView(VIEW_READ);break;case CONTEXT_SHARES:SetCurrentView(VIEW_SHARES),HideMyFilesPane(),HideNotesPane(),HidePane("divCompose"),HidePane("divSearch"),gCurrentFolderContext=CONTEXT_SHARES}}
function HideRightPane(){HidePane("divCompose");HidePane("divSearch");HideReadPane()}function HideFolderContentsPane(){HideMessageListPane();HidePreviewPane();HidePane("divCompose");HidePane("divSearch");HideReadPane()}function ShowFolderContentsPane(){ShowMessageListPane();ShowPreviewPane()}
function HideMessageListPane(){GetOptionValue("WebMail-MessagePreviewPane")?gPreviewMode==VIEW_RIGHT?layoutEmailInner.hide("west"):gPreviewMode==VIEW_BOTTOM&&layoutEmailInner.hide("north"):(layoutEmailInner.hide("west"),gBrowserType==BROWSER_TYPE_CHROME&&$("#innerCenter").show());$(".previewPane_toggle_menu").hide().data("toggle","false")}
function ShowMessageListPane(){try{layoutEmailInner&&(GetOptionValue("WebMail-MessagePreviewPane")?gPreviewMode==VIEW_RIGHT?layoutEmailInner.show("west"):gPreviewMode==VIEW_BOTTOM&&layoutEmailInner.show("north"):(layoutEmailInner.show("west"),gBrowserType!=BROWSER_TYPE_CHROME&&gBrowserType!=BROWSER_TYPE_SAFARI||$("#innerCenter").hide())),SetFieldFocus(LIST_ID),$(".previewPane_toggle_menu").show().data("toggle","true")}catch(a){}}
function ClearPreviewPane(){var a=document.getElementById("divPreviewPane");a&&(a.style.display="",a.style.visibility="hidden",a.style.position="absolute",a.style.top="1000000px")}function ShowEmptyPreviewPane(){GetOption("WebMail-MessagePreviewPane")?ClearPreviewPane():HidePreviewPane()}
function ShowPreviewPane(){var a=getTopAppWindow().document.getElementById("divPreviewPane");a&&(a.style.display="",a.style.visibility="visible",a.style.position="",a.style.top="");ResizePreviewDropDown();ResizePreviewPanel()}function HidePreviewPane(){var a=getTopAppWindow().document.getElementById("divPreviewPane");a&&(a.style.display="none")}function PreviewPaneIsVisible(){var a=getTopAppWindow().document.getElementById("divPreviewPane");return a&&"none"!=a.style.display?!0:!1}
var gComposePageLoaded=!1;function ShowComposePage(){if(GetOption("WebMail-AllowNewWindows"))return!0;SetCurrentView(VIEW_COMPOSE);SetPrevEmailView(VIEW_COMPOSE);HideMessageListPane();HidePreviewPane();HideReadPane();HideNotesPane();ShowComposePane();gComposePageLoaded=!0}function HideAlliFramePane(){$(".pane-iframe-shell").hide()}function ShowPane(a,b){SelectViewTab(b);GetOption("WebMail-MessagePreviewPane")||layoutEmailInner.panes.center.show();HideAlliFramePane();$("#"+a).show()}
function HidePane(a){$("#"+a).hide()}function ShowComposePane(){GetOption("WebMail-MessagePreviewPane")||layoutEmailInner.panes.center.show();HideAlliFramePane();$("#divCompose").show()}function ShowReadPane(){GetOption("WebMail-MessagePreviewPane")||layoutEmailInner.panes.center.show();HideAlliFramePane();$("#divRead").show()}function HideReadPane(){$("#divRead").hide()}function ShowMyFilesPage(){HideMessageListPane();HidePreviewPane();HideReadPane();HideNotesPane();ShowMyFilesPane()}
function ShowMyFilesPane(){GetOption("WebMail-MessagePreviewPane")||layoutEmailInner.panes.center.show();HideAlliFramePane();$("#divMyFiles").show()}function HideNotesPane(){$("#divNotes").hide()}function ShowNotesPane(){HideAlliFramePane();$("#divNotes").show()}function ShowNotesPage(){HideAlliFramePane();HideMessageListPane();HidePreviewPane();HideReadPane();HideMyFilesPane();ShowNotesPane()}function HideMyFilesPane(){$("#divMyFiles").hide()}function HideNotesPane(){$("#divNotes").hide()}
function ResizePreviewDropDown(a){if("sort"==a){if(gPreviewMode==VIEW_RIGHT){var b="toolbar_sort_msgList_js";var c="bttn_dropDown_sort_msgList"}}else gPreviewMode==VIEW_RIGHT?(b="toolbar_more_preview_js",c="bttn_dropDown_more_preview_js"):(b="toolbar_more_msgList_js",c="bttn_dropDown_more_msgList");if(b)try{document.getElementById(b).style.width="300px";var d=document.getElementById(c).clientWidth;document.getElementById(b).style.width=d+DROPDOWNBTTN_PADDING+"px"}catch(e){}}
function BackgroundLoadComposeFrame(){var a=document.getElementById("frmCompose");a&&IsBlankSrc(a.src)&&(gShowComposePageOnLoad=!0,ShowWait(t_("[ME_TXT-Pleasewait]")+"..."),a.src="./Forms/MAI/"+gEditorPage+"?Mode=Add&WindowContext=Embedded")}function ContinueComposingDraft(){BackgroundLoadComposeFrame();ProcessComposeCmd("Compose",SELECTED_LIST_ITEM)}
function DoComposeSMS(a){if(!gAllowPageActions)return!1;SelectViewTab(TAB_VIEW_EMAIL);a="./Forms/SMS/Compose.aspx?Mode=Add";GetOption("WebMail-AllowNewWindows")?OpenNewWindow(a,800,600):window.frames.frmCompose&&(a+="&WindowContext=Embedded",document.getElementById("frmCompose").src=a,ShowComposePage())}
function DoCompose(a){if(!gAllowPageActions)return!1;SelectViewTab(TAB_VIEW_EMAIL);var b=GetSelectedFolderPath();a?ComposeMessage():"/DRAFTS"==b.toUpperCase()?ContinueComposingDraft():ComposeMessage()}function ClearComposePage(){var a=window.frames.frmCompose;a&&a.ClearContents?(gComposeMsgID="",SetPageContextMode(CONTEXT_COMPOSE),a.ClearContents(),a.ResetAutoSignature()):window.setTimeout(function(){ClearComposePage()},500)}
function ComposeMessage(a){if(!gAllowPageActions)return!1;var b="";b=a?a:"./Forms/MAI/"+gEditorPage+"?Mode=Add";if(GetOption("WebMail-AllowNewWindows"))OpenNewWindow(b,800,600);else{var c=window.frames.frmCompose;c?(gComposeMsgID="",b+="&WindowContext=Embedded",void 0!=c.TextChanged?(a&&(document.getElementById("frmCompose").src=b),ShowComposePage(),1==c.NeedCheckForChange&&c.CheckForAnyChanges&&c.CheckForAnyChanges(),1==c.TextChanged?oConfirmation.Confirm(t_("[ME_TXT-Confirm]"),t_("[ME_TXT-YouhaveunsavedchangesDoyouwishtodiscardthem?]"),
function(){ClearComposePage()}):(SetPageContextMode(CONTEXT_COMPOSE),c.ClearContents(),c.ResetAutoSignature())):(gShowComposePageOnLoad=!0,document.getElementById("frmCompose").src=b)):(gShowComposePageOnLoad=!0,document.getElementById("frmCompose").src=b)}}function AddMsgFlag(a,b){a.indexOf(b)}
function ProcessComposeCmd(a,b){if(!gAllowPageActions||("Reply"==a||"ReplyAll"==a||"Forward"==a)&&!HasSingleItemSelected())return!1;var c=GetSelectedFolderPath();c=c.replace(/&lt;/g,"<");c=c.replace(/&gt;/g,">");var d=gSelectedIM.GetFirstSelectedItem();"Compose"==a&&(gComposeMsgID=d);var e=ItemsArray_Find(d);-1!=e&&("Reply"!=a&&"ReplyAll"!=a||AddMsgFlag(oItemsArray[e].Flags,"ANSWERED"),"Forward"==a&&AddMsgFlag(oItemsArray[e].Flags,"$Forwarded"));var f=(new Date).getTime();var g=gSourceURI&&0<gSourceURI.length?
"URI="+encodeURIComponent(gSourceURI)+"&":"";b="./Forms/MAI/"+gEditorPage;-1!=e&&"IPM.Note.Mobile.SMS"==oItemsArray[e].Class&&(b="./Forms/SMS/"+gEditorPage);b+="?"+g+"Mode="+a+"&ID="+d+"&Folder="+JSEscapeStr(encodeURIComponent(c))+"&TS="+f;if(d&&0<d.length)if(GetOption("WebMail-AllowNewWindows"))OpenNewWindow(b,800,600);else if(b+="&WindowContext=Embedded",a=window.frames.frmCompose)a&&a.ClearContents&&(a.ClearContents(),a.ResetAutoSignature&&a.ResetAutoSignature()),gShowComposePageOnLoad=!0,ShowWait(t_("[ME_TXT-Pleasewait]")+
"..."),document.getElementById("frmCompose").src=b;return!0}
function ME_Print(){if(!gAllowPageActions||!HasSingleItemSelected())return!1;var a=GetSelectedFolderPath();a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");var b=gSelectedIM.GetFirstSelectedItem(),c=(new Date).getTime();a="./Forms/MAI/PrintPreview.aspx?"+(gSourceURI&&0<gSourceURI.length?"URI="+gSourceURI+"&":"")+"&method=window&ID="+b+"&Folder="+JSEscapeStr(encodeURIComponent(a))+"&BlockImages="+(gImagesBlocked?1:0)+"&TS="+c;OpenNewWindow(a,800,600);return!0}
function ShowBannerPanel(){document.getElementById("tdTopNavRight")&&(document.getElementById("tdTopNavRight").style.display="")}function HideBannerPanel(){document.getElementById("tdTopNavRight")&&(document.getElementById("tdTopNavRight").style.display="none")}
function SetColumnStyles(a){gPreviewMode==VIEW_RIGHT?(DataItemList_AddTableColumn(0,a,"Received","Summary","","","",t_("[ME_TXT-Summary]"),t_("[ME_TXT-SortByReceivedDate]"),"Summary"),a=1):(DataItemList_AddTableColumn(0,a,"","SelectAll","left","dataTable_tickbox","dataTable_tickbox","",t_("[ME_TXT-Select/DeselectAll]"),"SelectAll"),DataItemList_AddTableColumn(1,a,"Importance","Importance","left","dataTable_icon_short","dataTable_icon_short","",t_("[ME_TXT-SortByImportance]"),"Importance"),DataItemList_AddTableColumn(2,
a,"Flag","Flag","left","dataTable_icon","dataTable_icon","",t_("[ME_TXT-SortByFlag]"),"Flag"),DataItemList_AddTableColumn(3,a,"Read","Read Status","left","dataTable_icon","dataTable_icon","",t_("[ME_TXT-SortByReadStatus]"),"Read"),DataItemList_AddTableColumn(4,a,"Attachments","Attachments","left","dataTable_icon_short","dataTable_icon_short","",t_("[ME_TXT-SortByAttachments]"),"Attachments"),DataItemList_AddTableColumn(5,a,"From","From","","dataTable_from","dataTable_from",t_("[ME_TXT-From]"),t_("[ME_TXT-SortBySender]"),
"Label"),DataItemList_AddTableColumn(6,a,"Subject","Subject","","dataTable_noWidth","dataTable_noWidth",t_("[ME_TXT-Subject]"),t_("[ME_TXT-SortBySubject]"),"Label"),DataItemList_AddTableColumn(7,a,"RECEIVED","RecvDate","left","dataTable_date","dataTable_date",t_("[ME_TXT-Date]"),t_("[ME_TXT-SortByReceivedDate]"),"Label"),DataItemList_AddTableColumn(8,a,"SIZE","Size","left","dataTable_size_right","dataTable_size_right",t_("[ME_TXT-Size]"),t_("[ME_TXT-SortBySize]"),"Label"),a=9);return a}
function ViewAttachments(a,b){var c=(new Date).getTime(),d="",e=ItemsArray_GetItem(a);e&&(d=e.URI?"URI="+encodeURIComponent(e.URI)+"&":"");a=0<d.length?"./Forms/MAI/ListAttachments.aspx?"+d+"ID="+a+"&ComposeMode=Attachments&Preview=0&Mode=Read&TS="+c:"./Forms/MAI/ListAttachments.aspx?ID="+a+"&Folder="+encodeURIComponent(b)+"&ComposeMode=Attachments&Preview=0&Mode=Read&TS="+c;GetOption("WebMail-AllowNewWindows")?OpenNewWindow(a,800,600):(b=document.getElementById("frmRead"),a=a+"&WindowContext=Embedded&Source="+
gCurrentView,b.style.visibility="",b.src=a,gAllowPageActions=!0,SetPageContextMode(CONTEXT_READ))}function ShowHideVCalElements(a){var b=document.getElementById("trVCalAppointment"),c=document.getElementById("tblVCalAppointment");0==a?(b.style.display="none",c.style.display="none"):1==a&&(b.style.display="",c.style.display="")}function GetBuddyStatus(a){try{var b=window.frames.frmChat;if(b&&b.JSXC_GetBuddyStatus)return b.JSXC_GetBuddyStatus(a)}catch(c){}return 0}
function DoBuddyChat(a){try{var b=window.frames.frmChat;b&&b.jsxc.gui.window.open(a)}catch(c){}return 0}
function ShowChatStatus(a){try{var b=$(".chat_status"),c="green",d=GetBuddyStatus(a);b.show();switch(d){case 0:c="white";break;case 1:c="red";break;case 2:c="orange";break;case 3:c="yellow";break;case 4:c="lightgreen";break;case 5:c="green";break;default:c="white",b.hide()}if(0<d)$(".chat_status").on("click",function(){SetPageContextMode(CONTEXT_CHAT);DoBuddyChat(a)});b.css("background-color",c)}catch(e){}}
function SetPreviewPaneData(a,b,c){ShowPreviewContacts(getItemInstance("divPreviewTo",c),a.MsgTo,!0);a.MsgCc&&0<a.MsgCc.length?(getItemInstance("trPreviewCc",c).style.display="",ShowPreviewContacts(getItemInstance("divPreviewCc",c),a.MsgCc)):getItemInstance("trPreviewCc",c).style.display="none";if(a.MsgBcc&&0<a.MsgBcc.length){getItemInstance("trPreviewBcc",c).style.display="";var d=getItemInstance("divPreviewBcc",c);d&&ShowPreviewContacts(d,a.MsgBcc)}else getItemInstance("trPreviewBcc",c).style.display=
"none";-1==a.FromAddress.indexOf("[MOBILE:")&&a.From!=a.FromAddress?ShowPreviewContacts(getItemInstance("divFromAddr",c),'"'+a.From+'" ('+a.FromAddress+")"):ShowPreviewContacts(getItemInstance("divFromAddr",c),a.FromAddress,!0);try{if(encodeURIComponent(a.FromAddress)){$(".popup_bizCard_right_img img").hide();var e=getAppServletURL()+"?Cmd=GET-CONTACT&ID="+encodeURIComponent(a.FromAddress)+"&Folder=/Contacts&Options=PHOTO,FIELD=EMAIL_PREF_INTERNET&ME_SID="+readCookie("MailEnable-SessionId")+"&ME_VALIDATIONTOKEN="+
getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;$(".popup_bizCard_right_img img").attr("src",e);$(".popup_bizCard_right_img img").show()}else $(".popup_bizCard_right_img img").hide()}catch(f){}ShowChatStatus(a.FromAddress);SetElementText(getItemInstance("tdPreviewSubject",c),a.Subject);SetElementTitle(getItemInstance("tdPreviewSubject",c),a.Subject);(d=a.LocalDate)&&0!=d.length||(d=a.RecvDate);SetElementText(getItemInstance("tdPreviewReceivedDate",c),d);SetElementTitle(getItemInstance("tdPreviewReceivedDate",
c),a.RecvDate);"1"==a.HasAttachments?(ShowHidePreviewAttachments(1,c),SetElementText(getItemInstance("tdPreviewAttachmentList",c),""),gViewAttachFnRef=function(){ViewAttachments(a.MessageID,a.Folder)},$("#lnkAttachments").off("click").on("click",gViewAttachFnRef),ProcessAttachments(b,c)):ShowHidePreviewAttachments(0,c);a.IsVCalAppointment?GetOptionValue("Calendaring Enabled")?(a.VCalMethod&&0<a.VCalMethod.length&&("REQUEST"==a.VCalMethod.toUpperCase()?AddVCalResponseAction("tdVCalPrompt",t_("[ME_TXT-AnAppointmentRequestIsAttachedToThisMessage]")+
": ",a.MessageID,a.Folder):"COUNTER"==a.VCalMethod.toUpperCase()?(b=GetResponsePrompt(sAttendees)+" "+t_("[ME_TXT-UpdateYourCalendar?]")+" ",AddVCalUpdateAttendeeAction("tdVCalPrompt",b,a.MessageID,a.Folder)):"REPLY"==a.VCalMethod.toUpperCase()?(b=GetResponsePrompt(sAttendees)+" "+t_("[ME_TXT-UpdateYourCalendar?]")+" ",AddVCalUpdateAttendeeAction("tdVCalPrompt",b,a.MessageID,a.Folder)):"PUBLISH"==a.VCalMethod.toUpperCase()?AddVCalUpdateAction("tdVCalPrompt",t_("[ME_TXT-AnAppointmentUpdateIsAttachedToThisMessage]")+
" "+t_("[ME_TXT-UpdateYourCalendar?]"),a.MessageID,a.Folder):"CANCEL"==a.VCalMethod.toUpperCase()&&AddVCalCancelAction("tdVCalPrompt",t_("[ME_TXT-TheAttachedAppointmentHasBeenCancelled]")+" "+t_("[ME_TXT-RemoveFromCalendar?]"),a.MessageID,a.Folder)),ShowHideVCalElements(1)):ShowHideVCalElements(0):ShowHideVCalElements(0);"search"!=c&&($("#ListUnsubscribeButton").toggle(""!=a.UnsubscribeCommand).data("UnsubscribeCommand",a.UnsubscribeCommand),$("#AddToContactsButton").toggle(!(!gContactsEnabled||a.IsSMS)),
$("#AddToWhiteListButton, .toolbar_icon_whitelist").toggle(!(!gWhitelistEnabled||a.IsSMS)),$("#AddToBlackListButton, .toolbar_icon_blacklist").toggle(!(!gBlacklistEnabled||a.IsSMS)));return!0}
function DeserialiseMessage(a,b){a.IsSMS=!1;var c=null;var d=b.childNodes[0];a.MessageID=GetXMLValue(d.attributes.getNamedItem("ID"));if("0"==GetXMLValue(b.getElementsByTagName("RETURNVALUE")[0]))return a=GetXMLValue(b.getElementsByTagName("ERROR_DESCRIPTION")[0]),ShowAlert(t_("[ME_TXT-Error]"),a,!0),!1;try{a.Folder=GetXMLValue(d.getElementsByTagName("FOLDER")[0]);a.Subject=HTMLDecode(GetXMLValue(d.getElementsByTagName("SUBJECT")[0],!0));a.RecvDate=GetXMLValue(d.getElementsByTagName("RECEIVED")[0]);
try{a.LocalDate=GetXMLValue(d.getElementsByTagName("LOCALDATE")[0])}catch(q){}var e=d.getElementsByTagName("FROM")[0],f=d.getElementsByTagName("FROM_ADDRESS")[0],g=d.getElementsByTagName("TO")[0],h=d.getElementsByTagName("CC")[0],k=d.getElementsByTagName("BCC")[0],l,m,n;e&&(l=GetXMLValue(e.attributes.getNamedItem("ENC")).toUpperCase());g&&(m=GetXMLValue(g.attributes.getNamedItem("ENC")).toUpperCase());h&&(n=GetXMLValue(h.attributes.getNamedItem("ENC")).toUpperCase());a.MsgTo="BASE64"==m?decode64(GetXMLValue(g)):
FormatRFC822AddressList(GetXMLValue(g));a.MsgCc="BASE64"==n?decode64(GetXMLValue(h)):FormatRFC822AddressList(GetXMLValue(h));a.MsgBcc="BASE64"==n?decode64(GetXMLValue(k)):FormatRFC822AddressList(GetXMLValue(k));a.From="BASE64"==l?decode64(GetXMLValue(e)):FormatRFC822AddressList(GetXMLValue(e));a.FromAddress="BASE64"==l?decode64(GetXMLValue(f)):FormatRFC822AddressList(GetXMLValue(f));c=d.getElementsByTagName("ATTACHMENTS")[0];a.HasAttachments=GetXMLValue(c.attributes.getNamedItem("EXISTS"));(VCalNode=
d.getElementsByTagName("VCAL_APPOINTMENT")[0])?(a.IsVCalAppointment=!0,a.VCalMethod=VCalNode.attributes.getNamedItem("METHOD").nodeValue,sAttendees=GetXMLValue(VCalNode.getElementsByTagName("ATTENDEE")[0])):a.IsVCalAppointment=!1;a.IsSMS="IPM.Note.Mobile.SMS"==GetXMLValue(d.getElementsByTagName("CLASS")[0]);a.UnsubscribeCommand=GetXMLValue(d.getElementsByTagName("UNSUBSCRIBE")[0]);var p=d.getElementsByTagName("BODY");0<p.length&&(a.Body=GetXMLValue(p[0],!0));p=d.getElementsByTagName("IMGLIST");a.IMGLIST=
0<p.length?GetXMLValue(p[0],!0):""}catch(q){Body=t_("[ME_TXT-UnableToDisplay]")}return!0}function getThemeCSS(a){for(var b={},c=["background-color","color"],d=c.length,e=0;e<d;e++){var f=a.css(c[e]);f&&(b[c[e]]=f)}return b}
function ProcessMessage(a){HideLoadingPreview();var b=null;try{b=GetXMLValue(a.childNodes[0].attributes.getNamedItem("targetinstance"))}catch(f){}try{gImagesBlocked=GetXMLValue(a.childNodes[0].attributes.getNamedItem("blockimages"))}catch(f){}var c={};if(!DeserialiseMessage(c,a))return!0;var d=null;try{d=a.childNodes[0].getElementsByTagName("ATTACHMENTS")[0]}catch(f){}var e=GetSelectedFolderPath();if(gEnableRR&&"/DRAFTS"!=e.toUpperCase()&&"/SENT ITEMS"!=e.toUpperCase())try{(ReceiptTo=GetXMLValue(a.getElementsByTagName("RECEIPTTO")[0]))&&
0<ReceiptTo.length&&PromptForReceiptDispatch(c.MessageID,UnEscapeJSBackslash(c.Folder),c.From,c.Subject)}catch(f){}ClearPreviewFields();HidePreviewFields();SetPreviewPaneData(c,d,b);"undefined"===typeof c.Body?(a="",isSharedFolder(e)&&(a=GetShareURI(e,g_opt.Postoffice)),c="./Forms/MAI/msgbody.aspx?ID="+c.MessageID+"&HasAttachments="+c.HasAttachments,d=(new Date).getTime(),c=""==a?c+("&Folder="+encodeURIComponent(e)):c+("&URI="+encodeURIComponent(a)),c+="&TS="+d,(e=getItemInstance("ifPreviewBody",
b))?e.src=c:Ajax_LoadPage&&Ajax_LoadPage(document.getElementById("bodyCol_msg_shell_js"),c)):(e=$("#ifPreviewBody").contents().find("body"),null==e.html()&&$("#bodyCol_msg_shell_js").html('<iframe id="ifPreviewBody" name="ifPreviewBody" frameborder="0" src="javascript:\'\'" allowTransparency="true" style="background-color:Transparent;"></iframe>'),e=$("#ifPreviewBody").contents().find("body"),e.css(getThemeCSS($("body"))),e.html(c.Body+c.IMGLIST),"1"==gOptions.AllowThemes&&"Dark"==gOptions.Theme&&
ApplyThemeToContent(e),e.find(".me-remote-image").text(t_("[ME_TXT-ImageNotLoaded]")));ResizePreviewPanel(b);gPreviewMode==VIEW_RIGHT?ResizeToolbarIcons("toolbar_primary_table_left_js"):gPreviewMode==VIEW_BOTTOM&&ResizeToolbarIcons("toolbar_primary_table_left_msgList_js");return!0}function ApplyThemeToContent(a){a.find("div,p,td,tr,table,h1,h2,h3,h4").each(function(b){this.style.color&&0<this.style.color.length&&(this.style.color="")});a.find("a").each(function(b){this.style.color="#1B7DAC"})}
function SendReadReceipt(a,b){1==ServerRequest("SEND-RECEIPT","Folder="+a+"&ID="+b,!1)&&ShowNotification(t_("[ME_TXT-ReadReceiptSent!]"))}function ViewAppointmentDetails(a){var b=(new Date).getTime();a=a+"&WindowContext=Embedded&TS="+b;document.getElementById("frmRead").style.visibility="";document.getElementById("divRead").style.display="";document.getElementById("frmRead").src=a;SetPageContextMode(CONTEXT_READ)}
function PDFPreview(a){$("#bodyCol_msg_shell_js").html('<embed type="application/pdf" style="height:100%;width:100%" src="'+a+'">')}
function ProcessAttachments(a,b){var c=a.getElementsByTagName("ITEM"),d=0,e=!1,f=GetXMLValue(a.getElementsByTagName("MESSAGEID")[0]);a=GetXMLValue(a.getElementsByTagName("FOLDER")[0]);var g=!1;SetElementText(getItemInstance("tdPreviewAttachmentList",b),"");for(var h=!1,k={},l=0;l<c.length;k={$jscomp$loop$prop$sPreviewURL$13:k.$jscomp$loop$prop$sPreviewURL$13},l++){g=e=!1;var m=c[l],n=GetXMLValue(m.getElementsByTagName("READER")[0]),p=GetXMLValue(m.getElementsByTagName("MODE")[0]),q=GetXMLValue(m.getElementsByTagName("TYPE")[0]),
v=GetXMLValue(m.getElementsByTagName("CID")[0]),u=GetXMLValue(m.getElementsByTagName("FILENAME")[0]),t=GetXMLValue(m.getElementsByTagName("SEQUENCE")[0]);a=a.replace(/\\/ig,"/");var r=n;p&&0<p.length&&(r=r+"&Mode="+encodeURIComponent(p));r+="&MessageID="+encodeURIComponent(f)+"&Folder="+encodeURIComponent(a);r+="&Filename="+encodeURIComponent(u)+"&Seq="+t;d||"image/jpeg"!=q&&"image/gif"!=q&&"image/pjpeg"!=q&&"image/png"!=q||""!=v||(d=1);"text/calendar"==q&&(e=!0);p=GetFilenameExtension(u);"audio/mpeg"==
q||"audio/mp3"==q?g=!0:"application/octet-stream"==q&&IsMP3Ext(p)&&(g=!0);e&&(r="javascript:ViewAppointmentDetails('"+escape(r)+"');");e=document.createElement("a");e.href=r;m=GetXMLValue(m.getElementsByTagName("NAME")[0]);0<l&&!h&&(gBrowserType==BROWSER_TYPE_CHROME&&g?(getItemInstance("tdPreviewAttachmentList",b).appendChild(document.createElement("br")),getItemInstance("tdPreviewAttachmentList",b).appendChild(document.createElement("br"))):getItemInstance("tdPreviewAttachmentList",b).appendChild(document.createTextNode(", ")));
h=!1;e.appendChild(document.createTextNode(m));getItemInstance("tdPreviewAttachmentList",b).appendChild(e);gMediaPlayerEnabled&&g&&(m=m.replace(/'/g,"\\'"),a=a.replace(/'/g,"\\'"),g=n+"&MessageID="+f+"&Folder="+a+"&Filename="+m+"&Seq="+t,gBrowserType==BROWSER_TYPE_CHROME&&(h=!0,$('<br/><br/><audio src="'+g+'" controls="controls" style="width:280px;height:10px;"></audio><br/><br/>').appendTo("#tdPreviewAttachmentList")));navigator&&navigator.mimeTypes&&navigator.mimeTypes["application/pdf"]&&"application/pdf"===
q&&(q=new URLSearchParams({ID:f,FLD:a,CLOC:m,Seq:t}),k.$jscomp$loop$prop$sPreviewURL$13=n.replace("GetAttachment.","GetContent.")+"&"+q.toString(),n=document.createElement("a"),n.textContent=" ("+t_("[ME_TXT-View]")+")",n.href="#",n.addEventListener("click",function(w){return function(x){x.preventDefault();PDFPreview(w.$jscomp$loop$prop$sPreviewURL$13)}}(k)),getItemInstance("tdPreviewAttachmentList",b).appendChild(n))}d&&(c=document.createElement("A"),c.href="javascript:ME_SS_ShowImage();",c.style.color=
"#1D4A87",c.style.fontWeight="bold",c.appendChild(document.createTextNode("("+t_("[ME_TXT-ViewAsSlideshow]")+")")),getItemInstance("tdPreviewAttachmentList",b).appendChild(document.createTextNode(" ")),getItemInstance("tdPreviewAttachmentList",b).appendChild(c),ShowHidePreviewAttachments(1,b))}
function ViewHeaders(a,b){var c=GetSelectedFolderPath(b);b=c;var d=!1;isSharedFolder(c)&&(d=!0,b=GetShareURI(c,g_opt.Postoffice));a="Forms/MAI/Headers.aspx?ID="+a+"&Folder="+encodeURIComponent(c)+"&CloseWindow=1";d&&(a+="&URI="+b);OpenNewWindow(a,700,350)}
function DownloadSource(a,b){var c=GetSelectedFolderPath(b);b=c;var d=!1;isSharedFolder(c)&&(d=!0,b=GetShareURI(c,g_opt.Postoffice));a=getAppServletURL()+"?Cmd=MESSAGE-GETSOURCE&ID="+a+"&Folder="+encodeURIComponent(c)+"&CloseWindow=1&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;a+="&ME_SID="+readCookie("MailEnable-SessionId");d&&(a+="&URI="+encodeURIComponent(b));window.location.href=a}function DataItemList_PostRightClick(){HidePreviewPane()}
function FetchBody(a,b,c){try{b&&b.preventDefault();var d=c?c:a.oItemsArray[a.ItemsArray_Find(a.gSelectedMessageID)];b="";if(d){b=d.Folder;b=b.replace(/&lt;/g,"<").replace(/&gt;/g,">");var e="Forms/MAI/MsgBody.aspx?ID="+d.MessageID+"&Folder="+encodeURIComponent(b);d.URI&&(e+="&URI="+d.URI);e+="&BlockImages=0";gImagesBlocked=!1;b="ifPreviewBody";"search"==d.Target&&(b="ifPreviewBody_search");var f=a.document.getElementById(b);f&&1==confirm(t_("[ME_TXT-DownloadRemoteImages]"))&&(f.src=e)}else console.log("Unable to locate message properties")}catch(g){alert(g.message)}return!1}
function MsgListRowSelect(a,b,c,d){oTimeoutDialog.ResetSession();if(a&&""!=a){var e=ItemsArray_GetItem(a);if(e){var f=e.Folder;f=f.replace(/&lt;/g,"<");f=f.replace(/&gt;/g,">");if(b)document.getElementById(a).className==LIST_ROW_STYLE_SELECTED?(DataItemList_UnselectRow(LIST_ID,a),a==gSelectedMessageID&&HidePreviewPane()):(DataItemList_SelectRow(LIST_ID,a),HidePreviewPane());else if(c){var g=DataItemList_GetRowIndexByID(LIST_ID,a);DataItemList_UnselectAllRows(LIST_ID);g>gFirstSelectedIndex?DataItemList_SelectRows(LIST_ID,
gFirstSelectedIndex,g):DataItemList_SelectRows(LIST_ID,g,gFirstSelectedIndex);HidePreviewPane()}else DataItemList_UnselectAllRows(LIST_ID),DataItemList_SelectRow(LIST_ID,a);gSelectedIM.GetSize()==gTotalItems?SetSelectAllCheckbox(!0):SetSelectAllCheckbox(!1);window.status=gSelectedIM.GetSize()+" "+t_("[ME_TXT-Selected]");gBrowserType!=BROWSER_TYPE_SAFARI||c||b||(gFirstSelectedIndex=g=DataItemList_GetRowIndexByID(LIST_ID,a));gSelectedMessageID=a;var h=document.getElementById(a);g=document.getElementById(LIST_CONTAINER);
h=h.offsetTop+h.offsetHeight;g=g.scrollTop+g.offsetHeight;0<g&&h>g&&(LogDebug("MsgListRowSelect::Selected Half Row->Scroll down 1 and Redraw List, then set scroll pos"),gDataListTopOfPageOrdinal++,DataItemList_RewriteTableRows(LIST_ID,gDataListTopOfPageOrdinal-1,arrTableColumns,"select"),DataItemList_SetScrollPosition(gUnitScrollLength));g="";h=GetSelectedFolderPath();e&&(e.URI&&encodeURIComponent(e.URI),e.From_Full&&"/SENT ITEMS"!=h.toUpperCase()&&(g="1&From="+encodeURIComponent(e.From_Full.replace("<",
"").replace(">",""))));if(!gKeyAction&&ProcessDoubleClick(f,a)){"/Drafts"==h?ContinueComposingDraft():OpenMessage(a,GetSelectedFolderPath(),g);gKeyAction=!1;if(d=d||event)d.preventDefault?(d.stopPropagation(),d.preventDefault()):(d.cancelBubble=!0,d.returnValue=!1);return!0}!gInstantPreviewLoad||b||c?b||c||(gCurMessageID=a,NavigationPreview(f,a)):(gCurMessageID=a,LoadPreviewMessage(f,a));gItemsArrayCurrIndex=ItemsArray_GetCurrIndex(a);gListItemSelected=!0;SetMessageToolbarButtonsStatus();return!0}}}
function domove(a){a=a||event;dodomove(a.clientX?a.clientX:a.offsetX,a.clientY?a.clientY:a.offsetY,!1);return!0}
function dodomove(a,b,c){if(c){var d=null;gCurrentView==VIEW_CONTACTS?d=document.getElementById("frmContacts"):gCurrentView==VIEW_TASKS?d=document.getElementById("frmTasks"):gCurrentView==VIEW_NOTES?d=document.getElementById("frmNotes"):gCurrentView==VIEW_CALENDAR?d=document.getElementById("frmCalendar"):gCurrentView==VIEW_STATS?d=document.getElementById("frmStats"):gCurrentView==VIEW_SEARCH?d=document.getElementById("frmSearch"):gCurrentView==VIEW_ADMIN?d=document.getElementById("frmAdmin"):gCurrentView==
VIEW_FILES&&(d=document.getElementById("frmMyFiles"));null!=d&&(a+=getElementUltimateOffsetLeft(d),b+=getElementUltimateOffsetTop(d))}if(null!=dragitem)return doDragMove(a,b,c)}
function dodown(a){a=a||event;if(!gAllowPageActions)return!1;var b=a.clientY?a.clientY:a.offsetY,c=a.clientX?a.clientX:a.offsetX,d=a.target||a.srcElement;if(3==a.which&&gBrowserType==BROWSER_TYPE_SAFARI){if(IsElementAAncestorOfElementB(document.getElementById(LIST_ID),d)){if(gPreviewMode==VIEW_BOTTOM)var e=d.parentNode.getAttribute("id");else gPreviewMode==VIEW_RIGHT&&(e=d.parentNode.getAttribute("id"),null==e&&(e=d.parentNode.parentNode.getAttribute("id"),null==e&&(e=d.parentNode.parentNode.getAttribute("id"),
null==e&&0==d.parentNode.parentNode.parentNode.getAttribute("id").indexOf("summary_")&&(e=d.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("id")))));null!=e&&(gSelectedIM.AddItem(e),PopUp_ShowMenu(a,"menudiv",e,e))}if(IsElementAAncestorOfElementB(document.getElementById("METree"),d))for(var f in arrTree)if(d.id=="tv_lbl_"+arrTree[f].NodeID){PopUp_ShowMenu(a,"folderTreeContextMenuDiv",f,f);break}null!=a&&(a.preventDefault?a.preventDefault():a.returnValue=!1);return permitTextSelection(d,
"msgHeader_shell_js")}a=document.getElementById("StaticVScrollerBar");e=document.getElementById("StaticHScrollerBar");f=document.getElementById("StaticHScrollerBarPreviewTD");var g=0;IsElementAAncestorOfElementB(a,d)?g=1:IsElementAAncestorOfElementB(e,d)?g=2:IsElementAAncestorOfElementB(f,d)&&(g=3);dododown(g,c,b,!1);return permitTextSelection(d,"msgHeader_shell_js")}
function dododown(a,b,c,d){if(0!=gMoveState)return!1;gMoveState=a;if(gResizeSourceChildFrame=d)a=null,gCurrentView==VIEW_CONTACTS?a=document.getElementById("frmContacts"):gCurrentView==VIEW_TASKS?a=document.getElementById("frmTasks"):gCurrentView==VIEW_NOTES?a=document.getElementById("frmNotes"):gCurrentView==VIEW_CALENDAR?a=document.getElementById("frmCalendar"):gCurrentView==VIEW_STATS?a=document.getElementById("frmStats"):gCurrentView==VIEW_SEARCH?a=document.getElementById("frmSearch"):gCurrentView==
VIEW_FILES&&(a=document.getElementById("frmMyFiles")),null!=a&&(b+=getElementUltimateOffsetLeft(a),c+=getElementUltimateOffsetTop(a));if(1==gMoveState)b=document.getElementById("VScroller"),b.style.visibility="visible",b.style.display="block",b.style.top=c-(b.offsetHeight/2-1)+"px",ShowVerticalResizer();else if(2==gMoveState||3==gMoveState)c=document.getElementById("HScroller"),c.style.visibility="visible",c.style.display="block",c.style.left=b-(c.offsetWidth/2-1)+"px",ShowHorizontalResizer();return!0}
function doup(a){a=a||event;var b=a.target||a.srcElement;dodoup(a.clientX?a.clientX:a.offsetX,a.clientY?a.clientY:a.offsetY,gResizeSourceChildFrame,b);permitTextSelection(b,"msgHeader_shell_js")||null==a||(a.preventDefault?a.preventDefault():a.returnValue=!1);return permitTextSelection(b,"msgHeader_shell_js")}
function dodoup(a,b,c,d){if(!gAllowPageActions)return!1;var e=null;c&&(gCurrentView==VIEW_CONTACTS?(e=document.getElementById("frmContacts"),document.getElementById("frmContacts")):gCurrentView==VIEW_TASKS?(e=document.getElementById("frmTasks"),document.getElementById("frmTasks")):gCurrentView==VIEW_NOTES?(e=document.getElementById("frmNotes"),document.getElementById("frmNotes")):gCurrentView==VIEW_CALENDAR?(e=document.getElementById("frmCalendar"),document.getElementById("frmCalendar")):gCurrentView==
VIEW_STATS?(e=document.getElementById("frmStats"),document.getElementById("frmStats")):gCurrentView==VIEW_SEARCH?(e=document.getElementById("frmSearch"),document.getElementById("frmSearch")):gCurrentView==VIEW_FILES&&(e=document.getElementById("frmMyFiles"),document.getElementById("frmMyFiles")),null!=e&&(a-=getElementUltimateOffsetLeft(e),b-=getElementUltimateOffsetTop(e)));if(null!=dragitem)return doDragUp(a,b,c,d)}var dragitem=null;
function startDrag(a,b,c){if("dragPlaceHolder"==a)return!1;dragitem=a;a=document.createElement("DIV");a.id="dragPlaceHolder";a.alt=dragitem;a.className="clickDrag_shell";a.style.position="absolute";a.style.zIndex=1E4;var d=document.createElement("DIV"),e=document.createElement("DIV");d.className="clickDrag_txt_shell";e.className="clickDrag_txt";if(gSelectedIM.ItemExists(dragitem))var f=gSelectedIM.GetSize();else f=1,HidePreviewPane(),DataItemList_UnselectAllRows(LIST_ID),DataItemList_SelectRow(LIST_ID,
dragitem);1<f&&9999<f&&(f="100..");e.appendChild(document.createTextNode(f));d.appendChild(e);a.appendChild(d);dragitem="dragPlaceHolder";document.body.appendChild(a);a.style.left=b+10+"px";a.style.top=c+10+"px";return!0}function doDragMove(a,b,c){if(c=document.getElementById(dragitem))c.style.cursor="default",c.style.left=a+10+"px",c.style.top=b+10+"px";return!0}
function doDragUp(a,b,c,d){if(dragitem){if(c=document.getElementById("dragPlaceHolder")){var e=c.parentNode;e&&(dragitem=c.alt,e.removeChild(c))}c=RegExp("[0-9]+$");if(!d||!c.test(d.id))for(var f in arrTree){e=document.getElementById("tv_lbl_"+arrTree[f].NodeID);var g=getElementUltimateOffsetTop(e)-$("#bodyCol_shell_folderList").scrollTop(),h=getElementUltimateOffsetLeft(e),k=g+e.offsetHeight,l=h+e.offsetWidth;if(a>=h&&a<=l&&b>=g&&b<=k){d=e;break}}a=null;d&&(IsElementAAncestorOfElementB(document.getElementById("METree"),
d)?a=arrTree:IsElementAAncestorOfElementB(document.getElementById("FavTree"),d)&&(a=arrFavourites));if(a&&(d=c.exec(d.id))){b=d[0];d=GetSelectedFolderPath();a=TreeNodesGetKey(a,"Node_"+b);if(!a)return!1;a=GetURIFromNodeKey(a);if(0==a.length)return!0;b=ParseURI(a);"$public"==b[2].toLowerCase()&&(a="/Public",1<b[3].length&&(a+=b[3]));"$fileroot"==b[2].toLowerCase()?(a="/$fileroot",1<b[3].length&&(a+=b[3])):b[2].toLowerCase()==g_opt.Mailbox&&(a=b[3]);isSharedFolder(d)&&(d=GetShareURI(d,g_opt.Postoffice));
b[3].match(RegExp("(/Contacts|/Calendar|/Tasks)$"))?ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Youcannotmoveamessageintothisfolder]"),!0):MoveSelectedMessages(d,a)}}dragitem=null;return!0}function actionDrop(a){dragitem=a;return!0}function enterDrag(a){window.event.dataTransfer.getData("Text");return!0}function overDrag(a){window.event.returnValue=!1;return!0}function HasMultipleItemsSelected(){return 1<gSelectedIM.GetSize()}function HasNoItemsSelected(){return 0>=gSelectedIM.GetSize()}
function DeleteListItem(a){1==gListItemSelected&&gSelectedIM.GetView()==gCurrentView&&DeleteMessage(a,GetSelectedFolderPath())}var MAX_DELETE_ITEMS=20;function DeleteNextSelectedBatch(a){var b="Folder="+encodeURIComponent(GetSelectedFolderPath())+"&ID=",c=new StringBuffer,d=gSelectedIM.GetItems(),e=0,f;for(f in d)if(0<e&&c.append(","),c.append(d[f]),e++,e==a)break;b+=c.toString();Async_LockUI();ServerRequest("DELETE-MESSAGE",b,gAsyncDelete)||HandleAjaxError()}
function DeleteSelectedListItems(){if(!gAllowPageActions||HasNoItemsSelected()||gSelectedIM.GetView()&&gSelectedIM.GetView()!=gCurrentView)return!1;var a="Folder="+encodeURIComponent(GetSelectedFolderPath())+"&ID=";if(gSelectedIM.GetSize()>MAX_DELETE_ITEMS)gSelectedIM.SetCallback(function(){DeleteNextSelectedBatch(MAX_DELETE_ITEMS)}),ShowWait(t_("[ME_TXT-Pleasewaitwhiletheitemsaredeleted]")+"..."),gKeepShowingWait=!0,window.setTimeout(function(){DeleteNextSelectedBatch(MAX_DELETE_ITEMS)},500);else{var b=
gSelectedIM.GetItems();if(Object.keys&&1==Object.keys(b).length)DeleteMessage(b[Object.keys(b)[0]],GetSelectedFolderPath()),ClearPreviewPane();else{var c=new StringBuffer,d=0,e="",f=1==g_opt.FastDeleteMode,g=0,h;for(h in b)0<d&&c.append(","),c.append(b[h]),d++,f&&(e=ItemsArray_Find(b[h]),-1!=e&&1!=oItemsArray[e].Read&&g++,RemoveMessageFromList(b[h]));e=c.toString();a+=e;f?(a+="&Async=1",UpdateDeletedItems(g,-1),1==d&&UpdateListForBatchResults()):Async_LockUI(t_("[ME_TXT-Pleasewaitwhiletheitemsaredeleted]")+
"...");window.setTimeout(function(){ServerRequest("DELETE-MESSAGE",a,gAsyncDelete)||HandleAjaxError()},200);gPreviewMode==VIEW_BOTTOM&&SetSelectAllCheckbox(!1);SetMessageToolbarButtonsStatus()}}}function DeleteCurrentMessage(){DeleteMessage(gSelectedMessageID,GetSelectedFolderPath());ClearPreviewPane()}
function DeleteMessage(a,b){if(!gAllowPageActions)return!1;Async_LockUI(t_("[ME_TXT-Pleasewaitwhiletheitemsaredeleted]")+"...");ServerRequest("DELETE-MESSAGE","Folder="+encodeURIComponent(b)+"&ID="+a,gAsyncDelete)||HandleAjaxError()}function MoveMessage(a,b,c){if(!gAllowPageActions)return!1;a.toLowerCase()!=c.toLowerCase()&&(Async_LockUI(),ServerRequest("MOVE-MESSAGE","Folder="+encodeURIComponent(a)+"&ID="+b+"&TargetFolder="+encodeURIComponent(c),gAsyncMove)||HandleAjaxError());return!0}
function MoveNextSelectedBatch(a,b,c){var d=new StringBuffer,e=gSelectedIM.GetItems(),f=0,g;for(g in e)if(0<f&&d.append(","),d.append(e[g]),f++,f==c)break;MoveMessage(a,d.toString(),b)}MAX_MOVE_ITEMS=20;
function MoveSelectedMessages(a,b){if(a.toLowerCase()==b.toLowerCase())return!1;gMultiSelectMoveMode=!0;if(gSelectedIM.GetSize()>MAX_MOVE_ITEMS)gSelectedIM.SetCallback(function(){MoveNextSelectedBatch(a,b,MAX_MOVE_ITEMS)}),ShowWait(t_("[ME_TXT-Pleasewaitwhiletheitemsaremoved]")+"..."),gKeepShowingWait=!0,window.setTimeout(function(){MoveNextSelectedBatch(a,b,MAX_MOVE_ITEMS)},500);else{var c="",d=gSelectedIM.GetItems(),e=0,f=new StringBuffer,g;for(g in d)0<e&&f.append(","),f.append(g),e++;c=f.toString();
""!=c&&(ShowWait(t_("[ME_TXT-Pleasewaitwhiletheitemsaremoved]")+"..."),window.setTimeout(function(){MoveMessage(a,c,b)},200))}}function ProcessDoubleClick(a,b){if(DoubleClickDelayTimer&&b==ClickedMessageID)return ClearDoubleClickDelayTimer(),ClickedMessageID="",!0;ClickedMessageID=b;DoubleClickDelayTimer&&clearTimeout(DoubleClickDelayTimer);DoubleClickDelayTimer=window.setTimeout(function(){ClearDoubleClickDelayTimer()},500);return!1}
function ClearDoubleClickDelayTimer(){clearTimeout(DoubleClickDelayTimer);DoubleClickDelayTimer=null;return!0}function SetPreviewPaneVisibility(a){if("hidden"==document.body.style.visibility)return!1;void 0==a&&(a=GetOptionValue("WebMail-MessagePreviewPane"));getTopAppWindow().document.getElementById("divPreviewPane").style.display=GetDisplay(a);return!0}function ClearMessagePreview(){ShowEmptyPreviewPane();gMessageLoaded=!1}
function MarkMessageAsRead(a,b){if(!(0>DataItemList_GetRowIndexByID(LIST_ID,a)+1)){var c=ItemsArray_Find(a);0>c?LogDebug("Message "+a+" was not found in current array for folder: "+b):(c=oItemsArray[c].Read,b=b.replace(/\\/i,"/"),"/"!=b.substr(0,1)&&(b="/"+b),0==c&&SetObjectProperty(b,a,"READ","",!0))}}function SetObjectProperty(a,b,c,d,e){if(!gAllowPageActions)return!1;a="Folder="+encodeURIComponent(a)+"&ID="+b+"&Prop="+c+"&Val="+d;ServerRequest("SET-PROPERTY",a,e);return!0}
function ShowLoadingPreview(){ShowPreviewPane();document.getElementById("divMessagePreview").style.display="none"}function HideLoadingPreview(){document.getElementById("divMessagePreview").style.display=""}
function LoadPreviewMessage(a,b){if(!gAllowPageActions||!GetOption("WebMail-MessagePreviewPane"))return!1;var c=a+"::"+b;if(gCurrentPreviewKey!=c){gCurrentPreviewKey=c;ShowLoadingPreview();gMessageLoaded=!0;ShowWait(t_("[ME_TXT-Loading]")+"...",null,!0);var d="";try{var e=RegExp("<?([^@]+@[^.@][^@]*.[A-Za-z]{2,})>?").exec(oItemsArray[ItemsArray_Find(b)].From_Full);e&&(d=e[1])}catch(f){d=""}if(c=document.getElementById("ifPreviewBody"))c.src="blank.htm";window.setTimeout(function(){ServerRequest("GET-MESSAGE",
"Folder="+encodeURIComponent(a)+"&ID="+b+"&FROM="+encodeURIComponent(d)+"&BODY="+g_opt.BodyFetchMode,!0)},100);MarkMessageAsRead&&0<g_opt.MarkAsReadDelay&&(gMarkAsReadTimeout=window.setTimeout(function(){MarkMessageAsRead(b,a)},g_opt.MarkAsReadDelay))}else ShowPreviewPane();return!0}function ClearPreviewDelayTimer(a,b,c){clearTimeout(PreviewDelayTimer);PreviewDelayTimer=null;c&&LoadPreviewMessage(a,b);return!0}
function NavigationPreview(a,b){PreviewDelayTimer?(clearTimeout(PreviewDelayTimer),PreviewDelayTimer=window.setTimeout(function(){ClearPreviewDelayTimer(JSEscapeStr(a),b,!0)},500)):(LoadPreviewMessage(a,b),PreviewDelayTimer=window.setTimeout(function(){ClearPreviewDelayTimer(JSEscapeStr(a),b,!1)},500));return!0}function ResetSearchField(){var a=document.getElementById("txtSearch");a&&(a.value=t_("[ME_TXT-EnterSearchHere]")+"...",SetSearchFieldInputClass(!1),gSearchStrInputed=!1)}
function SetSearchFieldInputClass(a){var b=document.getElementById("txtSearch");b&&(b.parentNode.className=a?"search_form_normal":"search_form_initial")}function ClearSearchField(){SetFieldValue("txtSearch","");gSearchStr=""}function SearchBtnClicked(){if(!gSearchStrInputed)return gSearchStrInputed=!0,ClearSearchField(),SetSearchFieldInputClass(!0),SetFieldFocus("txtSearch"),!0;DoSearch()}
function txtSearchClick(){gSearchStrInputed||(gSearchStrInputed=!0,HasFocus("txtSearch")||(ClearSearchField(),SetFieldFocus("txtSearch"),SetSearchFieldInputClass(!0)));return!0}function txtSearchBlur(){gSearchStrInputed||0==document.getElementById("txtSearch").value.length&&ResetSearchField();return!0}function txtSearchChange(a){gSearchStrInputed=!0}function SetSelectAllCheckbox(a){var b=document.getElementById(LIST_ID+"_SelectAll");b&&(b.checked=a)}
function SelectAllItemIDs(){gBrowserType==BROWSER_TYPE_OPERA&&disableSelection(document.body);gExtData="&Mode=SELECT-ALL";Async_LockUI(t_("[ME_TXT-Pleasewait]")+"...");window.setTimeout(GetAllServerSelectedIDs,500)}
function GetAllServerSelectedIDs(){var a=gSecondPageNum-1;a=0>=a?1:a;gListFirstLoad=!1;a="Folder="+encodeURIComponent(GetSelectedFolderPath())+"&Page="+a+"&sc=1&IPP="+gDataPageSize+"&SortField="+gSortColumn+"&SortOrder="+gSortOrder+gSearchStr+"&Mode=SELECT-ALL";ServerRequest("LIST-MESSAGES",a,!0)}
function DataItemList_SelectAllCheckboxCallback(a){if(a=document.getElementById(a))a.checked?(gExtData="&Mode=SELECT-ALL",Async_LockUI(t_("[ME_TXT-Pleasewait]")+"..."),window.setTimeout(GetAllServerSelectedIDs,500)):(gExtData="",DataItemList_UnselectAllRows(LIST_ID),window.status=gSelectedIM.GetSize()+" "+t_("[ME_TXT-Selected]"))}function FormatRFC822AddressList(a){a=a.replace(/\t/g,";");return HTMLDecode(a)}
function GetSelectedFolderPath(a){if(ViewTabIsSelected(TAB_VIEW_SEARCH)){if(0<=jsonList.selectedIndex&&(a=jsonList.Items[jsonList.selectedIndex]))var b=a.FolderPath}else{b=a?GetSelectedNode(a):GetSelectedNode(gCurrentView);if(isSharedFolder(b))return b;b=FolderTree_GetSelectedFolderPath(b,gCurrentView)}return""==b?"/Inbox":b}
function PromptForReceiptDispatch(a,b,c,d){if(!gAllowPageActions)return!1;oConfirmation.Confirm(t_("[ME_TXT-ReadReceipt]"),t_("[ME_TXT-SenderHasRequestedReadReceipt]")+": </BR></BR><B>"+t_("[ME_TXT-From]")+"</B>: "+c+"</BR><B>"+t_("[ME_TXT-Subject]")+"</B>: "+d+"</BR></BR>"+t_("[ME_TXT-SendReadReceipt?]"),function(){SendReadReceipt(escape(b),escape(a))})}function ShowHidePreviewAttachments(a,b){b=getItemInstance("trPreviewAttachments",b);0==a?b.style.display="none":1==a&&(b.style.display="")}
function DisableToolBarButtons(a){for(var b=a.length,c=0;c<b;c++)DisableToolbarButton(a[c])}
function SetMessageToolbarButtonsStatus(){var a=0;try{if(GetOption("WebMail-MessagePreviewPane")&&gPreviewMode!=VIEW_BOTTOM)gPreviewMode==VIEW_RIGHT&&(IsIE(gBrowserType)&&(document.getElementById("toolbar_search_msgList_js").style.width="100%"),document.getElementById("toolbar_primary_table_left_msgList_js").style.display="none",document.getElementById("toolbar_search_msgList_js").style.display="",document.getElementById("toolbar_search_msgList_js").style.width="",document.getElementById("toolbar_sort_msgList_js").style.display=
"",document.getElementById("toolbar_primary_dummy_js").style.display="none",$("#toolbar_search_msgList_js").removeClass("botView"),$("#toolbar_search_shell").removeClass("botView"),$("#dropDown_search").removeClass("botView"),ResizePreviewDropDown("sort"),ResizePreviewDropDown(),document.getElementById("toolbar_more_msgList_js").style.display="none",document.getElementById("toolbar_primary_preview").style.display="");else{document.getElementById("toolbar_primary_table_left_msgList_js").style.display=
"";IsIE(gBrowserType)&&(document.getElementById("toolbar_search_msgList_js").style.width="100%");document.getElementById("toolbar_sort_msgList_js").style.display="none";$("#toolbar_search_msgList_js").addClass("botView");$("#toolbar_search_shell").addClass("botView");$("#dropDown_search").addClass("botView");document.getElementById("toolbar_more_msgList_js").style.display="";ResizePreviewDropDown();a=4;var b=document.getElementById("toolbar_search_shell").clientWidth;document.getElementById("toolbar_search_msgList_js").style.width=
b+a+"px";document.getElementById("toolbar_primary_preview").style.display="none";document.getElementById("toolbar_primary_dummy_js").style.display="";var c=gSelectedIM.GetSize(),d=GetSelectedFolderPath(),e=!0;"/Drafts"==d&&(e=!1);EnableToolbarButton("bttn_newMsg",function(){DoCompose(e)});if(0==c){var f="bttn_reply bttn_replyAll bttn_forward bttn_delete bttn_print bttn_viewHeaders bttn_downloadSource".split(" ");"/Drafts"==d&&f.push("bttn_newMsg");gReportAsSpamEnabled&&f.push("bttn_spam");DisableToolBarButtons(f);
DisableDropdownButton("bttn_dropDown_more_msgList",BTTN_FLOAT_LEFT)}else if(gReportAsSpamEnabled&&EnableToolbarButton("bttn_spam",function(){ReportSelectedMessagesAsSpam(null,GetSelectedFolderPath())}),1==c){b=a=!1;var g=gSelectedIM.GetFirstSelectedItem(),h=ItemsArray_Find(g);gAllowSMSConversations||-1==h||(a=b="IPM.Note.Mobile.SMS"==oItemsArray[h].Class);a?(f=["bttn_reply","bttn_replyAll","bttn_spam","bttn_viewHeaders","bttn_downloadSource"],DisableToolBarButtons(f),EnableToolbarButton("bttn_forward"),
EnableToolbarButton("bttn_delete"),EnableToolbarButton("bttn_print"),DisableDropdownButton("bttn_dropDown_more_msgList",BTTN_FLOAT_LEFT)):(EnableToolbarButton("bttn_reply",function(){ProcessComposeCmd("Reply",SELECTED_LIST_ITEM)}),b?DisableToolbarButton("bttn_replyAll"):EnableToolbarButton("bttn_replyAll",function(){ProcessComposeCmd("ReplyAll",SELECTED_LIST_ITEM)}),EnableToolbarButton("bttn_forward",function(){ProcessComposeCmd("Forward",SELECTED_LIST_ITEM)}),EnableToolbarButton("bttn_delete",function(){DeleteSelectedListItems()}),
EnableToolbarButton("bttn_print",function(){ME_Print()}),EnableToolbarButton("bttn_viewHeaders",function(){ViewHeaders(gSelectedMessageID)}),EnableToolbarButton("bttn_downloadSource",function(){DownloadSource(gSelectedMessageID)}),EnableDropdownButton("bttn_dropDown_more_msgList",function(){dropDown_toggleDisplay("dropDown_more")},BTTN_FLOAT_LEFT))}else 1<c&&(f="bttn_reply bttn_replyAll bttn_forward bttn_print bttn_viewHeaders bttn_downloadSource".split(" "),"/Drafts"==d&&f.push("bttn_newMsg"),DisableToolBarButtons(f),
EnableToolbarButton("bttn_delete",function(){DeleteSelectedListItems()}),DisableDropdownButton("bttn_dropDown_more_msgList",BTTN_FLOAT_LEFT))}}catch(k){}}function ResetPreviewPaneLayout(){null!=layoutEmailInner&&(layoutEmailInner.destroy(),layoutEmailInner=null)}
function InitPreviewPaneLayout(){if("none"==document.getElementById("divEmail").style.display)return!1;GetOption("WebMail-MessagePreviewPane")?gPreviewMode==VIEW_RIGHT?(layoutEmailInner=$("#mainContent").layout(layoutSettings_EmailInnerPrevRight),document.getElementById(LIST_CONTAINER).style.backgroundPosition="0px -50px",document.getElementById(LIST_CONTAINER_INNER).className="msgList_container_shell_summary"):(layoutEmailInner=$("#mainContent").layout(layoutSettings_EmailInnerPrevBot),document.getElementById(LIST_CONTAINER).style.backgroundPosition=
"0px 0px",document.getElementById(LIST_CONTAINER_INNER).className="msgList_container_shell"):(layoutEmailInner=$("#mainContent").layout(layoutSettings_EmailInnerPrevNone),document.getElementById(LIST_CONTAINER).style.backgroundPosition="0px 0px",document.getElementById(LIST_CONTAINER_INNER).className="msgList_container_shell");ResizeEmailInner();InitMessageList();SetMessageToolbarButtonsStatus()}
function SetPreviewPaneOrientation(a,b){gPreviewMode=parseInt(a);null==layoutEmailInner&&InitPreviewPaneLayout();SetMessageToolbarButtonsStatus()}function DataItemList_CheckboxCallback(a,b){HidePreviewPane();SetMessageToolbarButtonsStatus();gSelectedIM.GetSize()==gTotalItems?SetSelectAllCheckbox(!0):SetSelectAllCheckbox(!1);window.status=gSelectedIM.GetSize()+" "+t_("[ME_TXT-Selected]")}
function OpenShare(a,b,c){if(!gAllowPageActions)return!1;b=(new Date).getTime();gSourceURI=a;HasAccessToShare(a)?a.match(/^SF:[^\/]*\/[^\/]*\/Contacts$/i)?(SetPageContextMode(CONTEXT_CONTACTS),SelectViewTab(TAB_VIEW_CONTACTS),gListSharedContactsInterval=setInterval(function(){window.frames.frmContacts&&window.frames.frmContacts.SelectShare&&(window.frames.frmContacts.SelectShare(a),clearInterval(gListSharedContactsInterval),gListSharedContactsAttempts=0)},1E3)):a.match(/^SF:[^\/]*\/[^\/]*\/Calendar$/i)?
(document.getElementById("divCalendar").style.display="",document.getElementById("frmCalendar").src=getTopAppWindow().g_opt.CalAppURI+"list.aspx?URI="+a+"&Sensitivity=0&TS="+b,SetPageContextMode(CONTEXT_CALENDAR),SelectViewTab(TAB_VIEW_CALENDAR)):a.match(/^SF:[^\/]*\/[^\/]*\/Tasks$/i)?(SetPageContextMode(CONTEXT_TASKS),SelectViewTab(TAB_VIEW_TASKS),gListSharedTasksInterval=setInterval(function(){window.frames.frmTasks&&window.frames.frmTasks.SelectShare&&(window.frames.frmTasks.SelectShare(a),clearInterval(gListSharedTasksInterval),
gListSharedTasksAttempts=0)},1E3)):(gListFirstLoad=!0,gSourceURI=a,void 0!=c&&c||(DataItemList_ClearListContents(LIST_ID),ServerRequest("LIST-MESSAGES","",!1)),HideOtherPageContexts(CONTEXT_PERSONAL_FOLDERS),SetCurrentView(VIEW_SHARES)):ShowAlert(t_("[ME_TXT-Error]"),t_("[ME_TXT-Youarenotpermittedtoaccessthisshare!Tryreconnectingtotheshare.]"),!0)}
function DisplaySelectedFolderNode(a,b,c,d){void 0==c&&(c=!0);var e=null;var f="",g=null,h="Mine";try{if(e=a[b])f=e.URI&&0==e.URI.indexOf("SF:")?h=e.URI:e.RelativePathOnDisk||e.RelativeFolderPath,g=e.ContainerClass,""!=f&&"/Calendar"!=f&&"/Contacts"!=f&&"/Tasks"!=f&&(h=f)}catch(k){}g||(e=FolderTree_GetSelectedFolderPath(b,gCurrentView),g=e==FOLDER_NODE_CONTACTS?"IPF.Contact":e==FOLDER_NODE_CALENDAR?"IPF.Appointment":e==FOLDER_NODE_TASKS?"IPF.Task":e==FOLDER_NODE_NOTES?"IPF.StickyNote":"");switch(g){case "IPF.Contact":SetPageContextMode(CONTEXT_CONTACTS,
c,null,h);h=document.getElementById("frmContacts");!IsBlankSrc(h.src)&&window.frames.frmContacts.SelectMyContacts&&window.frames.frmContacts.SelectMyContacts(f);break;case "IPF.Appointment":SetPageContextMode(CONTEXT_CALENDAR,c,null,h);(f=window.frames.frmCalendar?window.frames.frmCalendar.frames.frmDatePicker:null)&&f.ShowSharedCalendar?f.ShowSharedCalendar("Mine"):(f=document.getElementById("frmCalendar"),c=getTopAppWindow().g_opt.CalAppURI+"List.aspx?TS="+(new Date).getTime(),h&&(c+="&URI="+encodeURIComponent(h)),
f.src=c);break;case "IPF.Task":SetPageContextMode(CONTEXT_TASKS,c,null,h);h=document.getElementById("frmTasks");!IsBlankSrc(h.src)&&window.frames.frmTasks.SelectMyTasks&&window.frames.frmTasks.SelectMyTasks(f);break;default:EnsureNodeIsInTree(a,b),TreeViewHighlightNode(a,b,gCurrentView,"METree"),e=GetFolderPath(b),isSharedFolder(b)||isFavouritesFolder(b)?(h=GetURIFromNodeKey(b),a=/^\/.+\/Calendar/i,b=/^\/.+\/Tasks/i,e.match(/^\/.+\/Contacts/i)||e.match(a)||e.match(b)?HideMessageListPane():ShowListPane(),
SetPageContextMode(CONTEXT_SHARES,c),OpenShare(h,f,d)):"IPF.StickyNote"==g?SetPageContextMode(CONTEXT_NOTES,c):(gCurrentView==VIEW_PUBLIC?SetPageContextMode(CONTEXT_PUBLIC_FOLDERS,c):gCurrentView==VIEW_PERSONAL?SetPageContextMode(CONTEXT_PERSONAL_FOLDERS,c):gCurrentView==VIEW_SHARES?SetPageContextMode(CONTEXT_SHARES,c):gCurrentView==VIEW_ACCOUNT_SUMMARY&&SetPageContextMode(CONTEXT_PERSONAL_FOLDERS,c),gCurrentView==VIEW_FILES?(e=-1==b.indexOf("/")?"$FILEROOT":"$FILEROOT"+GetFolderPath(b),SetPageContextMode(CONTEXT_FILES_FOLDERS,
c,e),TreeViewHighlightNode(a,b,VIEW_FILES,"METree")):(void 0!=d&&d||("/Drafts"==e?(SetToolbarButtonText("bttn_newMsg",t_("[ME_TXT-Open]")),SetToolbarButtonTitle("bttn_newMsg",t_("[ME_TXT-ContinueComposingMsg]")),SetToolbarButtonText("prevRight_newMsg",t_("[ME_TXT-Open]")),SetToolbarButtonTitle("prevRight_newMsg",t_("[ME_TXT-ContinueComposingMsg]"))):(SetToolbarButtonText("bttn_newMsg",t_("[ME_TXT-Compose]")),SetToolbarButtonTitle("bttn_newMsg",t_("[ME_TXT-ComposeNewMsg]")),SetToolbarButtonText("prevRight_newMsg",
t_("[ME_TXT-Compose]")),SetToolbarButtonTitle("prevRight_newMsg",t_("[ME_TXT-ComposeNewMsg]"))),ListMessages(e)),gPreviewMode==VIEW_BOTTOM&&SetSelectAllCheckbox(!1),gDataListTopOfPageOrdinal=1,gBrowserType==BROWSER_TYPE_SAFARI&&ResizePreviewPanel()))}return!0}function DisplayInbox(){SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Inbox")}function DisplayJunkEmail(){SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Junk E-Mail")}
function DisplayDeleted(){SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox)+"/Deleted Items")}function AddFavouriteNode(a,b,c,d,e,f,g,h){TreeNodesAppend(a,c,f,!1,!1,0,d,e,0,0,!1,!1,g).URI=e;TreeViewAddNode(b,a,c,d,f,!1,!1,0,0,0,!1,!1,g,h)}function GetFavouriteDisplayName(a,b){return"["+a[2]+"]-"+(b?b:a[3]).replace("/","")}
function AddFavourite(a){var b="";try{var c=$.parseXML(gOptions["WebMail-Favourites"]);a="<folder><path><![CDATA["+a+"]]\x3e</path></folder>";$(c).find("favourites").append(a);b=(new XMLSerializer).serializeToString(c.documentElement)}catch(d){}return b}
function RemoveFavourite(a){var b="";try{var c=a.toLowerCase(),d=$.parseXML(gOptions["WebMail-Favourites"]);$(d).find("folder").each(function(){$(this).find("path").text().toLowerCase()==c&&$(this).remove()});b=(new XMLSerializer).serializeToString(d.documentElement)}catch(e){}return b}function GetFavouriteCount(){var a=0;try{var b=$.parseXML(gOptions["WebMail-Favourites"]);a=$(b).find("folder").length}catch(c){}return a}
function IsFavourite(a){var b=!1;try{var c=gOptions["WebMail-Favourites"];if(c||0!=c.length){var d=a.toLowerCase(),e=$.parseXML(c);$(e).find("folder").each(function(){if($(this).find("path").text().toLowerCase()==d)return b=!0})}}catch(f){}return b}
function PopulateFavourites(){var a="1"==gOptions["WebMail-ShowFavourites"],b=gOptions["WebMail-Favourites"];try{b&&0!=b.length||(b="<favourites/>");var c=$.parseXML(b),d=$(c).find("folder");a?(TreeNodesAppend(arrFavourites,"<Root-Favourites>",!1,!0,!1,1,"Favourites","",0,0,!1),TreeViewAddNode("FavTree",arrFavourites,"<Root-Favourites>","Favourites",!1,!0,!1,1,0,-1,!1),d.each(function(e){e=$(this).find("path").text();e=ParseURI(e);var f=$(this).find("name").text(),g=$(this).find("class").text();AddFavouriteNode(arrFavourites,
"FavTree","<Root-Favourites>/Mailbox-"+e[2]+e[3],GetFavouriteDisplayName(e,f),e[0],!1,g,"<Root-Favourites>")}),0<d.length?$("#bodyCol_shell_favouritesList").show():$("#bodyCol_shell_favouritesList").hide()):$("#bodyCol_shell_favouritesList").hide()}catch(e){}}
function InitEmailView(){gEmailViewInitialised||(PopulateFavourites(),CreateFolderListRoot(arrTree,"METree",g_opt.Mailbox,FOLDER_TYPE_PERSONAL,gMailboxIsShared),InitLayoutEmail(),InitMessageList(),SetPreviewPaneOrientation(gPreviewMode),gEmailViewInitialised=!0,doFolderListRequest())}
function PageLoadStepOne(){ConfigureKeyEvents(0);ConfigureMouseWheelEvent(0);ConfigureMouseEvents(0);ShowSearchState(t_("[ME_TXT-Therearenoitemstoshowinthisview]"));ServerRequest("GET-MAILBOX-SHARED-STATUS","Mailbox="+g_opt.Mailbox+"&Postoffice="+g_opt.Postoffice,!1);switch(gStartupPage){case "AccountSummary":BackgroundLoadSummaryFrame();bNotInbox=!0;break;case "Calendar":BackgroundLoadCalendarFrame();BackgroundLoadDayPickerFrame();bNotInbox=!0;break;case "Contacts":BackgroundLoadContactsFrame();
bNotInbox=!0;break;case "Tasks":BackgroundLoadTasksFrame();bNotInbox=!0;break;case "Chat":BackgroundLoadFrame("frmChat","./Forms/CHAT/default.aspx"),bNotInbox=!0}"AccountSummary"==gStartupPage&&InitEmailView();bNotInbox?(setTimeout(GoToStartupPage,ME_STARTUP_PAGE_DELAY),StartMonitors()):SelectViewTab(TAB_VIEW_EMAIL);g_opt.ChatEnabled&&g_opt.BrowserSupportsChat&&GetOption("XMPP-AutoLogin")&&AutoLoginChat();return!0}
function StartMonitors(){if(GetOption("BannerAdvertisingEnabled")){var a=document.getElementById("aBanner");a&&(gBannerAdsControl=new BannerAdsControl(document.getElementById("imgBanner"),a,g_opt.SkinRoot))}gCalcTimer=setTimeout(ServerCalculateQuota,ME_QUOTA_RECALCULATION_DELAY);gNewMailMonitor=setInterval(NewMailCheck,g_opt.NewMailPollFrequency);gCalendaringEnabled&&(gApptMonitor=setInterval(AppointmentReminderCheck,g_opt.AppointmentReminderPollFrequency))}
function StopMonitors(){gCalcTimer&&(clearTimeout(gCalcTimer),gCalcTimer=0);gNewMailMonitor&&(clearInterval(gNewMailMonitor),gNewMailMonitor=0);gApptMonitor&&(clearInterval(gApptMonitor),gApptMonitor=0)}
function InitMessageList(){gListFirstLoad=!0;arrTableColumns={};$("#msgList_shell_js").empty();DataItemList_Create(document.getElementById("msgList_shell_js"),"MessageList");gNumDataColumns=SetColumnStyles(arrTableColumns);DataItemList_RenderColumnHeaders(LIST_ID,gNumDataColumns,arrTableColumns);gUnitScrollLength=DataItemList_GetDefaultDataRowHeight();BrowserResize()}function ServerCalculateQuota(){ServerRequest("CALCULATE-QUOTA","",!0)}
function NewMailCheck(){if(!gAllowPageActions)return!1;var a=FolderTreeGetProperty(arrTree,"/Inbox","LastUID",0);ServerRequest("CHECK-NEW-MAIL","LastUID="+a.toString(),gAsyncNewMailCheck)}function AppointmentReminderCheck(){if(!gAllowPageActions)return!1;ServerRequest("CHECK-APPOINTMENT-REMINDER","ChangeKey="+AlertsCacheChangeKey+"&RangeStart="+AlertRangeStart,gAsyncReminderCheck)}
function BackgroundLoadSummaryFrame(){BackgroundLoadFrame("frmSummary","./Forms/Summary.aspx?WindowContext=Embedded")}function BackgroundLoadReadFrame(){BackgroundLoadFrame("frmRead","./Forms/MAI/read.aspx?ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN)}function BackgroundLoadTimeoutFrame(){BackgroundLoadFrame("frmTimeout","./Timeout.aspx")}function BackgroundLoadCalendarFrame(){BackgroundLoadFrame("frmCalendar",getTopAppWindow().g_opt.CalAppURI+"list.aspx")}
function BackgroundLoadDayPickerFrame(){BackgroundLoadFrame("frameCalendar",getTopAppWindow().g_opt.CalAppURI+"DayPicker.aspx")}function BackgroundLoadContactsFrame(){BackgroundLoadFrame("frmContacts","./Forms/VCF/list.aspx?TS="+(new Date).getTime())}function BackgroundLoadFoldersFrame(){BackgroundLoadFrame("frmFolders","./Forms/ManageFolders.aspx?TS="+(new Date).getTime())}function BackgroundLoadFrame(a,b){(a=document.getElementById(a))&&IsBlankSrc(a.src)&&(a.src=b)}
function BackgroundLoadTasksFrame(){BackgroundLoadFrame("frmTasks","./Forms/TSK/list.aspx")}function GoToStartupPage(){switch(gStartupPage){case "AccountSummary":SelectFolder(arrTree,GetDefaultMailboxRootNode(g_opt.Mailbox));break;case "Calendar":SetPageContextMode(CONTEXT_CALENDAR);break;case "Contacts":SetPageContextMode(CONTEXT_CONTACTS);break;case "Tasks":SetPageContextMode(CONTEXT_TASKS);break;case "Chat":SetPageContextMode(CONTEXT_CHAT)}}function LogOff(){ProcessLogOff()}
function ExecFormLogOff(a){var b=window.frames[a];b&&b.LogOff&&b.LogOff(!0,window.frames[a])}
function SaveSession(){StopMonitors();ExecFormLogOff("frmContacts");ExecFormLogOff("frmChat");ExecFormLogOff("frmTasks");var a=window.frames.frmCompose;a&&a.CheckForAnyChanges&&(a.CheckForAnyChanges(),!a.SavedAsDraft&&a.TextChanged&&a.SaveAsDraft&&a.SaveAsDraft());a="Cmd=SET-MBX-OPTION\rProp=WebMail-MailboxExpanded\rVal="+(gMailboxExpanded?1:0)+"\r\n";a+="Cmd=SET-MBX-OPTION\rProp=WebMail-PublicFoldersExpanded\rVal="+(gPublicFoldersExpanded?1:0)+"\r\n";a+="Cmd=SET-MBX-OPTION\rProp=WebMail-SharesExpanded\rVal="+
(gSharesExpanded?1:0)+"\r\n";a+="Cmd=SET-MBX-OPTION\rProp=WebMail-MyFilesExpanded\rVal="+(gMyFilesExpanded?1:0)+"\r\n";ServerRequest("BATCH","Batch="+encodeURIComponent(a),!1);ServerRequest("LOG-OFF","",!1)}function ShowLoginPage(){document.location=g_opt.LoginPagePath}function ProcessLogOff(){SaveSession();window.setTimeout(function(){ShowLoginPage()},1E3)}
function GetPrevMsgID(a){if(0==a.length)return"";a=ItemsArray_Find(a);var b=null;if(0==a)return 0;0<=a&&(b=oItemsArray[a-1]);if(b)a=b.MessageID;else return a=gSecondPageNum-1,gMessagesRetrieved=!1,a="Folder="+encodeURIComponent(GetSelectedFolderPath())+"&Page="+a+"&sc=1&IPP="+gDataPageSize+"&SortField="+gSortColumn+"&SortOrder="+gSortOrder+gSearchStr,ServerRequest("LIST-MESSAGES",a,!1),-1;return a}function IsLastBatch(){return gItemsArrayServerTopIndex+3*gServerIPP>=gTotalItems?!0:!1}
function GetNextMsgID(a){if(0==a.length)return"";a=ItemsArray_Find(a);var b=null;0<=a&&(b=oItemsArray[a+1]);if(b)a=b.MessageID;else{if(IsLastBatch())return 0;a=gSecondPageNum+1;gMessagesRetrieved=!1;a="Folder="+encodeURIComponent(GetSelectedFolderPath())+"&Page="+a+"&sc=1&IPP="+gDataPageSize+"&SortField="+gSortColumn+"&SortOrder="+gSortOrder+gSearchStr;ServerRequest("LIST-MESSAGES",a,!1);return-1}return a}function GetFolders(){return arrTree}
function ShowFreeBusyDialog(a,b,c){a=formatDate(a,"yyyy-MM-dd")+"-00-00";b=formatDate(b,"yyyy-MM-dd")+"-00-00";document.getElementById("FreeBusyDialogFrame").src=getTopAppWindow().g_opt.CalAppURI+"FreeBusy.aspx?StartDate="+a+"&EndDate="+b+"&Attendees="+encodeURIComponent(c);oFreeBusyDialog.Show()}function ShowAttendeeResponseDialog(a){document.getElementById("AttendeeResponseDialogFrame").src=getTopAppWindow().g_opt.CalAppURI+"ResponseStatus.aspx?ID="+a;oAttendeeResponseDialog.Show()}
function IsDraftsFolder(a){var b=!1;if(void 0==a)return!1;a=a.replace(/\\/g,"/");var c=RegExp("^SF:[^/]*[/](.*)$").exec(a);c&&(a=c[1].substr(c[1].indexOf("/")));a=a.toUpperCase();0==a.indexOf("/DRAFTS")&&(b=!0);return b}function ShowPageLoad(){$(".pageLoad_shell").css({visibility:"visible"})}function HideCurtain(a){"undefined"===typeof a&&(a=1E3);0==a?$(".pageLoad_curtain").css({visibility:"hidden"}):$(".pageLoad_curtain").delay(a).queue(function(b){$(this).css({visibility:"hidden"});b()})}
function HidePageLoad(a){"undefined"===typeof a&&(a=600);$(".pageLoad_shell").delay(a).queue(function(b){$(this).css("visibility","hidden");b()})}function SwitchTheme(a){SetOption("Theme",a,!0,0,0);window.location.reload()}
function SwitchPreviewPaneOrientation(a){var b="right"==a?1:0;SetOption("WebMail-MessagePreviewPane","off"!=a,!0,0,1);SetOption("WebMail-PreviewPaneOrientation",b,!0,0,1);SubmitStoredBulkOptionSettings(!0);SetPreviewPaneOrientation(b);ResetPreviewPaneLayout();InitPreviewPaneLayout()}function GetPreviewPaneOrientation(){var a=GetOption("WebMail-MessagePreviewPane"),b=GetOption("WebMail-PreviewPaneOrientation"),c="bottom";a?0==b?c="bottom":1==b&&(c="right"):c="off";return c}
function LoadProfilePic(){var a=new Date;a=getAppServletURL()+"?Cmd=GET-CONTACT&Folder="+escape("$DIRECTORY")+"&ID=["+g_opt.Mailbox+"]&Options=PHOTO&TS="+a.getTime();a+="&ME_SID="+readCookie("MailEnable-SessionId");a+="&ME_VALIDATIONTOKEN="+getTopAppWindow().g_opt.ME_VALIDATIONTOKEN;SetImgSource("profilePicThmb",a);SetImgSource("profilePic",a)}
function ClearPreviewFields(a){a=GetInstanceSuffix(a);$("#divPreviewTo,#divPreviewCc,#divPreviewBcc,#divFromAddr,#tdPreviewSubject"+a+",#tdPreviewReceivedDate"+a).empty()}function HidePreviewFields(a){a=GetInstanceSuffix(a);$("#tdPreviewSubject"+a+",#tdPreviewAttachmentList"+a+",#divPreviewTo"+a).hide()}function GetInstanceSuffix(a){var b="";"undefined"!==typeof a&&a&&0!==a.length&&(b="_"+a);return b}
function ShowPreviewFields(a){a=GetInstanceSuffix(a);$("#tdPreviewSubject"+a+",#tdPreviewAttachmentList"+a+",#divPreviewTo"+a).show()}
function resizeMsgHeaderSubject(a,b){void 0===a&&(a=1E3);var c=GetInstanceSuffix(b);window.setTimeout(function(){HidePreviewFields(b);$("#tdPreviewSubject"+c+",#tdPreviewAttachmentList"+c+",#divPreviewTo"+c).width(0);var d=$("#trPreviewTo"+c+" .msgHeader_table_right").width(),e=$("#tdPreviewReceivedDate"+c).width();$("#divPreviewTo"+c).width(d);$("#tdPreviewSubject"+c).width(e);$("#tdPreviewAttachmentList"+c).width(d);ShowPreviewFields(b)},a)}
function RepositionLevel0(a){a?($("#shell_0",a).css("position","absolute"),$("#shell_0",a).css("position","static")):($("#shell_0").css("position","absolute"),$("#shell_0").css("position","static"))}function RepositionfrmOptions(a){$("#frmOptions",a).height("99%");window.setTimeout(function(){$("#frmOptions").height("100%")},100)}
var oNotification=null,oConfirmation=null,oInputDialog=null,oAlertDialog=null,oWaitDialog=null,oContactTabDialog=null,oTimeoutDialog=null,oShareFolderDialog=null,oConnectionsDialog=null,oFreeBusyDialog=null,oAttendeeResponseDialog=null,oNewTaskDialog=null,oNewNoteDialog=null,oNewAppointmentDialog=null,QuickReplyDialog=null,oArchiveDialog=null,oSearchDialog=null,ContactDetailsTabStrip=null;
function dpDefaults(a,b){a.todayButtonText=t_("[ME_TXT-Today]");a.selectionButtonText=t_("[ME_TXT-Selection]");a.selectNoneButtonText=t_("[ME_TXT-None]");a.prepare();b||(b=new Date);a.setToDate(b)}
function PageLoad(){"undefined"==typeof g_opt&&(g_opt=[]);addEvent(window,"resize",BrowserResize,!0);gSelectedIM=new SelectedItemsManager;SetMailboxName(g_opt.Mailbox);log=new Log(gDebugMode);oWaitDialog=new ProgressDialog("WaitDialog");oAlertDialog=new MessageDialog("AlertDialog");oNotification=new NotificationDialog("NotificationDialog");oInputDialog=new InputDialog("InputDialog");oConfirmation=new MessageDialog("ConfirmDialog");oShareFolderDialog=new Dialog("ShareFolder",t_("[ME_TXT-CurrentAccess]"),
$("#divManageShare"),{Width:650});oConnectionsDialog=new Dialog("ConnectToShare",t_("[ME_TXT-ConnectToShare]"),$("#divConnectToShare"),{Width:650});oConnectionsDialog.AddCloseAction();oFreeBusyDialog=new Dialog("FreeBusyDialog",t_("[ME_TXT-FreeAndBusyTimes]"),$("#FreeBusyDialogDiv"),{Width:650});oAttendeeResponseDialog=new Dialog("AttendeeResponseDialog",t_("[ME_TXT-AttendeeResponseStatus]"),$("#AttendeeResponseDialogDiv"),{Width:600});QuickReplyDialog=new Dialog("QuickReplyDialog",t_("[ME_TXT-QuickReply]"),
$("#QuickReplyDialogDiv"),{Width:600});QuickReplyDialog.AddOKAndCancelActions(function(){SendQuickReply()},null,t_("[ME_TXT-Send]"),null);document.getElementById("divNewTask").style.display="";oNewTaskDialog=new Dialog("NewTaskDialog",t_("[ME_TXT-TaskDetails]"),$("#divNewTask"),{Width:550});oNewNoteDialog=new Dialog("NewNoteDialog",t_("[ME_TXT-NoteDetails]"),$("#divNewNote"),{Width:550});$("#RecurrenceTabBody").load("dialogs/recurrence.htm?v="+Date.now(),null,function(){recurrence.Localize();SetRecurrenceType(RECURRENCE_TYPE_NONE);
oNewAppointmentDialog=new Dialog("NewApptDialog",t_("[ME_TXT-NewAppointment]"),$("#divNewAppt"),{Width:630});oNewAppointmentDialog.options={ResourceId:""};oNewAppointmentDialog.AddOKAndCancelActions(function(){return SaveApptDetails(oNewAppointmentDialog.options.ResourceId)},null,t_("[ME_TXT-Add]"),null,!1);InitApptGeneralFields();InitApptRecurFields()});var a=document.getElementById("divNewContact");ContactDetailsTabStrip=new TabStrip(a);ContactDetailsTabStrip.AddTab(t_("[ME_TXT-General]"),document.getElementById("GeneralTab"));
ContactDetailsTabStrip.AddTab(t_("[ME_TXT-Personal]"),document.getElementById("PersonalTab"));ContactDetailsTabStrip.AddTab(t_("[ME_TXT-Business]"),document.getElementById("CompanyTab"));ContactDetailsTabStrip.AddTab(t_("[ME_TXT-Other]"),document.getElementById("OtherTab"));ContactDetailsTabStrip.AddTab(t_("[ME_TXT-Notes]"),document.getElementById("NotesTab"));oContactTabDialog=new Dialog("ContactDetailsDialog",t_("[ME_TXT-ContactDetails]"),$("#divNewContact"),{Width:550});oContactTabDialog.AddOKAndCancelActions(function(){return SaveContactDetails(MODE_ADD,
$("#divNewContact").data("ContactID"),!0)},null,t_("[ME_TXT-Add]"),null,!1);a=document.getElementById("birthdayPickerLocation");var b=new Date;arrDatePickers.birthdayPicker=new InlineListsDatePicker("birthdayPicker",a,"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,"("+t_("[ME_TXT-None]")+")","ME_StandardText",b.getFullYear()-100,b.getFullYear());dpDefaults(arrDatePickers.birthdayPicker);arrDatePickers.birthdayPicker.enableSelectNoneButton();a=document.getElementById("startDatePickerLocation");arrDatePickers.startDatePicker=
new InlineListsDatePicker("startDatePicker",a,"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,t_("[ME_TXT-None]"));dpDefaults(arrDatePickers.startDatePicker);a=document.getElementById("dueDatePickerLocation");arrDatePickers.dueDatePicker=new InlineListsDatePicker("dueDatePicker",a,"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,t_("[ME_TXT-None]"));dpDefaults(arrDatePickers.dueDatePicker);g_opt.BannerEnabled&&ShowBannerPanel();try{document.getElementById("searchFromDatePickerLocation");arrDatePickers.searchFromDatePicker=
new InlineListsDatePicker("searchFromDatePicker",searchFromDatePickerLocation,"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,t_("[ME_TXT-None]"));var c=new Date;c.setFullYear(c.getUTCFullYear()-1);dpDefaults(arrDatePickers.searchFromDatePicker,c);document.getElementById("searchToDatePickerLocation");arrDatePickers.searchToDatePicker=new InlineListsDatePicker("searchToDatePicker",searchToDatePickerLocation,"mdy",null,ME_DP_MONDAY,dayTokens,monthTokens,t_("[ME_TXT-None]"));c=new Date;c.setFullYear(c.getUTCFullYear()-
1);dpDefaults(arrDatePickers.searchToDatePicker,c)}catch(d){}RenderButton("#bttn_newMsg",t_("[ME_TXT-Compose]"),"toolbar_icon_newMsg",t_("[ME_TXT-ComposeNewMsg]"));RenderButton("#bttn_reply",t_("[ME_TXT-Reply]"),"toolbar_icon_reply",t_("[ME_TXT-ReplytoSender]"));RenderButton("#bttn_replyAll",t_("[ME_TXT-ReplyAll]"),"toolbar_icon_replyAll",t_("[ME_TXT-ReplytoAll]"));RenderButton("#bttn_forward",t_("[ME_TXT-Forward]"),"toolbar_icon_forward",t_("[ME_TXT-Forwardthismessage]"));RenderButton("#bttn_delete",
t_("[ME_TXT-Delete]"),"toolbar_icon_delete",t_("[ME_TXT-DeleteSelectedMessages]"));RenderButton("#bttn_spam",t_("[ME_TXT-Spam]"),"toolbar_icon_junk",t_("[ME_TXT-Reportasspam]"));RenderButton("#bttn_print",t_("[ME_TXT-Print]"),"toolbar_icon_print",t_("[ME_TXT-Print]"));RenderButton("#bttn_viewHeaders",t_("[ME_TXT-ViewHeaders]"),"toolbar_icon_viewHeaders",t_("[ME_TXT-ViewHeaders]"));RenderButton("#bttn_downloadSource",t_("[ME_TXT-DownloadSource]"),"toolbar_icon_downloadSource",t_("[ME_TXT-DownloadSource]"));
RenderButton("#prevRight_newMsg",t_("[ME_TXT-Compose]"),"toolbar_icon_newMsg",t_("[ME_TXT-ComposeNewMsg]"));RenderButton("#prevRight_reply",t_("[ME_TXT-Reply]"),"toolbar_icon_reply",t_("[ME_TXT-ReplytoSender]"));RenderButton("#prevRight_replyAll",t_("[ME_TXT-ReplyAll]"),"toolbar_icon_replyAll",t_("[ME_TXT-ReplytoAll]"));RenderButton("#prevRight_forward",t_("[ME_TXT-Forward]"),"toolbar_icon_forward",t_("[ME_TXT-Forwardthismessage]"));RenderButton("#prevRight_delete",t_("[ME_TXT-Delete]"),"toolbar_icon_delete",
t_("[ME_TXT-Deletethismessage]"));RenderButton("#prevRight_spam",t_("[ME_TXT-Spam]"),"toolbar_icon_junk",t_("[ME_TXT-Reportasspam]"));RenderButton("#prevRight_print",t_("[ME_TXT-Print]"),"toolbar_icon_print",t_("[ME_TXT-Print]"));RenderButton("#prevRight_viewHeaders",t_("[ME_TXT-ViewHeaders]"),"toolbar_icon_viewHeaders",t_("[ME_TXT-ViewHeaders]"));RenderButton("#prevRight_downloadSource",t_("[ME_TXT-downloadSource]"),"toolbar_icon_downloadSource",t_("[ME_TXT-downloadSource]"));RenderButton("#bttn_dropDown_more_preview_js",
t_("[ME_TXT-More]"),null,t_("[ME_TXT-More]"));RenderButton("#divSearchCommand",t_("[ME_TXT-Open]"),"toolbar_icon_open",t_("[ME_TXT-Open]"));oTimeoutDialog=new TimeoutDialog("TimeoutDialog",g_opt.TimeOutPagePath,g_opt.ReconnectPage,{LogOffCallback:LogOff,TimeoutCallback:SaveSession,TimeoutMins:g_opt.TimeOutMins,AlertSound:g_opt.AlertSound});gSkinPath=g_opt.SkinPath;setTimeout(PageLoadStepOne,ME_CLIENT_PAGE_LOAD_THROTTLE_FACTOR);HideWait();HidePageLoad();HideCurtain(1E3);RepositionLevel0();c=getTopAppWindow().GetOption("MustChangePassword");
void 0!=c&&"0"!=c&&ChangePassword()}
function ChangePassword(){$("#ChangePassword").load("dialogs/changepassword.htm?v="+Date.now(),null,function(){$("#ChangePassword").show();var a="1"==getTopAppWindow().GetOption("MustChangePassword");oChangePasswordDialog=new Dialog("ChangePasswordDialog","Password Change Required",$("#ChangePassword"),{Width:400,Height:500,CloseButtonEnabled:!1,AllowEscape:!a});a?oChangePasswordDialog.AddAction(t_("[ME_TXT-Continue..]"),function(){TryChangePassword()&&oChangePasswordDialog.Close()},!1):oChangePasswordDialog.AddOKAndCancelActions(function(){return TryChangePassword()},
null,"Change",null,!1);LocalizePasswordFields();oChangePasswordDialog.Show()})}function SelectItemOverlay(){var a=$("#MEMessageListTBody>tr:hover");0!=a.length&&ShowItemOverlay(a)}
function ShowItemOverlay(a){var b=$(".dataTable_rightView_size_shell",a);0==b.length&&(b=$(".dataTable_size_right",a));if(0<b.length){var c=$("#MailItemPopup");0==c.length?(c=$("#MailItemPopupTemplate").clone(!0,!0),c.attr("id","MailItemPopup"),c.show()):c=$("#MailItemPopup");b.append(c);$("#MailItemPopup").show();$(".dataTable_size_right .dataTable_text_div",a).hide();$(".dataTable_rightView_txt_right",a).hide();$(".dataTable_rightView_icon_right",a).hide()}}
function ConfigureListItemOverlay(){$("#MEMessageListTBody>tr").off("mouseenter mouseleave");$("#MEMessageListTBody>tr").on("mouseenter",function(a){a.stopPropagation();ShowItemOverlay(this)});$("#MEMessageListTBody>tr").on("mouseleave",function(a){$("#MailItemPopup").hide();$(".dataTable_text_div",this).show();$(".dataTable_rightView_txt_right",this).show();$(".dataTable_rightView_icon_right",this).show();a.stopPropagation()})}
function ProcessItemAction(a,b){b.stopPropagation();b=$("#MailItemPopup").parents("tr");2<=b.length&&(gPopupItemID=b[1].id,gSelectedIM.Clear(),"Delete"!==a&&gSelectedIM.AddItem(gPopupItemID),gSelectedMessageID=gPopupItemID,ProcessPopUp(a,!0),gSelectedMessageID="")}
function RenderButton(a,b,c,d){a=$(a);0<a.length&&"undefined"!==typeof d&&a.attr("title",d);d='<div class="bttn_toolbar_primary_left">';c&&(d+='<div class="'+c+'"></div>');b&&(d+='<div class="bttn_toolbar_primary_text">'+b+"</div>");a.html(d+'</div><div class="bttn_toolbar_primary_right"></div>')};
